spring:
  application:
    name: v2-trade

  # Thymeleaf 配置
  thymeleaf:
    cache: false
    mode: HTML
    encoding: UTF-8
    prefix: classpath:/templates/
    suffix: .html
    # 关闭严格模式
    servlet:
      content-type: text/html

  # Web 配置
  web:
    resources:
      add-mappings: true
      static-locations: classpath:/static/,classpath:/public/

  # 数据源配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://127.0.0.1:3306/v2_trade?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: 123456
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-test-query: SELECT 1
      validation-timeout: 3000
      leak-detection-threshold: 60000
      initialization-fail-timeout: 1
      pool-name: MySQL-HikariPool

  # Redis 配置
  data:
    redis:
      host: 127.0.0.1
      port: 6379
      password:
      database: 0
      timeout: 3000ms
      lettuce:
        pool:
          max-active: 8
          max-idle: 8
          min-idle: 0

# 日志配置
# 注意：使用Log4j2时，日志配置主要在log4j2.xml中
# 这里的配置会被log4j2.xml覆盖
logging:
  level:
    root: INFO
  # Log4j2详细配置在src/main/resources/log4j2.xml中

# 应用配置
server:
  port: 8080
  error:
    whitelabel:
      enabled: false

# MyBatis-Plus 配置
mybatis-plus:
  mapper-locations: classpath*:/mapper/**/*.xml
  configuration:
    map-underscore-to-camel-case: true
    # log-impl: org.apache.ibatis.logging.stdout.StdOutImpl  # 已关闭SQL日志输出
  global-config:
    db-config:
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# 自定义配置
okx:
  api:
    base-url: https://www.okx.com

# 策略触发器测试接口配置（仅用于开发/测试环境）
strategy:
  trigger:
    test-endpoint:
      enabled: false  # 生产环境必须设置为 false

# Actuator配置（用于Metrics）
management:
  endpoints:
    web:
      exposure:
        include: health,info,prometheus
  metrics:
    export:
      prometheus:
        enabled: true
    timeout: 5000
  websocket:
    url: wss://ws.okx.com:8443/ws/v5/business
    connect-timeout-seconds: 15
    proxy:
      enabled: false  # 设置为 true 启用代理
      type: socks5     # socks5 | http
      host: 127.0.0.1
      port: 1080

# QuestDB 配置
questdb:
  # QuestDB使用PostgreSQL协议进行JDBC连接
  # HTTP界面端口：9000
  # JDBC端口：8812（PostgreSQL协议）
  # 重要：必须指定 timezone=UTC，确保时间戳参数以UTC时区传递，避免时区转换问题
  url: jdbc:postgresql://127.0.0.1:8812/qdb?timezone=UTC
  username: admin
  password: quest
  # 连接池配置
  pool:
    max-active: 10
    max-idle: 5
    min-idle: 2
    max-wait: 30000

# HTTP代理配置
http:
  proxy:
    host: 127.0.0.1
    port: 7890
    username: 
    password: 

# 行情数据中心配置
market:
  data:
    # Redis缓存配置
    cache:
      # 默认缓存时长（分钟）
      default-duration-minutes: 60
      # 缓存key前缀
      key-prefix: "market:kline:"

# 校准补拉配置
calibration:
  backfill:
    # cooldown时间（秒），同一个tradingPairId在配置时间内最多触发一次
    cooldownSeconds: 300
    # 回看时间（分钟），默认60分钟
    lookbackMinutes: 60
    # 异步线程池大小，默认4
    asyncPoolSize: 4
    # 最大等待时间（毫秒），用于聚合链路第三次读取，默认500ms
    maxWaitMillis: 500
  gap:
    # 窗口大小（分钟），检测最近N分钟的K线连续性，默认60分钟
    windowMinutes: 60
    # 清理过期数据的间隔（毫秒），默认10分钟
    cleanupIntervalMs: 600000