<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>策略管理 - V2 Trade</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/layui@2.9.21/dist/css/layui.css">
    <style>
        /* ==================== CSS 变量定义 ==================== */
        :root {
            --primary-color: #1e9fff;
            --primary-hover: #1890ff;
            --success-color: #52c41a;
            --warning-color: #fa8c16;
            --danger-color: #ff4d4f;
            --text-primary: #262626;
            --text-secondary: #595959;
            --text-tertiary: #8c8c8c;
            --border-color: #e8eaed;
            --bg-primary: #ffffff;
            --bg-secondary: #fafbfc;
            --bg-tertiary: #f5f7fa;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.06);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 6px 16px rgba(0,0,0,0.1);
            --radius-sm: 4px;
            --radius-md: 8px;
            --radius-lg: 10px;
            --spacing-xs: 8px;
            --spacing-sm: 12px;
            --spacing-md: 16px;
            --spacing-lg: 20px;
            --spacing-xl: 24px;
        }

        /* ==================== 基础样式 ==================== */
        body { margin: 0; padding: 0; background: var(--bg-tertiary); }
        .layui-layout-admin .layui-header { background-color: #23262E; }
        .layui-logo { color: #fff; font-size: 18px; font-weight: bold; }
        .layui-logo span { color: var(--primary-color); }
        .layui-body { background: var(--bg-tertiary); }
        .strategy-container { padding: var(--spacing-lg); }

        /* ==================== 统计卡片区域 ==================== */
        .stats-box {
            display: flex;
            gap: var(--spacing-xl);
            margin-bottom: var(--spacing-xl);
            flex-wrap: wrap;
        }
        
        .stat-card {
            background: var(--bg-primary);
            padding: var(--spacing-lg) var(--spacing-xl);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary-color);
            min-width: 160px;
            flex: 1;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-card:nth-child(1) { border-left-color: #1a73e8; }
        .stat-card:nth-child(2) { border-left-color: var(--success-color); }
        .stat-card:nth-child(3) { border-left-color: var(--warning-color); }
        .stat-card:nth-child(4) { border-left-color: var(--primary-color); }
        
        .stat-card .num {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
            line-height: 1.2;
            margin-bottom: var(--spacing-xs);
        }
        
        .stat-card:nth-child(1) .num { color: #1a73e8; }
        .stat-card:nth-child(2) .num { color: var(--success-color); }
        .stat-card:nth-child(3) .num { color: var(--warning-color); }
        .stat-card:nth-child(4) .num { color: var(--primary-color); }
        
        .stat-card .label {
            color: var(--text-tertiary);
            font-size: 13px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* ==================== 筛选和操作栏 ==================== */
        .toolbar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-md) var(--spacing-lg);
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            flex-wrap: wrap;
            gap: var(--spacing-md);
        }
        
        .toolbar-left {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        
        .toolbar-right {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }
        
        .toolbar .layui-form {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            margin: 0;
        }
        
        .toolbar .layui-form-item {
            margin-bottom: 0;
        }
        
        .toolbar .layui-form-label {
            padding: 0 var(--spacing-sm) 0 0;
            width: auto;
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .toolbar .layui-input,
        .toolbar .layui-select {
            height: 32px;
            line-height: 32px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            font-size: 13px;
        }
        
        .toolbar .layui-input:focus,
        .toolbar .layui-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(30, 159, 255, 0.1);
        }

        /* ==================== 卡片样式 ==================== */
        .layui-card {
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: none;
            margin-bottom: var(--spacing-lg);
        }
        
        .layui-card-header {
            border-bottom: 1px solid var(--border-color);
            padding: var(--spacing-md) var(--spacing-lg);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .layui-card-body {
            padding: var(--spacing-lg);
        }

        /* ==================== 表格优化 ==================== */
        .layui-table {
            border-radius: var(--radius-md);
            overflow: hidden;
        }
        
        .layui-table thead tr {
            background: var(--bg-secondary);
        }
        
        .layui-table thead th {
            font-weight: 600;
            color: var(--text-primary);
            padding: var(--spacing-md);
        }
        
        .layui-table tbody td {
            padding: var(--spacing-md);
            border-bottom: 1px solid #f0f0f0;
        }
        
        .layui-table tbody tr:hover {
            background: #fafafa;
        }
        
        /* 状态点样式 */
        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
            vertical-align: middle;
        }
        
        .status-dot.enabled { background-color: var(--success-color); }
        .status-dot.disabled { background-color: var(--text-tertiary); }

        /* ==================== 表单配置卡片（精致化） ==================== */
        .config-card {
            background: #ffffff;
            border-radius: 6px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            border: 1px solid #eef0f2;
            border-left: 3px solid var(--primary-color);
            border-right: 3px solid var(--primary-color);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .config-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
        }
        
        .config-card h2 {
            margin: 0 0 20px 0;
            font-size: 15px;
            font-weight: 600;
            color: #333333;
            padding: 0;
            border: none;
            display: flex;
            align-items: center;
            line-height: 1.5;
        }
        
        .config-card h2 i {
            margin-right: 8px;
            font-size: 14px;
            color: #666666;
        }

        /* ==================== 表单字段优化（紧凑化） ==================== */
        .form-row {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }
        
        .form-row:last-child {
            margin-bottom: 0;
        }
        
        .form-field {
            flex: 1;
            min-width: 180px;
        }
        
        .form-field label {
            display: block;
            font-size: 12px;
            color: #888888;
            margin-bottom: 6px;
            font-weight: 400;
            line-height: 1.5;
        }
        
        .form-field label i {
            margin-right: 4px;
            font-size: 12px;
            color: #999999;
        }
        
        .form-field .layui-input,
        .form-field .layui-select {
            height: 32px;
            line-height: 32px;
            border-radius: 4px;
            border: 1px solid #e8eaed;
            transition: all 0.3s ease;
            font-size: 13px;
            padding: 0 12px;
        }
        
        /* Layui Select 组件样式覆盖 */
        .form-field .layui-form-select {
            height: 32px;
            line-height: 32px;
            width: 100%;
        }
        
        .form-field .layui-form-select .layui-input {
            height: 32px;
            line-height: 32px;
            font-size: 13px;
            padding: 0 12px;
            width: 100%;
            box-sizing: border-box;
        }
        
        .form-field .layui-form-select .layui-edge {
            top: 12px;
            right: 10px;
        }
        
        /* 确保下拉框选项可以正常显示 */
        .form-field .layui-form-select {
            position: relative;
            z-index: 1;
        }
        
        .form-field .layui-form-select dl {
            z-index: 999999 !important;
            max-height: 200px;
            overflow-y: auto;
            position: absolute !important;
            top: 100% !important;
            left: 0 !important;
            width: 100% !important;
        }
        
        /* 弹窗内的下拉框确保显示 */
        #createStrategyForm .form-field .layui-form-select {
            position: relative;
            z-index: 10;
        }
        
        #createStrategyForm .form-field .layui-form-select dl {
            z-index: 999999 !important;
        }
        
        /* 弹窗层设置滚动 */
        .layui-layer-content {
            overflow-y: auto !important;
            overflow-x: hidden !important;
            max-height: 95vh !important;
        }
        
        .layui-layer-content #createStrategyForm {
            overflow: visible !important;
        }
        
        /* 确保下拉框在滚动容器内也能正常显示 */
        .layui-layer-content .layui-form-select dl {
            z-index: 999999 !important;
        }
        
        .form-field .layui-input:focus,
        .form-field .layui-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(30, 159, 255, 0.08);
            outline: none;
        }
        
        .form-field .layui-input:hover,
        .form-field .layui-select:hover {
            border-color: #d0d4d8;
        }
        
        .form-field .layui-textarea {
            height: auto;
            min-height: 140px;
            line-height: 1.6;
            border-radius: 4px;
            border: 1px solid #e8eaed;
            transition: all 0.3s ease;
            font-size: 13px;
            padding: 12px;
        }
        
        .form-field .layui-textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(30, 159, 255, 0.08);
            outline: none;
        }

        /* ==================== JSON 编辑器样式（代码编辑器风格） ==================== */
        .json-editor {
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            background: #1e1e1e;
            border: 1px solid #3c3c3c;
            border-radius: 4px;
            padding: 16px;
            color: #9cdcfe;
            line-height: 1.8;
            resize: vertical;
        }
        
        .json-editor::placeholder {
            color: #6a9955;
            opacity: 0.7;
        }
        
        .json-editor:focus {
            background: #1e1e1e;
            border-color: #4a9eff;
            box-shadow: 0 0 0 2px rgba(74, 158, 255, 0.2);
            outline: none;
        }

        /* ==================== 表格容器（精致化） ==================== */
        .table-container {
            max-height: 280px;
            overflow-y: auto;
            overflow-x: hidden;
            border: 1px solid #eef0f2;
            border-radius: 4px;
            background: #ffffff;
        }
        
        /* 弹窗内的表格容器使用更小的高度 */
        #createStrategyForm .table-container {
            max-height: 200px;
        }
        
        .table-container .layui-table {
            margin: 0;
            border: none;
        }
        
        .table-container .layui-table thead th {
            background: #fafbfc;
            font-size: 12px;
            color: #666666;
            font-weight: 500;
            padding: 10px 12px;
        }
        
        .table-container .layui-table tbody td {
            font-size: 13px;
            padding: 10px 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .table-container .layui-table tbody tr:hover {
            background: #fafbfc;
        }

        /* ==================== 添加控件（紧凑化） ==================== */
        .add-controls {
            display: flex;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }
        
        .add-controls select {
            flex: 1;
            height: 32px;
            line-height: 32px;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .add-controls .layui-form-select {
            flex: 1;
            height: 32px;
            line-height: 32px;
        }
        
        .add-controls .layui-form-select .layui-input {
            height: 32px;
            line-height: 32px;
            font-size: 13px;
        }
        
        .add-controls .layui-form-select .layui-edge {
            top: 12px;
        }

        /* ==================== 按钮优化（精致化） ==================== */
        .layui-btn {
            border-radius: 4px;
            transition: all 0.3s ease;
            height: 32px;
            line-height: 32px;
            padding: 0 16px;
            font-size: 13px;
        }
        
        .layui-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.12);
            filter: brightness(1.05);
        }
        
        .layui-btn-normal {
            background-color: var(--primary-color);
        }
        
        .layui-btn-normal:hover {
            background-color: var(--primary-hover);
        }
        
        .layui-btn i {
            font-size: 13px;
            margin-right: 4px;
        }
        
        /* 小按钮优化 */
        .layui-btn-xs {
            height: 26px;
            line-height: 26px;
            padding: 0 10px;
            font-size: 12px;
            border-radius: 4px;
        }
        
        .layui-btn-xs i {
            font-size: 12px;
            margin-right: 3px;
        }
        
        /* Switch 开关优化 */
        .layui-form-switch {
            height: 22px;
            line-height: 22px;
        }
        
        .layui-form-switch i {
            width: 18px;
            height: 18px;
        }
        
        .layui-btn-normal {
            background-color: var(--primary-color);
        }
        
        .layui-btn-normal:hover {
            background-color: var(--primary-hover);
        }

        /* ==================== 弹窗优化（精致化） ==================== */
        #createStrategyForm {
            background: #f5f7fa;
            width: 100%;
            padding: 30px;
            box-sizing: border-box;
        }
        
        #createStrategyForm form {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            box-sizing: border-box;
        }
        
        #createStrategyForm .config-card {
            margin-bottom: 24px;
            width: 100%;
            padding: 24px;
            margin-left: 0;
            margin-right: 0;
            box-sizing: border-box;
        }
        
        /* 确保左右留白一致 */
        #createStrategyForm .config-card {
            padding-left: 24px;
            padding-right: 24px;
        }
        
        #createStrategyForm .form-row {
            width: 100%;
            box-sizing: border-box;
            gap: 16px;
        }
        
        #createStrategyForm .form-field {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 100%;
            overflow: hidden;
        }
        
        #createStrategyForm .form-field .layui-input,
        #createStrategyForm .form-field .layui-select,
        #createStrategyForm .form-field .layui-textarea {
            max-width: 100%;
            overflow: hidden;
        }
        
        /* 确保弹窗内容不超出 */
        #createStrategyForm * {
            box-sizing: border-box;
        }
        
        /* 防止水平滚动，但允许下拉框垂直显示 */
        #createStrategyForm .config-card {
            overflow-x: hidden;
            overflow-y: visible;
        }
        
        #createStrategyForm .form-row {
            overflow-x: hidden;
            overflow-y: visible;
        }
        
        /* 表格容器保留独立滚动（因为表格内容可能很多） */
        #createStrategyForm .table-container {
            overflow-x: hidden;
            overflow-y: auto;
            max-height: 200px;
        }
        
        #createStrategyForm .layui-table {
            table-layout: fixed;
            width: 100%;
        }
        
        #createStrategyForm .layui-table td,
        #createStrategyForm .layui-table th {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        /* 弹窗内表单字段间距优化 */
        #createStrategyForm .form-field label {
            margin-bottom: 6px;
        }
        
        #createStrategyForm .add-controls {
            margin-bottom: 16px;
        }
        
        /* 弹窗内按钮组优化 */
        #createStrategyForm .layui-btn-lg {
            height: 36px;
            line-height: 36px;
            padding: 0 24px;
            font-size: 14px;
        }
        
        /* JSON编辑器区域优化，使其更紧凑 */
        #createStrategyForm .form-row:has(.json-editor) {
            gap: 20px;
        }
        
        #createStrategyForm .form-row:has(.json-editor) .form-field {
            flex: 1;
            min-width: 300px;
        }
        
        #createStrategyForm .json-editor {
            min-height: 100px;
        }
        
        /* 优化表单行间距 */
        #createStrategyForm .form-row {
            margin-bottom: 14px;
        }
        
        #createStrategyForm .config-card h2 {
            margin-bottom: 16px;
        }
        
        /* 禁止内层容器产生滚动条（除了表格容器），但允许下拉框显示 */
        #createStrategyForm .config-card {
            overflow: visible !important;
        }
        
        #createStrategyForm .form-row {
            overflow: visible !important;
        }
        
        #createStrategyForm .form-field {
            overflow: visible !important;
        }
        
        #createStrategyForm .add-controls {
            overflow-y: visible !important;
        }
        
        /* ==================== 空状态优化（精致化） ==================== */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #999999;
        }
        
        .empty-state i {
            font-size: 36px;
            display: block;
            margin-bottom: 12px;
            opacity: 0.4;
            color: #cccccc;
        }
        
        .empty-state div {
            font-size: 13px;
            color: #999999;
        }
        
        /* ==================== 操作按钮组 ==================== */
        .action-buttons {
            display: flex;
            gap: var(--spacing-xs);
            flex-wrap: wrap;
        }
        
        .action-buttons .layui-btn {
            margin: 0;
        }

        /* ==================== 响应式 ==================== */
        @media (max-width: 768px) {
            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }
            
            .toolbar-left,
            .toolbar-right {
                width: 100%;
                justify-content: flex-start;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-field {
                min-width: 100%;
            }
        }
    </style>
</head>
<body>
<div class="layui-layout layui-layout-admin">
    <div class="layui-header">
        <div class="layui-logo layui-hide-xs"><span>V2</span> Trade</div>
        <ul class="layui-nav layui-layout-left">
            <li class="layui-nav-item layui-show-xs-inline-block layui-hide-sm" lay-header-event="menuLeft">
                <i class="layui-icon layui-icon-spread-left"></i>
            </li>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item layui-hide layui-show-md-inline-block">
                <a href="javascript:;"><i class="layui-icon layui-icon-username"></i><span id="userName">用户</span></a>
                <dl class="layui-nav-child">
                    <dd><a href="/settings.html">个人设置</a></dd>
                    <dd><a href="javascript:;" onclick="logout()">退出登录</a></dd>
                </dl>
            </li>
        </ul>
    </div>
    <div class="layui-side layui-bg-black">
        <div class="layui-side-scroll">
            <ul class="layui-nav layui-nav-tree" lay-filter="sideNav">
                <li class="layui-nav-item">
                    <a href="javascript:;">系统管理</a>
                    <dl class="layui-nav-child">
                        <dd><a href="/users.html">用户管理</a></dd>
                        <dd><a href="/apikey.html">API密钥管理</a></dd>
                        <dd><a href="/trading-pair.html">交易对管理</a></dd>
                        <dd><a href="/market-subscription-config.html">行情订阅配置管理</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item">
                    <a href="javascript:;">信号模块</a>
                    <dl class="layui-nav-child">
                        <dd><a href="/signal-config.html">信号配置管理</a></dd>
                        <dd><a href="/signal-list.html">信号查询</a></dd>
                    </dl>
                </li>
                <li class="layui-nav-item layui-nav-itemed">
                    <a href="javascript:;">策略模块</a>
                    <dl class="layui-nav-child">
                        <dd class="layui-this"><a href="/strategy.html">策略配置管理</a></dd>
                    </dl>
                </li>
            </ul>
        </div>
    </div>
    <div class="layui-body">
        <div class="strategy-container">
            <!-- 统计卡片区域 -->
            <div class="stats-box">
                <div class="stat-card">
                    <div class="num" id="totalStrategies">0</div>
                    <div class="label">策略总数</div>
                </div>
                <div class="stat-card">
                    <div class="num" id="enabledStrategies">0</div>
                    <div class="label">运行中</div>
                </div>
                <div class="stat-card">
                    <div class="num" id="disabledStrategies">0</div>
                    <div class="label">已禁用</div>
                </div>
                <div class="stat-card">
                    <div class="num" id="signalStrategies">0</div>
                    <div class="label">信号驱动</div>
                </div>
            </div>

            <!-- 工具栏：筛选和操作 -->
            <div class="toolbar">
                <div class="toolbar-left">
                    <form class="layui-form" lay-filter="filterForm">
                        <div class="layui-form-item" style="margin-bottom: 0;">
                            <select name="filter" lay-filter="filterAll" style="width: 250px;">
                                <option value="">全部策略</option>
                                <optgroup label="按类型筛选">
                                    <option value="type:SIGNAL_DRIVEN">信号驱动</option>
                                    <option value="type:INDICATOR_DRIVEN">指标驱动</option>
                                    <option value="type:HYBRID">混合策略</option>
                                </optgroup>
                                <optgroup label="按状态筛选">
                                    <option value="status:1">启用</option>
                                    <option value="status:0">禁用</option>
                                </optgroup>
                            </select>
                        </div>
                        <div class="layui-form-item" style="margin-bottom: 0;">
                            <input type="text" name="keyword" placeholder="搜索策略名称..." class="layui-input" style="width: 200px;" id="searchKeyword">
                        </div>
                    </form>
                </div>
                <div class="toolbar-right">
                    <button class="layui-btn layui-btn-normal" onclick="openCreateStrategy()">
                        <i class="layui-icon layui-icon-add-1"></i> 创建策略
                    </button>
                </div>
            </div>

            <!-- 策略列表卡片 -->
            <div class="layui-card">
                <div class="layui-card-header">
                    <i class="layui-icon layui-icon-list"></i> 策略列表
                </div>
                <div class="layui-card-body" style="padding: 0;">
                    <table class="layui-table" lay-skin="line">
                        <thead>
                            <tr>
                                <th width="80">ID</th>
                                <th>策略名称</th>
                                <th width="140">策略类型</th>
                                <th width="140">决策模式</th>
                                <th width="100">状态</th>
                                <th width="160">创建时间</th>
                                <th width="200">操作</th>
                            </tr>
                        </thead>
                        <tbody id="strategyList"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-footer">© 2024 V2 Trade - 交易管理系统</div>
</div>

<!-- 创建策略完整表单弹窗 -->
<div id="createStrategyForm" style="display: none;">
    <form class="layui-form" lay-filter="createStrategyForm" style="width: 100%; max-width: 100%;">
        <input type="hidden" name="strategyId" id="createStrategyId">
        <!-- 1. 策略定义 -->
        <div class="config-card">
            <h2>1. 策略定义</h2>
            <div class="form-row">
                <div class="form-field">
                    <label>策略名称</label>
                    <input type="text" name="strategyName" lay-verify="required" placeholder="如：BTC 趋势跟随策略" class="layui-input">
                </div>
                <div class="form-field">
                    <label>策略类型</label>
                    <select name="strategyType" lay-verify="required" lay-search>
                        <option value="">请选择策略类型</option>
                        <option value="SIGNAL_DRIVEN">SIGNAL_DRIVEN（信号驱动）</option>
                        <option value="INDICATOR_DRIVEN">INDICATOR_DRIVEN（指标驱动）</option>
                        <option value="HYBRID">HYBRID（混合）</option>
                    </select>
                </div>
                <div class="form-field">
                    <label>决策模式 (decision_mode)</label>
                    <select name="decisionMode" lay-search>
                        <option value="">请选择决策模式（可选）</option>
                        <option value="FOLLOW_SIGNAL">FOLLOW_SIGNAL（完全跟随信号）</option>
                        <option value="INTENT_DRIVEN">INTENT_DRIVEN（基于当前有效意图）</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 2. 策略参数 -->
        <div class="config-card">
            <h2>2. 策略参数</h2>
            <div class="form-row">
                <div class="form-field">
                    <label>初始虚拟资金</label>
                    <input type="number" name="initialCapital" lay-verify="required" placeholder="10000" class="layui-input" step="0.00000001">
                </div>
                <div class="form-field">
                    <label>单次下单资金占比</label>
                    <input type="number" name="baseOrderRatio" lay-verify="required" placeholder="0.1" class="layui-input" step="0.01" min="0" max="1">
                </div>
                <div class="form-field">
                    <label>兜底止盈比例</label>
                    <input type="number" name="takeProfitRatio" placeholder="0.05" class="layui-input" step="0.01">
                </div>
                <div class="form-field">
                    <label>兜底止损比例</label>
                    <input type="number" name="stopLossRatio" placeholder="0.02" class="layui-input" step="0.01">
                </div>
            </div>
            <div class="form-row">
                <div class="form-field">
                    <label>入场条件（JSON）</label>
                    <textarea name="entryCondition" class="layui-textarea json-editor" rows="6" placeholder='{"mode":"ANY","rules":[]}'>{"mode":"ANY","rules":[]}</textarea>
                </div>
                <div class="form-field">
                    <label>退出条件（JSON）</label>
                    <textarea name="exitCondition" class="layui-textarea json-editor" rows="6" placeholder='{"mode":"ANY","rules":[]}'>{"mode":"ANY","rules":[]}</textarea>
                </div>
            </div>
        </div>

        <!-- 3. 策略交易对 -->
        <div class="config-card">
            <h2>3. 策略交易对</h2>
            <div class="add-controls">
                <select id="tradingPairSelect" lay-search>
                    <option value="">请选择交易对</option>
                </select>
                <button type="button" class="layui-btn layui-btn-normal" onclick="addTradingPair()">
                    <i class="layui-icon layui-icon-add-1"></i>添加
                </button>
            </div>
            <div class="table-container">
                <table class="layui-table">
                    <thead>
                        <tr>
                            <th>交易对</th>
                            <th>市场类型</th>
                            <th>启用</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="selectedTradingPairTableBody">
                        <tr>
                            <td colspan="4" class="empty-state">
                                <i class="layui-icon layui-icon-add-circle"></i>
                                <div>暂无交易对，请添加</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 4. 策略信号源订阅 -->
        <div class="config-card">
            <h2>4. 策略信号源订阅</h2>
            <div class="add-controls">
                <select id="signalConfigSelect" lay-search>
                    <option value="">请选择信号源</option>
                </select>
                <button type="button" class="layui-btn layui-btn-normal" onclick="addSignalConfig()">
                    <i class="layui-icon layui-icon-add-1"></i>添加
                </button>
            </div>
            <div class="table-container">
                <table class="layui-table">
                    <thead>
                        <tr>
                            <th>信号名称</th>
                            <th>来源</th>
                            <th>消费模式</th>
                            <th>启用</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="selectedSignalConfigTableBody">
                        <tr>
                            <td colspan="5" class="empty-state">
                                <i class="layui-icon layui-icon-add-circle"></i>
                                <div>暂无信号源，请添加</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #eef0f2; text-align: center;">
            <button type="submit" class="layui-btn layui-btn-lg layui-btn-normal" lay-submit lay-filter="submitCreateStrategy">
                <i class="layui-icon layui-icon-ok"></i>保存策略
            </button>
            <button type="button" class="layui-btn layui-btn-lg layui-btn-primary" onclick="layer.closeAll('page')" style="margin-left: 12px;">
                <i class="layui-icon layui-icon-close"></i>取消
            </button>
        </div>
    </form>
</div>

<!-- 策略详情弹窗（只读） -->
<div id="strategyDetailForm" style="display: none;">
    <div style="width: 100%; max-width: 100%;">
        <!-- 1. 策略定义 -->
        <div class="config-card">
            <h2>1. 策略定义</h2>
            <div class="form-row">
                <div class="form-field">
                    <label>策略名称</label>
                    <div class="layui-input" style="background: #f5f7fa; color: #262626;" id="detailStrategyName">-</div>
                </div>
                <div class="form-field">
                    <label>策略类型</label>
                    <div class="layui-input" style="background: #f5f7fa; color: #262626;" id="detailStrategyType">-</div>
                </div>
                <div class="form-field">
                    <label>决策模式 (decision_mode)</label>
                    <div class="layui-input" style="background: #f5f7fa; color: #262626;" id="detailDecisionMode">-</div>
                </div>
            </div>
        </div>

        <!-- 2. 策略参数 -->
        <div class="config-card">
            <h2>2. 策略参数</h2>
            <div class="form-row">
                <div class="form-field">
                    <label>初始虚拟资金</label>
                    <div class="layui-input" style="background: #f5f7fa; color: #262626;" id="detailInitialCapital">-</div>
                </div>
                <div class="form-field">
                    <label>单次下单资金占比</label>
                    <div class="layui-input" style="background: #f5f7fa; color: #262626;" id="detailBaseOrderRatio">-</div>
                </div>
                <div class="form-field">
                    <label>兜底止盈比例</label>
                    <div class="layui-input" style="background: #f5f7fa; color: #262626;" id="detailTakeProfitRatio">-</div>
                </div>
                <div class="form-field">
                    <label>兜底止损比例</label>
                    <div class="layui-input" style="background: #f5f7fa; color: #262626;" id="detailStopLossRatio">-</div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-field">
                    <label>入场条件（JSON）</label>
                    <textarea class="layui-textarea json-editor" rows="6" readonly style="background: #1e1e1e; color: #d4d4d4;" id="detailEntryCondition">-</textarea>
                </div>
                <div class="form-field">
                    <label>退出条件（JSON）</label>
                    <textarea class="layui-textarea json-editor" rows="6" readonly style="background: #1e1e1e; color: #d4d4d4;" id="detailExitCondition">-</textarea>
                </div>
            </div>
        </div>

        <!-- 3. 策略交易对 -->
        <div class="config-card">
            <h2>3. 策略交易对</h2>
            <div class="table-container">
                <table class="layui-table">
                    <thead>
                        <tr>
                            <th>交易对</th>
                            <th>市场类型</th>
                            <th>启用</th>
                        </tr>
                    </thead>
                    <tbody id="detailTradingPairTableBody">
                        <tr>
                            <td colspan="3" class="empty-state">
                                <i class="layui-icon layui-icon-file"></i>
                                <div>暂无交易对</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 4. 策略信号源订阅 -->
        <div class="config-card">
            <h2>4. 策略信号源订阅</h2>
            <div class="table-container">
                <table class="layui-table">
                    <thead>
                        <tr>
                            <th>信号名称</th>
                            <th>来源</th>
                            <th>消费模式</th>
                            <th>启用</th>
                        </tr>
                    </thead>
                    <tbody id="detailSignalConfigTableBody">
                        <tr>
                            <td colspan="4" class="empty-state">
                                <i class="layui-icon layui-icon-file"></i>
                                <div>暂无信号源</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #eef0f2; text-align: center;">
            <button type="button" class="layui-btn layui-btn-lg layui-btn-primary" onclick="layer.closeAll('page')">
                <i class="layui-icon layui-icon-close"></i>关闭
            </button>
        </div>
    </div>
</div>

<!-- 编辑策略完整表单弹窗 -->
<div id="editStrategyForm" style="display: none;">
    <form class="layui-form" lay-filter="editStrategyForm" style="width: 100%; max-width: 100%;">
        <input type="hidden" name="strategyId" id="editStrategyId">
        
        <!-- 1. 策略定义 -->
        <div class="config-card">
            <h2>1. 策略定义</h2>
            <div class="form-row">
                <div class="form-field">
                    <label>策略名称</label>
                    <input type="text" name="strategyName" lay-verify="required" placeholder="如：BTC 趋势跟随策略" class="layui-input">
                </div>
                <div class="form-field">
                    <label>策略类型</label>
                    <select name="strategyType" lay-verify="required" lay-search>
                        <option value="">请选择策略类型</option>
                        <option value="SIGNAL_DRIVEN">SIGNAL_DRIVEN（信号驱动）</option>
                        <option value="INDICATOR_DRIVEN">INDICATOR_DRIVEN（指标驱动）</option>
                        <option value="HYBRID">HYBRID（混合）</option>
                    </select>
                </div>
                <div class="form-field">
                    <label>决策模式 (decision_mode)</label>
                    <select name="decisionMode" lay-search>
                        <option value="">请选择决策模式（可选）</option>
                        <option value="FOLLOW_SIGNAL">FOLLOW_SIGNAL（完全跟随信号）</option>
                        <option value="INTENT_DRIVEN">INTENT_DRIVEN（基于当前有效意图）</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- 2. 策略参数 -->
        <div class="config-card">
            <h2>2. 策略参数</h2>
            <div class="form-row">
                <div class="form-field">
                    <label>初始虚拟资金</label>
                    <input type="number" name="initialCapital" lay-verify="required" placeholder="10000" class="layui-input" step="0.00000001">
                </div>
                <div class="form-field">
                    <label>单次下单资金占比</label>
                    <input type="number" name="baseOrderRatio" lay-verify="required" placeholder="0.1" class="layui-input" step="0.01" min="0" max="1">
                </div>
                <div class="form-field">
                    <label>兜底止盈比例</label>
                    <input type="number" name="takeProfitRatio" placeholder="0.05" class="layui-input" step="0.01">
                </div>
                <div class="form-field">
                    <label>兜底止损比例</label>
                    <input type="number" name="stopLossRatio" placeholder="0.02" class="layui-input" step="0.01">
                </div>
            </div>
            <div class="form-row">
                <div class="form-field">
                    <label>入场条件（JSON）</label>
                    <textarea name="entryCondition" class="layui-textarea json-editor" rows="6" placeholder='{"mode":"ANY","rules":[]}'>{"mode":"ANY","rules":[]}</textarea>
                </div>
                <div class="form-field">
                    <label>退出条件（JSON）</label>
                    <textarea name="exitCondition" class="layui-textarea json-editor" rows="6" placeholder='{"mode":"ANY","rules":[]}'>{"mode":"ANY","rules":[]}</textarea>
                </div>
            </div>
        </div>

        <!-- 3. 策略交易对 -->
        <div class="config-card">
            <h2>3. 策略交易对</h2>
            <div class="add-controls">
                <select id="editTradingPairSelect" lay-search>
                    <option value="">请选择交易对</option>
                </select>
                <button type="button" class="layui-btn layui-btn-normal" onclick="addEditTradingPair()">
                    <i class="layui-icon layui-icon-add-1"></i>添加
                </button>
            </div>
            <div class="table-container">
                <table class="layui-table">
                    <thead>
                        <tr>
                            <th>交易对</th>
                            <th>市场类型</th>
                            <th>启用</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="editSelectedTradingPairTableBody">
                        <tr>
                            <td colspan="4" class="empty-state">
                                <i class="layui-icon layui-icon-add-circle"></i>
                                <div>暂无交易对，请添加</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 4. 策略信号源订阅 -->
        <div class="config-card">
            <h2>4. 策略信号源订阅</h2>
            <div class="add-controls">
                <select id="editSignalConfigSelect" lay-search>
                    <option value="">请选择信号源</option>
                </select>
                <button type="button" class="layui-btn layui-btn-normal" onclick="addEditSignalConfig()">
                    <i class="layui-icon layui-icon-add-1"></i>添加
                </button>
            </div>
            <div class="table-container">
                <table class="layui-table">
                    <thead>
                        <tr>
                            <th>信号名称</th>
                            <th>来源</th>
                            <th>消费模式</th>
                            <th>启用</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="editSelectedSignalConfigTableBody">
                        <tr>
                            <td colspan="5" class="empty-state">
                                <i class="layui-icon layui-icon-add-circle"></i>
                                <div>暂无信号源，请添加</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #eef0f2; text-align: center;">
            <button type="submit" class="layui-btn layui-btn-lg layui-btn-normal" lay-submit lay-filter="submitEditStrategy">
                <i class="layui-icon layui-icon-ok"></i>保存策略
            </button>
            <button type="button" class="layui-btn layui-btn-lg layui-btn-primary" onclick="layer.closeAll('page')" style="margin-left: 12px;">
                <i class="layui-icon layui-icon-close"></i>取消
            </button>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/layui@2.9.21/dist/layui.js"></script>
<script src="/js/common.js"></script>
<script src="/js/strategy.js"></script>
</body>
</html>
