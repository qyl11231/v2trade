Step 1：产品经理要交代的“范围与边界”

N1 只做管理闭环，不做运行态

交付：策略定义 CRUD、策略实例 CRUD、启停、版本历史（实例更新产生历史）。

不做：下单执行、风控引擎、实时行情/仓位、运行监控面板（这些是 N2+）。

核心用户路径必须打通

策略定义列表 → 创建策略 → 进入策略详情 → 创建实例 → 查看实例详情 → 编辑实例 → 查看历史版本。

字段口径必须严格对齐

definition：strategyName / strategyType / strategyPattern / enabled

instance：strategyId / tradingPairId / signalConfigId / initialCapital / takeProfitRatio / stopLossRatio / runtimeRules / enabled / version

注意：signalConfigId 为 null 时在前端要归一为 0（未绑定）展示与提交。

Step 2：前端架构师要交代的“工程化落地方式”

路由与页面拆分建议

/strategies：策略定义列表页

/strategies/:id：策略定义详情页（含实例列表）

/instances：实例总览页（可选但强烈建议）

/instances/:id：实例详情页

/instances/:id/history：实例历史页

状态管理与请求层

请求层统一封装：api.get/post/put/patch，要有错误码统一处理（toast + 可追踪）。

列表查询统一走 query params：?enabled=1&keyword=xxx&page=1&pageSize=20

表单提交做“乐观 UI”可以，但必须保证失败回滚（尤其启停）。

组件拆分建议（提高复用）

<DefinitionTable />、<DefinitionFormModal />

<InstanceTable />、<InstanceFormModal />

<StatusBadge enabled />、<ConfirmDialog />

<HistoryTable />

表单校验一定要前置

不要把所有校验都丢给后端；至少要做到“用户一看就知道怎么改”。

Step 3：交互设计师要交代的“交互细节与一致性”

启停必须二次确认

文案建议：

启用：确认启用该策略/实例？

禁用：禁用后不会参与后续事件路由，确认禁用？

成功后：toast + 刷新当前列表/卡片状态（避免用户误解没生效）。

创建/编辑弹窗的体验

编辑时必须回填所有字段（包含 null/0 映射的 signalConfigId）。

提交中按钮进入 loading 禁用，防止重复提交。

提交失败显示：简短原因 + 必要时“查看详情”展开（用于后端错误信息）。

历史版本的展示

默认只展示关键字段：资金、TP/SL、pairId、signalId、版本号、时间。

点击展开才显示 runtimeRules 全量（避免列表太长）。

Step 4：数据/接口同学要交代的“联调契约”

接口契约要写清楚（最容易踩坑）

enabled：前端用 boolean 展示，但请求/响应里可能是 0/1，要统一转换策略。

signalConfigId：null → 0，后端如果返回 null，前端也要 normalize。

version：更新实例成功后要拿到新的 version（用于提示与历史跳转）。

唯一性冲突要可读

后端若返回冲突错误码/信息，前端 toast 文案要能定位到冲突维度：
同一策略 + 交易对 + 信号配置 已存在实例

前端最好在提交前也做一次“本地判重”（体验更好），但最终以服务端为准。

分页、排序、筛选

最低要求：列表能分页。

推荐：按更新时间倒序；筛选 enabled + keyword 搜索。

Step 5：测试负责人要交代的“必测用例（N1 DoD）”

策略定义

创建成功/失败（重名）

编辑成功/失败（改为已有名称）

启停成功/取消确认/失败回滚

列表筛选 enabled、搜索

策略实例

创建实例：signal=0 与 signal≠0 两种

唯一性冲突（同 user+strategy+pair+signal）

initialCapital <=0 拦截

TP/SL 越界（<0 或 >1）拦截

编辑实例后：version +1，历史新增一条

启停实例：成功/失败/回滚

历史版本

无历史时提示正确

有历史时展开详情字段正确（包含 runtimeRules）

Step 6：我会特别提醒开发的“高概率坑位”

0 和 null 的双向一致性

展示：0 = 未绑定

提交：如果用户选未绑定，提交必须是 0（不要提交 null）

启停的权限与联动

后端可能限制“禁用策略时是否允许启用实例”，N1 先按“互不强制联动”做，但前端要预留后端规则的错误提示。

版本历史的存储策略

强烈建议后端返回 historyId 或 previousVersionSnapshot 的访问方式，前端不要自己拼字段；但 N1 前端至少要能展示列表。

runtimeRules 的编辑安全

N1 可以当纯文本，但要提醒：未来可能 JSON schema 校验；因此组件上最好预留 “格式化/校验”入口。

总结（交付给开发的 DoD 清单）

✅ 路由与页面：定义列表/详情、实例列表/详情、历史页齐全

✅ CRUD：策略定义与实例均支持创建、编辑、查询

✅ 启停：definition/instance 均二次确认、失败回滚、成功刷新

✅ 校验：资金>0；TP/SL 0~1；必填字段；signal null→0

✅ 唯一性冲突：前端可读提示 + 服务端兜底

✅ 历史版本：更新实例后 version+1 且历史新增一条，页面可查看