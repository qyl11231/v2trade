# ğŸ“‹ å®æ—¶ä»·æ ¼è®¢é˜…æ¨¡å— - ä»»åŠ¡æ‹†è§£

> **ç‰ˆæœ¬**ï¼šv1.0  
> **çŠ¶æ€**ï¼šå¾…å¼€å§‹  
> **é¢„è®¡æ€»å·¥æœŸ**ï¼š8å¤©  
> **åŸºäºæ–‡æ¡£**ï¼š`å®æ—¶ä»·æ ¼è®¢é˜…-è®¾è®¡å¼€å‘è§„èŒƒ.md`

---

## ğŸ“Š ä»»åŠ¡æ€»è§ˆ

| Phase | é˜¶æ®µåç§° | ä»»åŠ¡æ•° | é¢„è®¡å·¥æœŸ | çŠ¶æ€ | å®Œæˆæ—¶é—´ | ä¸‹ä¸€é˜¶æ®µå¼€å¯ |
|-------|---------|--------|---------|------|---------|------------|
| Phase 1 | åŸºç¡€æ•°æ®æ¨¡å‹ | 3 | 1.5å¤© | âœ… å·²å®Œæˆ  | 2025-01-05 | Phase 1å®Œæˆ |
| Phase 2 | æ ¸å¿ƒæœåŠ¡å®ç° | 4 | 3å¤© | âœ… å·²å®Œæˆ | 2025-01-05 | Phase 2å®Œæˆ |
| Phase 3 | æ¥å£å’Œé›†æˆ | 2 | 1.5å¤© | âœ… å·²å®Œæˆ | 2025-01-05 | Phase 3å®Œæˆ |
| Phase 4 | æµ‹è¯•å’Œä¼˜åŒ– | 2 | 1.5å¤© | ğŸ”’ å·²é”å®š | - | ç­‰å¾…Phase 4å®Œæˆ |
| **æ€»è®¡** | | **12** | **8å¤©** | | | |

### é˜¶æ®µå¼€å¯è§„åˆ™

**é˜¶æ®µçŠ¶æ€è¯´æ˜**ï¼š
- â³ **å¾…å¼€å§‹**ï¼šé˜¶æ®µå°šæœªå¼€å§‹ï¼Œå¯ä»¥å¼€å§‹å¼€å‘
- ğŸ”„ **è¿›è¡Œä¸­**ï¼šé˜¶æ®µæ­£åœ¨è¿›è¡Œä¸­
- âœ… **å·²å®Œæˆ**ï¼šé˜¶æ®µæ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ
- ğŸ”’ **å·²é”å®š**ï¼šç­‰å¾…å‰ç½®é˜¶æ®µå®Œæˆï¼Œæ— æ³•å¼€å§‹

**å¼€å¯ä¸‹ä¸€é˜¶æ®µ**ï¼š
- å½“å‰é˜¶æ®µæ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼ŒçŠ¶æ€è‡ªåŠ¨å˜ä¸º"âœ… å·²å®Œæˆ"
- éœ€è¦**æ˜ç¡®åŒæ„**æ‰èƒ½å¼€å¯ä¸‹ä¸€é˜¶æ®µ
- åŒæ„æ–¹å¼ï¼šåœ¨æ–‡æ¡£ä¸­æ ‡è®°"âœ… åŒæ„å¼€å¯ä¸‹ä¸€é˜¶æ®µ"
- å¼€å¯åï¼Œä¸‹ä¸€é˜¶æ®µçŠ¶æ€å˜ä¸º"â³ å¾…å¼€å§‹"

**é˜¶æ®µä¾èµ–å…³ç³»**ï¼š
- Phase 2 ä¾èµ– Phase 1 å®Œæˆ
- Phase 3 ä¾èµ– Phase 2 å®Œæˆ
- Phase 4 ä¾èµ– Phase 3 å®Œæˆ

---

## Phase 1: åŸºç¡€æ•°æ®æ¨¡å‹ï¼ˆ1.5å¤©ï¼‰

**é˜¶æ®µçŠ¶æ€**ï¼šâœ… å·²å®Œæˆ  
**å‰ç½®æ¡ä»¶**ï¼šæ—   
**å®Œæˆæ¡ä»¶**ï¼šæ‰€æœ‰ä»»åŠ¡éªŒæ”¶é€šè¿‡  
**å¼€å¯ä¸‹ä¸€é˜¶æ®µ**ï¼šâœ… åŒæ„å¼€å¯ä¸‹ä¸€é˜¶æ®µï¼ˆPhase 2ï¼‰- å·²åŒæ„ï¼ˆ2025-01-05ï¼‰

---

### ä»»åŠ¡1.1ï¼šåˆ›å»ºäº‹ä»¶æ¨¡å‹å’ŒçŠ¶æ€æ¨¡å‹

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š0.5å¤©  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆé˜»å¡ï¼‰

#### ä»»åŠ¡æè¿°
åˆ›å»ºä»·æ ¼è®¢é˜…æ¨¡å—çš„æ ¸å¿ƒæ•°æ®æ¨¡å‹ï¼šPriceTickï¼ˆå†…éƒ¨äº‹ä»¶ï¼‰ã€LatestPriceï¼ˆçŠ¶æ€æ¨¡å‹ï¼‰ã€PriceChangedEventï¼ˆå¯¹å¤–äº‹ä»¶ï¼‰ã€‚

#### å…·ä½“æ­¥éª¤

1. **åˆ›å»ºPriceTickäº‹ä»¶æ¨¡å‹**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/model/event/PriceTick.java`
   - å­—æ®µï¼šsymbolï¼ˆStringï¼‰, priceï¼ˆBigDecimalï¼‰, timestampï¼ˆlongï¼‰, sourceï¼ˆStringï¼‰
   - è¦æ±‚ï¼šä¸å¯å˜ï¼ˆrecordï¼‰ï¼ŒåŒ…å«of()é™æ€å·¥å‚æ–¹æ³•
   - ä½ç½®ï¼š`com.qyl.v2trade.market.model.event` åŒ…

2. **åˆ›å»ºLatestPriceçŠ¶æ€æ¨¡å‹**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/service/LatestPrice.java`
   - å­—æ®µï¼šsymbolï¼ˆStringï¼‰, priceï¼ˆBigDecimalï¼‰, timestampï¼ˆlongï¼‰
   - è¦æ±‚ï¼šä¸å¯å˜ï¼ˆrecordï¼‰ï¼ŒåŒ…å«of()é™æ€å·¥å‚æ–¹æ³•
   - ä½ç½®ï¼š`com.qyl.v2trade.market.subscription.service` åŒ…

3. **åˆ›å»ºPriceChangedEventå¯¹å¤–äº‹ä»¶**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/model/event/PriceChangedEvent.java`
   - å­—æ®µï¼šsymbolï¼ˆStringï¼‰, priceï¼ˆBigDecimalï¼‰, timestampï¼ˆlongï¼‰
   - è¦æ±‚ï¼šä¸å¯å˜ï¼ˆrecordï¼‰ï¼ŒåŒ…å«of()é™æ€å·¥å‚æ–¹æ³•
   - ä½ç½®ï¼š`com.qyl.v2trade.market.model.event` åŒ…

4. **ç¼–å†™å•å…ƒæµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/model/event/PriceTickTest.java`
   - æµ‹è¯•ç”¨ä¾‹ï¼š
     - recordåŸºæœ¬åŠŸèƒ½ï¼ˆequals, hashCode, toStringï¼‰
     - of()å·¥å‚æ–¹æ³•
     - å­—æ®µéªŒè¯

#### éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰ç±»ç¼–è¯‘é€šè¿‡
- [ ] PriceTickã€LatestPriceã€PriceChangedEventéƒ½æ˜¯recordç±»å‹
- [ ] æ‰€æœ‰recordéƒ½åŒ…å«of()é™æ€å·¥å‚æ–¹æ³•
- [ ] å­—æ®µç±»å‹æ­£ç¡®ï¼ˆpriceä½¿ç”¨BigDecimalï¼Œtimestampä½¿ç”¨longï¼‰
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

#### ä¾èµ–å…³ç³»
- æ— å‰ç½®ä¾èµ–

#### è¾“å‡ºç‰©
- `PriceTick.java`
- `LatestPrice.java`
- `PriceChangedEvent.java`
- `PriceTickTest.java`
- ä»£ç å®¡æŸ¥é€šè¿‡

---

### ä»»åŠ¡1.2ï¼šåˆ›å»ºPriceEventBusæ¥å£å’Œå®ç°

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š0.5å¤©  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆé˜»å¡ï¼‰

#### ä»»åŠ¡æè¿°
åˆ›å»ºç‹¬ç«‹çš„ä»·æ ¼äº‹ä»¶æ€»çº¿ï¼Œç”¨äºåœ¨è®¢é˜…æ¨¡å—å†…éƒ¨ä¼ é€’PriceTickäº‹ä»¶ã€‚

#### å…·ä½“æ­¥éª¤

1. **åˆ›å»ºPriceEventBusæ¥å£**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/collector/eventbus/PriceEventBus.java`
   - æ–¹æ³•ï¼š
     - `void publish(PriceTick tick)`
     - `void subscribe(Consumer<PriceTick> consumer)`
     - `void unsubscribe(Consumer<PriceTick> consumer)`
   - ä½ç½®ï¼š`com.qyl.v2trade.market.subscription.collector.eventbus` åŒ…

2. **åˆ›å»ºSimplePriceEventBuså®ç°**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/collector/eventbus/impl/SimplePriceEventBus.java`
   - ç‰¹æ€§ï¼š
     - ä½¿ç”¨CopyOnWriteArrayListå­˜å‚¨è®¢é˜…è€…ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
     - ä½¿ç”¨ExecutorServiceå¼‚æ­¥æ‰§è¡Œæ¶ˆè´¹è€…
     - å•ä¸ªè®¢é˜…è€…å¼‚å¸¸ä¸å½±å“å…¶ä»–è®¢é˜…è€…
     - å®ç°@PreDestroyä¼˜é›…å…³é—­

3. **é…ç½®Spring Bean**
   - åœ¨é…ç½®ç±»ä¸­æ³¨å†ŒPriceEventBus Bean
   - æˆ–ä½¿ç”¨@Componentæ³¨è§£

4. **ç¼–å†™å•å…ƒæµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/subscription/collector/eventbus/impl/SimplePriceEventBusTest.java`
   - æµ‹è¯•ç”¨ä¾‹ï¼š
     - å‘å¸ƒå’Œè®¢é˜…åŠŸèƒ½
     - å¤šä¸ªè®¢é˜…è€…
     - å¼‚å¸¸éš”ç¦»
     - å¼‚æ­¥æ‰§è¡ŒéªŒè¯

#### éªŒæ”¶æ ‡å‡†

- [ ] æ¥å£å®šä¹‰æ¸…æ™°
- [ ] å®ç°ç±»çº¿ç¨‹å®‰å…¨
- [ ] å¼‚æ­¥æ‰§è¡Œä¸é˜»å¡å‘å¸ƒçº¿ç¨‹
- [ ] å¼‚å¸¸éš”ç¦»æœ‰æ•ˆ
- [ ] ä¼˜é›…å…³é—­åŠŸèƒ½æ­£å¸¸
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

#### ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡1.1ï¼ˆPriceTickäº‹ä»¶æ¨¡å‹ï¼‰

#### è¾“å‡ºç‰©
- `PriceEventBus.java`
- `SimplePriceEventBus.java`
- `SimplePriceEventBusTest.java`
- æµ‹è¯•æŠ¥å‘Š

---

### ä»»åŠ¡1.3ï¼šæ‰©å±•MarketChannelæ¥å£

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š0.5å¤©  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆé˜»å¡ï¼‰

#### ä»»åŠ¡æè¿°
åœ¨MarketChannelæ¥å£ä¸­æ·»åŠ PRICEé¢‘é“ç±»å‹å¸¸é‡ï¼Œä¸ºåç»­å®ç°PriceChannelåšå‡†å¤‡ã€‚

#### å…·ä½“æ­¥éª¤

1. **æ‰©å±•MarketChannelæ¥å£**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/collector/channel/MarketChannel.java`
   - æ·»åŠ å¸¸é‡ï¼š`String CHANNEL_TYPE_PRICE = "PRICE";`
   - ä½ç½®ï¼šåœ¨ç°æœ‰å¸¸é‡ï¼ˆCHANNEL_TYPE_KLINEç­‰ï¼‰åæ·»åŠ 

2. **æ‰©å±•ChannelRouter**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/collector/router/ChannelRouter.java`
   - åœ¨`extractChannelType()`æ–¹æ³•ä¸­æ·»åŠ tickeré¢‘é“è¯†åˆ«ï¼š
     ```java
     } else if ("ticker".equals(channel)) {
         return MarketChannel.CHANNEL_TYPE_PRICE;
     ```
   - ä½ç½®ï¼šåœ¨ç°æœ‰é¢‘é“ç±»å‹åˆ¤æ–­é€»è¾‘åæ·»åŠ 

3. **éªŒè¯ç°æœ‰åŠŸèƒ½ä¸å—å½±å“**
   - è¿è¡Œç°æœ‰Kçº¿è®¢é˜…ç›¸å…³æµ‹è¯•
   - ç¡®ä¿KlineChannelæ­£å¸¸å·¥ä½œ

4. **ç¼–å†™å•å…ƒæµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/subscription/collector/router/ChannelRouterTest.java`
   - æµ‹è¯•ç”¨ä¾‹ï¼š
     - tickeré¢‘é“è¯†åˆ«æ­£ç¡®
     - ç°æœ‰Kçº¿é¢‘é“è¯†åˆ«ä¸å—å½±å“
     - ç³»ç»Ÿæ¶ˆæ¯è¿‡æ»¤æ­£å¸¸

#### éªŒæ”¶æ ‡å‡†

- [ ] MarketChannelæ¥å£æ–°å¢å¸¸é‡
- [ ] ChannelRouteræ­£ç¡®è¯†åˆ«tickeré¢‘é“
- [ ] ç°æœ‰Kçº¿è®¢é˜…åŠŸèƒ½ä¸å—å½±å“
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡

#### ä¾èµ–å…³ç³»
- æ— å‰ç½®ä¾èµ–ï¼ˆä»…ä¿®æ”¹ç°æœ‰æ¥å£å’Œè·¯ç”±é€»è¾‘ï¼‰

#### è¾“å‡ºç‰©
- ä¿®æ”¹åçš„`MarketChannel.java`
- ä¿®æ”¹åçš„`ChannelRouter.java`
- `ChannelRouterTest.java`ï¼ˆæ–°å¢æµ‹è¯•ç”¨ä¾‹ï¼‰
- ä»£ç å®¡æŸ¥é€šè¿‡

---

## Phase 2: æ ¸å¿ƒæœåŠ¡å®ç°ï¼ˆ3å¤©ï¼‰

**é˜¶æ®µçŠ¶æ€**ï¼šâœ… å·²å®Œæˆ  
**å‰ç½®æ¡ä»¶**ï¼šPhase 1 æ‰€æœ‰ä»»åŠ¡å®Œæˆ + åŒæ„å¼€å¯ âœ…  
**å®Œæˆæ¡ä»¶**ï¼šæ‰€æœ‰ä»»åŠ¡éªŒæ”¶é€šè¿‡  
**å¼€å¯ä¸‹ä¸€é˜¶æ®µ**ï¼šâœ… åŒæ„å¼€å¯ä¸‹ä¸€é˜¶æ®µï¼ˆPhase 3ï¼‰- ç­‰å¾…åŒæ„

---

### ä»»åŠ¡2.1ï¼šå®ç°PriceChannel

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š1å¤©  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆæ ¸å¿ƒï¼‰

#### ä»»åŠ¡æè¿°
å®ç°PriceChannelç±»ï¼Œè´Ÿè´£è§£æOKX tickeræ¶ˆæ¯å¹¶è½¬æ¢ä¸ºPriceTickäº‹ä»¶ã€‚

#### å…·ä½“æ­¥éª¤

1. **åˆ›å»ºPriceChannelç±»**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/collector/channel/impl/PriceChannel.java`
   - å®ç°ï¼š`MarketChannel` æ¥å£
   - ä½ç½®ï¼š`com.qyl.v2trade.market.subscription.collector.channel.impl` åŒ…

2. **å®ç°channelType()æ–¹æ³•**
   - è¿”å›ï¼š`MarketChannel.CHANNEL_TYPE_PRICE`

3. **å®ç°buildSubscribeRaw()æ–¹æ³•**
   - è¾“å…¥ï¼šSet<String> symbols
   - è¾“å‡ºï¼šJSONå­—ç¬¦ä¸²
   - æ ¼å¼ï¼š`{"op":"subscribe","args":[{"channel":"ticker","instId":"BTC-USDT-SWAP"}]}`
   - æ”¯æŒæ‰¹é‡è®¢é˜…

4. **å®ç°buildUnsubscribeRaw()æ–¹æ³•**
   - è¾“å…¥ï¼šSet<String> symbols
   - è¾“å‡ºï¼šJSONå­—ç¬¦ä¸²
   - æ ¼å¼ï¼š`{"op":"unsubscribe","args":[{"channel":"ticker","instId":"BTC-USDT-SWAP"}]}`

5. **å®ç°onMessage()æ–¹æ³•**
   - è§£æOKX tickeræ¶ˆæ¯æ ¼å¼
   - æå–å­—æ®µï¼š
     - `data[0].last` â†’ priceï¼ˆæœ€æ–°æˆäº¤ä»·ï¼‰
     - `data[0].ts` â†’ timestampï¼ˆæ—¶é—´æˆ³ï¼Œæ¯«ç§’ï¼‰
     - `arg.instId` â†’ symbolï¼ˆäº¤æ˜“å¯¹ç¬¦å·ï¼‰
   - åˆ›å»ºPriceTickå¯¹è±¡
   - å‘å¸ƒåˆ°PriceEventBus
   - å¼‚å¸¸å¤„ç†ï¼šè®°å½•æ—¥å¿—ï¼Œä¸æŠ›å¼‚å¸¸

6. **é…ç½®Spring Bean**
   - ä½¿ç”¨@Componentæ³¨è§£
   - æˆ–é€šè¿‡é…ç½®ç±»æ³¨å†Œ

7. **ç¼–å†™å•å…ƒæµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/subscription/collector/channel/impl/PriceChannelTest.java`
   - æµ‹è¯•ç”¨ä¾‹ï¼š
     - channelType()è¿”å›æ­£ç¡®
     - buildSubscribeRaw()æ ¼å¼æ­£ç¡®
     - buildUnsubscribeRaw()æ ¼å¼æ­£ç¡®
     - onMessage()è§£ææ­£ç¡®ï¼ˆæ­£å¸¸æ¶ˆæ¯ï¼‰
     - onMessage()å¼‚å¸¸å¤„ç†ï¼ˆå¼‚å¸¸æ¶ˆæ¯ï¼‰
     - ç©ºæ•°æ®æ•°ç»„å¤„ç†
     - ç¼ºå°‘å­—æ®µå¤„ç†

#### éªŒæ”¶æ ‡å‡†

- [ ] å®ç°MarketChannelæ¥å£æ‰€æœ‰æ–¹æ³•
- [ ] è®¢é˜…/å–æ¶ˆè®¢é˜…æ¶ˆæ¯æ ¼å¼æ­£ç¡®
- [ ] OKX tickeræ¶ˆæ¯è§£ææ­£ç¡®
- [ ] PriceTickäº‹ä»¶æ­£ç¡®å‘å¸ƒåˆ°PriceEventBus
- [ ] å¼‚å¸¸æ¶ˆæ¯å¤„ç†æ­£ç¡®ï¼ˆä¸å´©æºƒï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 85%

#### ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡1.1ï¼ˆPriceTickäº‹ä»¶æ¨¡å‹ï¼‰
- ä¾èµ–ï¼šä»»åŠ¡1.2ï¼ˆPriceEventBusï¼‰
- ä¾èµ–ï¼šä»»åŠ¡1.3ï¼ˆMarketChannelå¸¸é‡æ‰©å±•ï¼‰

#### è¾“å‡ºç‰©
- `PriceChannel.java`
- `PriceChannelTest.java`
- æµ‹è¯•æŠ¥å‘Š
- ä»£ç å®¡æŸ¥é€šè¿‡

---

### ä»»åŠ¡2.2ï¼šå®ç°LatestPriceService

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š1å¤©  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆæ ¸å¿ƒï¼‰

#### ä»»åŠ¡æè¿°
å®ç°LatestPriceServiceæ ¸å¿ƒæœåŠ¡ï¼Œç»´æŠ¤å†…å­˜æœ€æ–°ä»·æ ¼çŠ¶æ€ï¼Œå¤„ç†PriceTickäº‹ä»¶å¹¶å‘å¸ƒPriceChangedEventã€‚

#### å…·ä½“æ­¥éª¤

1. **åˆ›å»ºLatestPriceServiceæ¥å£**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/service/LatestPriceService.java`
   - æ–¹æ³•ï¼š
     - `void updatePrice(PriceTick tick)`
     - `Optional<LatestPrice> getLatestPrice(String symbol)`
     - `BigDecimal getPrice(String symbol)`
     - `Map<String, LatestPrice> getAllLatestPrices()`
     - `void removePrice(String symbol)`
   - ä½ç½®ï¼š`com.qyl.v2trade.market.subscription.service` åŒ…

2. **åˆ›å»ºLatestPriceServiceImplå®ç°ç±»**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/service/impl/LatestPriceServiceImpl.java`
   - å­˜å‚¨ï¼šä½¿ç”¨`ConcurrentHashMap<String, LatestPrice>`å­˜å‚¨æœ€æ–°ä»·æ ¼
   - å…³é”®é€»è¾‘ï¼š
     - updatePrice()æ–¹æ³•ï¼š
       - æ—¶é—´æˆ³è¿‡æ»¤ï¼ˆæ—§æ¶ˆæ¯ä¸¢å¼ƒï¼‰
       - æ›´æ–°å†…å­˜çŠ¶æ€
       - å‘å¸ƒPriceChangedEventï¼ˆä½¿ç”¨Spring ApplicationEventPublisherï¼‰
     - getLatestPrice()æ–¹æ³•ï¼šä»ConcurrentHashMapè·å–
     - getPrice()æ–¹æ³•ï¼šç®€åŒ–ç‰ˆï¼Œè¿”å›ä»·æ ¼æˆ–null
     - getAllLatestPrices()æ–¹æ³•ï¼šè¿”å›æ‰€æœ‰ä»·æ ¼ï¼ˆé˜²å¾¡æ€§æ‹·è´ï¼‰
     - removePrice()æ–¹æ³•ï¼šæ¸…é™¤æŒ‡å®šäº¤æ˜“å¯¹ä»·æ ¼

3. **æ³¨å…¥ä¾èµ–**
   - æ³¨å…¥ï¼šApplicationEventPublisherï¼ˆç”¨äºå‘å¸ƒPriceChangedEventï¼‰
   - å¯é€‰ï¼šPriceEventBusï¼ˆç”¨äºè®¢é˜…PriceTickäº‹ä»¶ï¼‰

4. **é…ç½®Spring Bean**
   - ä½¿ç”¨@Serviceæ³¨è§£

5. **ç¼–å†™å•å…ƒæµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/subscription/service/impl/LatestPriceServiceImplTest.java`
   - æµ‹è¯•ç”¨ä¾‹ï¼š
     - updatePrice()æ­£å¸¸æ›´æ–°
     - updatePrice()æ—¶é—´æˆ³è¿‡æ»¤ï¼ˆæ—§æ¶ˆæ¯ä¸¢å¼ƒï¼‰
     - getLatestPrice()æ­£å¸¸æŸ¥è¯¢
     - getLatestPrice()ä¸å­˜åœ¨è¿”å›empty
     - getPrice()æ­£å¸¸æŸ¥è¯¢
     - getAllLatestPrices()è¿”å›æ‰€æœ‰ä»·æ ¼
     - removePrice()æ¸…é™¤ä»·æ ¼
     - å¹¶å‘æ›´æ–°å®‰å…¨æ€§
     - PriceChangedEventå‘å¸ƒéªŒè¯

#### éªŒæ”¶æ ‡å‡†

- [ ] æ¥å£å®šä¹‰å®Œæ•´
- [ ] æ—¶é—´æˆ³è¿‡æ»¤é€»è¾‘æ­£ç¡®ï¼ˆæ—§æ¶ˆæ¯ä¸¢å¼ƒï¼‰
- [ ] å†…å­˜çŠ¶æ€æ›´æ–°æ­£ç¡®
- [ ] PriceChangedEventæ­£ç¡®å‘å¸ƒ
- [ ] å¹¶å‘æ›´æ–°çº¿ç¨‹å®‰å…¨
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 85%

#### ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡1.1ï¼ˆLatestPriceçŠ¶æ€æ¨¡å‹ã€PriceChangedEventï¼‰
- ä¾èµ–ï¼šä»»åŠ¡1.2ï¼ˆPriceEventBusï¼Œå¯é€‰ï¼‰

#### è¾“å‡ºç‰©
- `LatestPriceService.java`
- `LatestPriceServiceImpl.java`
- `LatestPriceServiceImplTest.java`
- æµ‹è¯•æŠ¥å‘Š
- ä»£ç å®¡æŸ¥é€šè¿‡

---

### ä»»åŠ¡2.3ï¼šå®ç°PriceQueryService

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š0.5å¤©  
**ä¼˜å…ˆçº§**ï¼šP1ï¼ˆé‡è¦ï¼‰

#### ä»»åŠ¡æè¿°
å®ç°PriceQueryServiceæŸ¥è¯¢æ¥å£ï¼Œå¯¹å¤–æä¾›ä»·æ ¼æŸ¥è¯¢æœåŠ¡ã€‚

#### å…·ä½“æ­¥éª¤

1. **åˆ›å»ºPriceQueryServiceæ¥å£**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/service/PriceQueryService.java`
   - æ–¹æ³•ï¼š
     - `Optional<BigDecimal> getLatestPrice(String symbol)`
     - `Optional<LatestPrice> getLatestPriceWithTimestamp(String symbol)`
     - `Map<String, BigDecimal> getLatestPrices(Set<String> symbols)`
     - `boolean hasPrice(String symbol)`
   - ä½ç½®ï¼š`com.qyl.v2trade.market.subscription.service` åŒ…

2. **åˆ›å»ºPriceQueryServiceImplå®ç°ç±»**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/service/impl/PriceQueryServiceImpl.java`
   - å®ç°æ–¹å¼ï¼šå§”æ‰˜ç»™LatestPriceService
   - getLatestPrice()ï¼šè°ƒç”¨LatestPriceService.getPrice()
   - getLatestPriceWithTimestamp()ï¼šè°ƒç”¨LatestPriceService.getLatestPrice()
   - getLatestPrices()ï¼šæ‰¹é‡æŸ¥è¯¢ï¼Œè½¬æ¢ä¸ºMap<String, BigDecimal>
   - hasPrice()ï¼šæ£€æŸ¥ä»·æ ¼æ˜¯å¦å­˜åœ¨

3. **æ³¨å…¥ä¾èµ–**
   - æ³¨å…¥ï¼šLatestPriceService

4. **é…ç½®Spring Bean**
   - ä½¿ç”¨@Serviceæ³¨è§£

5. **ç¼–å†™å•å…ƒæµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/subscription/service/impl/PriceQueryServiceImplTest.java`
   - æµ‹è¯•ç”¨ä¾‹ï¼š
     - getLatestPrice()æ­£å¸¸æŸ¥è¯¢
     - getLatestPrice()ä¸å­˜åœ¨è¿”å›empty
     - getLatestPriceWithTimestamp()æ­£å¸¸æŸ¥è¯¢
     - getLatestPrices()æ‰¹é‡æŸ¥è¯¢
     - hasPrice()æ£€æŸ¥å­˜åœ¨æ€§
     - ç©ºé›†åˆå¤„ç†

#### éªŒæ”¶æ ‡å‡†

- [ ] æ¥å£å®šä¹‰æ¸…æ™°
- [ ] å®ç°å§”æ‰˜ç»™LatestPriceService
- [ ] æ‰€æœ‰æŸ¥è¯¢æ–¹æ³•æ­£ç¡®
- [ ] å¼‚å¸¸æƒ…å†µå¤„ç†æ­£ç¡®ï¼ˆä¸å­˜åœ¨ã€ç©ºé›†åˆç­‰ï¼‰
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%

#### ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡2.2ï¼ˆLatestPriceServiceï¼‰

#### è¾“å‡ºç‰©
- `PriceQueryService.java`
- `PriceQueryServiceImpl.java`
- `PriceQueryServiceImplTest.java`
- æµ‹è¯•æŠ¥å‘Š

---

### ä»»åŠ¡2.4ï¼šé›†æˆPriceChannelå’ŒLatestPriceService

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š0.5å¤©  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆæ ¸å¿ƒï¼‰

#### ä»»åŠ¡æè¿°
å°†PriceChannelå’ŒLatestPriceServiceé›†æˆï¼Œä½¿PriceTickäº‹ä»¶èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°æœ€æ–°ä»·æ ¼çŠ¶æ€ã€‚

#### å…·ä½“æ­¥éª¤

1. **åœ¨LatestPriceServiceImplä¸­è®¢é˜…PriceTickäº‹ä»¶**
   - æ–¹å¼1ï¼šæ³¨å…¥PriceEventBusï¼Œåœ¨@PostConstructä¸­è®¢é˜…
   - æ–¹å¼2ï¼šä½¿ç”¨Springçš„@EventListeneræ³¨è§£ï¼ˆéœ€è¦PriceTickæˆä¸ºSpringäº‹ä»¶ï¼‰
   - æ¨èæ–¹å¼1ï¼šä½¿ç”¨PriceEventBus.subscribe()

2. **å®ç°äº‹ä»¶å¤„ç†é€»è¾‘**
   - åˆ›å»ºConsumer<PriceTick>ï¼Œè°ƒç”¨updatePrice()æ–¹æ³•
   - åœ¨@PostConstructä¸­æ³¨å†Œè®¢é˜…
   - åœ¨@PreDestroyä¸­å–æ¶ˆè®¢é˜…ï¼ˆå¯é€‰ï¼‰

3. **æ³¨å†ŒPriceChannelåˆ°ChannelRouter**
   - æ–¹å¼1ï¼šåœ¨é…ç½®ç±»ä¸­æ³¨å†Œ
   - æ–¹å¼2ï¼šä½¿ç”¨@PostConstructè‡ªåŠ¨æ³¨å†Œ
   - æ–¹å¼3ï¼šé€šè¿‡ApplicationContextè·å–ChannelRouterå¹¶æ³¨å†Œ
   - æ¨èæ–¹å¼ï¼šåœ¨é…ç½®ç±»æˆ–å¯åŠ¨ç±»ä¸­æ³¨å†Œ

4. **éªŒè¯ç«¯åˆ°ç«¯æµç¨‹**
   - æ¨¡æ‹ŸWebSocketæ¶ˆæ¯
   - éªŒè¯PriceChannelè§£æ
   - éªŒè¯PriceEventBuså‘å¸ƒ
   - éªŒè¯LatestPriceServiceæ›´æ–°
   - éªŒè¯PriceChangedEventå‘å¸ƒ

5. **ç¼–å†™é›†æˆæµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/subscription/integration/PriceSubscriptionIntegrationTest.java`
   - æµ‹è¯•ç”¨ä¾‹ï¼š
     - å®Œæ•´äº‹ä»¶æµï¼ˆWebSocketæ¶ˆæ¯ â†’ ä»·æ ¼æ›´æ–° â†’ äº‹ä»¶å‘å¸ƒï¼‰
     - æ—¶é—´æˆ³è¿‡æ»¤éªŒè¯
     - å¹¶å‘æ›´æ–°éªŒè¯

#### éªŒæ”¶æ ‡å‡†

- [ ] PriceChannelæ³¨å†Œåˆ°ChannelRouter
- [ ] LatestPriceServiceè®¢é˜…PriceTickäº‹ä»¶
- [ ] ç«¯åˆ°ç«¯æµç¨‹æ­£å¸¸å·¥ä½œ
- [ ] äº‹ä»¶å‘å¸ƒæ­£ç¡®
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

#### ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡2.1ï¼ˆPriceChannelï¼‰
- ä¾èµ–ï¼šä»»åŠ¡2.2ï¼ˆLatestPriceServiceï¼‰
- ä¾èµ–ï¼šä»»åŠ¡1.2ï¼ˆPriceEventBusï¼‰

#### è¾“å‡ºç‰©
- ä¿®æ”¹åçš„`LatestPriceServiceImpl.java`ï¼ˆæ·»åŠ äº‹ä»¶è®¢é˜…ï¼‰
- é…ç½®ç±»æˆ–å¯åŠ¨ç±»ä¿®æ”¹ï¼ˆæ³¨å†ŒPriceChannelï¼‰
- `PriceSubscriptionIntegrationTest.java`
- æµ‹è¯•æŠ¥å‘Š

---

## Phase 3: æ¥å£å’Œé›†æˆï¼ˆ2å¤©ï¼‰

**é˜¶æ®µçŠ¶æ€**ï¼šâœ… å·²å®Œæˆ  
**å‰ç½®æ¡ä»¶**ï¼šPhase 2 æ‰€æœ‰ä»»åŠ¡å®Œæˆ + åŒæ„å¼€å¯ âœ…  
**å®Œæˆæ¡ä»¶**ï¼šæ‰€æœ‰ä»»åŠ¡éªŒæ”¶é€šè¿‡  
**å¼€å¯ä¸‹ä¸€é˜¶æ®µ**ï¼šâœ… åŒæ„å¼€å¯ä¸‹ä¸€é˜¶æ®µï¼ˆPhase 4ï¼‰- ç­‰å¾…åŒæ„

---

### ä»»åŠ¡3.1ï¼šåˆ›å»ºä»·æ ¼è®¢é˜…å¯åŠ¨æœåŠ¡

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š0.5å¤©  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆé˜»å¡ï¼‰

#### ä»»åŠ¡æè¿°
åˆ›å»ºä»·æ ¼è®¢é˜…å¯åŠ¨æœåŠ¡ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶åŠ è½½è®¢é˜…é…ç½®å¹¶å¯åŠ¨ä»·æ ¼è®¢é˜…ã€‚

#### å…·ä½“æ­¥éª¤

1. **åˆ›å»ºPriceSubscriptionServiceç±»**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/service/PriceSubscriptionService.java`
   - å®ç°ï¼šApplicationRunneræ¥å£ï¼ˆåœ¨åº”ç”¨å¯åŠ¨åæ‰§è¡Œï¼‰
   - æˆ–ä½¿ç”¨ï¼š@PostConstruct + @Component
   - ä½ç½®ï¼š`com.qyl.v2trade.market.subscription.service` åŒ…

2. **å®ç°å¯åŠ¨é€»è¾‘**
   - æ³¨å…¥ä¾èµ–ï¼š
     - MarketIngestorï¼ˆç”¨äºè®¢é˜…ï¼‰
     - MarketSubscriptionConfigServiceï¼ˆåŠ è½½é…ç½®ï¼‰
     - TradingPairServiceï¼ˆè·å–äº¤æ˜“å¯¹ä¿¡æ¯ï¼‰
     - ExchangeMarketPairServiceï¼ˆè·å–äº¤æ˜“æ‰€äº¤æ˜“è§„åˆ™ï¼‰
     - ChannelRouterï¼ˆæ³¨å†ŒPriceChannelï¼‰
     - PriceChannelï¼ˆä»·æ ¼é¢‘é“ï¼‰
   - å¯åŠ¨æµç¨‹ï¼š
     1. æ³¨å†ŒPriceChannelåˆ°ChannelRouter
     2. åŠ è½½MarketSubscriptionConfigï¼ˆå¯ç”¨çŠ¶æ€çš„é…ç½®ï¼‰
     3. éå†é…ç½®ï¼Œè·å–äº¤æ˜“å¯¹å’Œäº¤æ˜“æ‰€ç¬¦å·
     4. è°ƒç”¨marketIngestor.subscribe()è®¢é˜…ä»·æ ¼é¢‘é“
     - å‚è€ƒï¼šMarketDataCenter.loadAndSubscribe()æ–¹æ³•

3. **å¤„ç†å¼‚å¸¸**
   - å•ä¸ªäº¤æ˜“å¯¹è®¢é˜…å¤±è´¥ä¸å½±å“å…¶ä»–äº¤æ˜“å¯¹
   - è®°å½•é”™è¯¯æ—¥å¿—
   - åº”ç”¨å¯åŠ¨ä¸é˜»å¡

4. **ç¼–å†™å•å…ƒæµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/subscription/service/PriceSubscriptionServiceTest.java`
   - æµ‹è¯•ç”¨ä¾‹ï¼š
     - å¯åŠ¨æ—¶æ³¨å†ŒPriceChannel
     - å¯åŠ¨æ—¶åŠ è½½è®¢é˜…é…ç½®
     - å¯åŠ¨æ—¶è°ƒç”¨subscribe()
     - å¼‚å¸¸å¤„ç†ï¼ˆé…ç½®ä¸å­˜åœ¨ã€äº¤æ˜“å¯¹ä¸å­˜åœ¨ç­‰ï¼‰

#### éªŒæ”¶æ ‡å‡†

- [ ] åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ
- [ ] PriceChannelæ­£ç¡®æ³¨å†Œ
- [ ] è®¢é˜…é…ç½®æ­£ç¡®åŠ è½½
- [ ] è®¢é˜…è°ƒç”¨æ­£ç¡®
- [ ] å¼‚å¸¸å¤„ç†æ­£ç¡®ï¼ˆä¸é˜»å¡å¯åŠ¨ï¼‰
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

#### ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡2.1ï¼ˆPriceChannelï¼‰
- ä¾èµ–ï¼šä»»åŠ¡2.2ï¼ˆLatestPriceServiceï¼‰
- ä¾èµ–ï¼šç°æœ‰æœåŠ¡ï¼ˆMarketIngestorã€MarketSubscriptionConfigServiceç­‰ï¼‰

#### è¾“å‡ºç‰©
- `PriceSubscriptionService.java`
- `PriceSubscriptionServiceTest.java`
- æµ‹è¯•æŠ¥å‘Š

---

### ä»»åŠ¡3.2ï¼šæ‰©å±•MarketIngestoræ”¯æŒä»·æ ¼è®¢é˜…

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š1å¤©  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆæ ¸å¿ƒï¼‰

#### ä»»åŠ¡æè¿°
æ‰©å±•MarketIngestorï¼ˆæˆ–åˆ›å»ºä»·æ ¼è®¢é˜…ä¸“ç”¨æ–¹æ³•ï¼‰ï¼Œæ”¯æŒè®¢é˜…tickeré¢‘é“ã€‚

#### å…·ä½“æ­¥éª¤

1. **åˆ†æç°æœ‰MarketIngestorå®ç°**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/subscription/collector/ingestor/impl/OkxMarketIngestor.java`
   - äº†è§£ç°æœ‰subscribe()æ–¹æ³•çš„å®ç°é€»è¾‘
   - äº†è§£å¦‚ä½•ç®¡ç†è®¢é˜…åˆ—è¡¨

2. **æ‰©å±•MarketIngestoræ¥å£ï¼ˆå¯é€‰ï¼‰**
   - å¦‚æœéœ€è¦åŒºåˆ†Kçº¿è®¢é˜…å’Œä»·æ ¼è®¢é˜…ï¼Œå¯ä»¥æ·»åŠ æ–¹æ³•ï¼š
     - `void subscribePrice(Long tradingPairId, String symbolOnExchange, String symbol)`
   - æˆ–è€…å¤ç”¨ç°æœ‰subscribe()æ–¹æ³•ï¼ˆå¦‚æœé€šç”¨ï¼‰

3. **å®ç°ä»·æ ¼è®¢é˜…é€»è¾‘**
   - åœ¨OkxMarketIngestorä¸­å®ç°ä»·æ ¼è®¢é˜…
   - å¤ç”¨ç°æœ‰çš„è®¢é˜…ç®¡ç†æœºåˆ¶
   - è°ƒç”¨PriceChannel.buildSubscribeRaw()æ„å»ºè®¢é˜…æ¶ˆæ¯
   - é€šè¿‡ExchangeWebSocketManagerå‘é€è®¢é˜…æ¶ˆæ¯

4. **å¤„ç†è®¢é˜…ç¡®è®¤**
   - ç›‘å¬è®¢é˜…ç¡®è®¤æ¶ˆæ¯
   - æ›´æ–°è®¢é˜…çŠ¶æ€

5. **ç¼–å†™å•å…ƒæµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/subscription/collector/ingestor/impl/OkxMarketIngestorTest.java`
   - æµ‹è¯•ç”¨ä¾‹ï¼š
     - ä»·æ ¼è®¢é˜…æ¶ˆæ¯æ„å»ºæ­£ç¡®
     - è®¢é˜…æ¶ˆæ¯å‘é€æ­£ç¡®
     - è®¢é˜…ç¡®è®¤å¤„ç†æ­£ç¡®
     - å–æ¶ˆè®¢é˜…åŠŸèƒ½æ­£å¸¸

#### éªŒæ”¶æ ‡å‡†

- [ ] ä»·æ ¼è®¢é˜…æ¶ˆæ¯æ ¼å¼æ­£ç¡®
- [ ] è®¢é˜…æ¶ˆæ¯æ­£ç¡®å‘é€
- [ ] è®¢é˜…ç¡®è®¤å¤„ç†æ­£ç¡®
- [ ] ä¸Kçº¿è®¢é˜…äº’ä¸å¹²æ‰°
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

#### ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡2.1ï¼ˆPriceChannelï¼‰
- ä¾èµ–ï¼šç°æœ‰MarketIngestorå®ç°

#### è¾“å‡ºç‰©
- ä¿®æ”¹åçš„`OkxMarketIngestor.java`
- `OkxMarketIngestorTest.java`ï¼ˆæ–°å¢æµ‹è¯•ç”¨ä¾‹ï¼‰
- æµ‹è¯•æŠ¥å‘Š

---

### ä»»åŠ¡3.3ï¼šåˆ›å»ºä»·æ ¼æŸ¥è¯¢REST APIï¼ˆå¯é€‰ï¼‰

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š0.5å¤©  
**ä¼˜å…ˆçº§**ï¼šP2ï¼ˆå¯é€‰ï¼‰

#### ä»»åŠ¡æè¿°
åˆ›å»ºREST APIæ¥å£ï¼Œå¯¹å¤–æä¾›ä»·æ ¼æŸ¥è¯¢æœåŠ¡ï¼ˆå¦‚æœéœ€è¦HTTPæ¥å£ï¼‰ã€‚

#### å…·ä½“æ­¥éª¤

1. **åˆ›å»ºPriceControllerç±»ï¼ˆå¯é€‰ï¼‰**
   - æ–‡ä»¶ï¼š`src/main/java/com/qyl/v2trade/market/web/controller/PriceController.java`
   - æ³¨è§£ï¼š@RestController
   - è·¯å¾„ï¼š`/api/market/price`
   - ä½ç½®ï¼š`com.qyl.v2trade.market.web.controller` åŒ…

2. **å®ç°æŸ¥è¯¢æ¥å£**
   - GET `/api/market/price/{symbol}` - è·å–å•ä¸ªäº¤æ˜“å¯¹æœ€æ–°ä»·æ ¼
   - GET `/api/market/price/{symbol}/timestamp` - è·å–ä»·æ ¼å’Œæ—¶é—´æˆ³
   - POST `/api/market/price/batch` - æ‰¹é‡æŸ¥è¯¢ä»·æ ¼
   - å§”æ‰˜ç»™PriceQueryServiceå®ç°

3. **å“åº”æ ¼å¼**
   - æˆåŠŸå“åº”ï¼š`{"code": 0, "data": {...}}`
   - å¤±è´¥å“åº”ï¼š`{"code": 404, "message": "ä»·æ ¼ä¸å­˜åœ¨"}`

4. **ç¼–å†™å•å…ƒæµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/web/controller/PriceControllerTest.java`
   - æµ‹è¯•ç”¨ä¾‹ï¼š
     - æ­£å¸¸æŸ¥è¯¢
     - ä¸å­˜åœ¨äº¤æ˜“å¯¹
     - æ‰¹é‡æŸ¥è¯¢
     - å¼‚å¸¸å¤„ç†

#### éªŒæ”¶æ ‡å‡†

- [ ] REST APIæ¥å£å®šä¹‰æ¸…æ™°
- [ ] å“åº”æ ¼å¼æ­£ç¡®
- [ ] å¼‚å¸¸å¤„ç†æ­£ç¡®
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] APIæ–‡æ¡£å®Œæ•´ï¼ˆå¦‚æœä½¿ç”¨Swaggerï¼‰

#### ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šä»»åŠ¡2.3ï¼ˆPriceQueryServiceï¼‰
- å¯é€‰ä»»åŠ¡ï¼šå¦‚æœç­–ç•¥æ¨¡å—ç›´æ¥è°ƒç”¨Serviceï¼Œå¯ä»¥è·³è¿‡æ­¤ä»»åŠ¡

#### è¾“å‡ºç‰©
- `PriceController.java`ï¼ˆå¯é€‰ï¼‰
- `PriceControllerTest.java`ï¼ˆå¯é€‰ï¼‰
- APIæ–‡æ¡£ï¼ˆå¯é€‰ï¼‰

---

## Phase 4: æµ‹è¯•å’Œä¼˜åŒ–ï¼ˆ1.5å¤©ï¼‰

**é˜¶æ®µçŠ¶æ€**ï¼šğŸ”’ å·²é”å®š  
**å‰ç½®æ¡ä»¶**ï¼šPhase 3 æ‰€æœ‰ä»»åŠ¡å®Œæˆ + åŒæ„å¼€å¯ âœ…  
**å®Œæˆæ¡ä»¶**ï¼šæ‰€æœ‰ä»»åŠ¡éªŒæ”¶é€šè¿‡  
**å¼€å¯ä¸‹ä¸€é˜¶æ®µ**ï¼šæ— ï¼ˆæœ€åé˜¶æ®µï¼‰

---

### ä»»åŠ¡4.1ï¼šé›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š1å¤©  
**ä¼˜å…ˆçº§**ï¼šP0ï¼ˆæ ¸å¿ƒï¼‰

#### ä»»åŠ¡æè¿°
ç¼–å†™å®Œæ•´çš„é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•ï¼ŒéªŒè¯æ•´ä¸ªä»·æ ¼è®¢é˜…æµç¨‹ã€‚

#### å…·ä½“æ­¥éª¤

1. **ç«¯åˆ°ç«¯æµ‹è¯•**
   - æ–‡ä»¶ï¼š`src/test/java/com/qyl/v2trade/market/subscription/integration/PriceSubscriptionE2ETest.java`
   - æµ‹è¯•åœºæ™¯ï¼š
     - WebSocketæ¶ˆæ¯æ¥æ”¶ â†’ PriceChannelè§£æ â†’ PriceTickäº‹ä»¶ â†’ LatestPriceServiceæ›´æ–° â†’ PriceChangedEventå‘å¸ƒ
     - æŸ¥è¯¢æ¥å£éªŒè¯ï¼ˆPriceQueryServiceï¼‰
     - å¤šäº¤æ˜“å¯¹å¹¶å‘è®¢é˜…
     - é‡è¿åä»·æ ¼æ¢å¤

2. **é›†æˆæµ‹è¯•åœºæ™¯**
   - åœºæ™¯1ï¼šå®Œæ•´è®¢é˜…æµç¨‹
     - å¯åŠ¨åº”ç”¨
     - éªŒè¯PriceChannelæ³¨å†Œ
     - éªŒè¯è®¢é˜…é…ç½®åŠ è½½
     - éªŒè¯ä»·æ ¼æ›´æ–°
   - åœºæ™¯2ï¼šæ¶ˆæ¯ä¹±åºå¤„ç†
     - å‘é€æ—§æ—¶é—´æˆ³æ¶ˆæ¯
     - éªŒè¯æ—¶é—´æˆ³è¿‡æ»¤
   - åœºæ™¯3ï¼šWebSocketé‡è¿
     - æ¨¡æ‹Ÿæ–­è¿
     - éªŒè¯é‡è¿
     - éªŒè¯ä»·æ ¼çŠ¶æ€æ¢å¤

3. **ä¸ç°æœ‰ç³»ç»Ÿé›†æˆæµ‹è¯•**
   - éªŒè¯ä¸Kçº¿è®¢é˜…å…±å­˜ï¼ˆå…±äº«WebSocketè¿æ¥ï¼‰
   - éªŒè¯äº’ä¸å¹²æ‰°
   - éªŒè¯å¯åŠ¨é¡ºåºæ­£ç¡®

4. **å¼‚å¸¸åœºæ™¯æµ‹è¯•**
   - å¼‚å¸¸æ¶ˆæ¯å¤„ç†
   - è®¢é˜…å¤±è´¥å¤„ç†
   - æœåŠ¡å¼‚å¸¸æ¢å¤

5. **ä½¿ç”¨æµ‹è¯•å·¥å…·**
   - Mock WebSocketæ¶ˆæ¯
   - ä½¿ç”¨Mockitoæ¨¡æ‹Ÿä¾èµ–
   - ä½¿ç”¨Spring Testè¿›è¡Œé›†æˆæµ‹è¯•

#### éªŒæ”¶æ ‡å‡†

- [ ] ç«¯åˆ°ç«¯æµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•åœºæ™¯é€šè¿‡
- [ ] ä¸ç°æœ‰ç³»ç»Ÿé›†æˆæ­£å¸¸
- [ ] å¼‚å¸¸åœºæ™¯å¤„ç†æ­£ç¡®
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 70%ï¼ˆé›†æˆæµ‹è¯•ï¼‰

#### ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šPhase 2ã€Phase 3 æ‰€æœ‰ä»»åŠ¡

#### è¾“å‡ºç‰©
- `PriceSubscriptionE2ETest.java`
- é›†æˆæµ‹è¯•ä»£ç 
- æµ‹è¯•æŠ¥å‘Š

---

### ä»»åŠ¡4.2ï¼šæ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–

**è´Ÿè´£äºº**ï¼šå¼€å‘å·¥ç¨‹å¸ˆ  
**é¢„è®¡å·¥æœŸ**ï¼š0.5å¤©  
**ä¼˜å…ˆçº§**ï¼šP1ï¼ˆé‡è¦ï¼‰

#### ä»»åŠ¡æè¿°
è¿›è¡Œæ€§èƒ½æµ‹è¯•ï¼ŒéªŒè¯æ€§èƒ½æŒ‡æ ‡ï¼Œå¹¶è¿›è¡Œå¿…è¦çš„ä¼˜åŒ–ã€‚

#### å…·ä½“æ­¥éª¤

1. **æ€§èƒ½æŒ‡æ ‡æµ‹è¯•**
   - å•æ¡æ¶ˆæ¯å¤„ç†è€—æ—¶æµ‹è¯•ï¼ˆç›®æ ‡ï¼š< 1msï¼ŒP99ï¼‰
   - å¹¶å‘æ›´æ–°æ€§èƒ½æµ‹è¯•ï¼ˆ1000ä¸ªäº¤æ˜“å¯¹ï¼Œ10000æ¬¡æ›´æ–°/ç§’ï¼‰
   - æŸ¥è¯¢æ¥å£æ€§èƒ½æµ‹è¯•ï¼ˆ10000æ¬¡æŸ¥è¯¢/ç§’ï¼‰
   - å†…å­˜å ç”¨æµ‹è¯•ï¼ˆ1000ä¸ªäº¤æ˜“å¯¹çš„å†…å­˜å ç”¨ï¼Œç›®æ ‡ï¼š< 5MBï¼‰

2. **æ€§èƒ½æµ‹è¯•å·¥å…·**
   - ä½¿ç”¨JMHè¿›è¡ŒåŸºå‡†æµ‹è¯•
   - ä½¿ç”¨JProfileræˆ–VisualVMè¿›è¡Œå†…å­˜åˆ†æ
   - ä½¿ç”¨å‹åŠ›æµ‹è¯•å·¥å…·ï¼ˆå¦‚JMeterï¼‰è¿›è¡Œæ¥å£æµ‹è¯•

3. **æ€§èƒ½ä¼˜åŒ–ï¼ˆå¦‚éœ€è¦ï¼‰**
   - ä¼˜åŒ–å¹¶å‘æ§åˆ¶ï¼ˆä½¿ç”¨æ— é”æ•°æ®ç»“æ„ï¼‰
   - ä¼˜åŒ–å†…å­˜ä½¿ç”¨ï¼ˆå‡å°‘å¯¹è±¡åˆ›å»ºï¼‰
   - ä¼˜åŒ–äº‹ä»¶å‘å¸ƒï¼ˆå¼‚æ­¥å¤„ç†ï¼‰
   - ä¼˜åŒ–æŸ¥è¯¢æ¥å£ï¼ˆç¼“å­˜çƒ­ç‚¹æ•°æ®ï¼Œå¯é€‰ï¼‰

4. **æ€§èƒ½æµ‹è¯•æŠ¥å‘Š**
   - è®°å½•æµ‹è¯•ç»“æœ
   - å¯¹æ¯”æ€§èƒ½æŒ‡æ ‡è¦æ±‚
   - è®°å½•ä¼˜åŒ–æªæ–½

#### éªŒæ”¶æ ‡å‡†

- [ ] å•æ¡æ¶ˆæ¯å¤„ç†è€—æ—¶ < 1msï¼ˆP99ï¼‰
- [ ] å¹¶å‘æ›´æ–°æ€§èƒ½æ»¡è¶³è¦æ±‚
- [ ] æŸ¥è¯¢æ¥å£å“åº”æ—¶é—´ < 0.1msï¼ˆP99ï¼‰
- [ ] å†…å­˜å ç”¨ < 5MBï¼ˆ1000ä¸ªäº¤æ˜“å¯¹ï¼‰
- [ ] æ€§èƒ½æµ‹è¯•æŠ¥å‘Šå®Œæ•´

#### ä¾èµ–å…³ç³»
- ä¾èµ–ï¼šPhase 3 æ‰€æœ‰ä»»åŠ¡

#### è¾“å‡ºç‰©
- æ€§èƒ½æµ‹è¯•ä»£ç 
- æ€§èƒ½æµ‹è¯•æŠ¥å‘Š
- ä¼˜åŒ–ä»£ç ï¼ˆå¦‚æœ‰ï¼‰

---

## ğŸ“ ä»»åŠ¡æ€»ç»“

### å¼€å‘é¡ºåºå»ºè®®

1. **Phase 1ï¼ˆåŸºç¡€æ•°æ®æ¨¡å‹ï¼‰**ï¼šå¿…é¡»å…ˆå®Œæˆï¼Œä¸ºåç»­ä»»åŠ¡æä¾›åŸºç¡€
2. **Phase 2ï¼ˆæ ¸å¿ƒæœåŠ¡å®ç°ï¼‰**ï¼šæ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é¡»æŒ‰é¡ºåºå®Œæˆ
3. **Phase 3ï¼ˆæ¥å£å’Œé›†æˆï¼‰**ï¼šé›†æˆåŠŸèƒ½ï¼Œå¯ä»¥å¹¶è¡Œéƒ¨åˆ†ä»»åŠ¡
4. **Phase 4ï¼ˆæµ‹è¯•å’Œä¼˜åŒ–ï¼‰**ï¼šæœ€åå®Œæˆï¼Œç¡®ä¿è´¨é‡

### å…³é”®é‡Œç¨‹ç¢‘

| é‡Œç¨‹ç¢‘ | é˜¶æ®µ | éªŒæ”¶æ ‡å‡† |
|--------|------|---------|
| M1: æ•°æ®æ¨¡å‹å®Œæˆ | Phase 1 | æ‰€æœ‰äº‹ä»¶æ¨¡å‹å’ŒçŠ¶æ€æ¨¡å‹åˆ›å»ºå®Œæˆ |
| M2: æ ¸å¿ƒåŠŸèƒ½å®Œæˆ | Phase 2 | PriceChannelå’ŒLatestPriceServiceå®ç°å®Œæˆ |
| M3: é›†æˆå®Œæˆ | Phase 3 | ä»·æ ¼è®¢é˜…å¯åŠ¨æœåŠ¡å®Œæˆï¼Œç«¯åˆ°ç«¯æµç¨‹å¯ç”¨ |
| M4: æµ‹è¯•å®Œæˆ | Phase 4 | æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œæ€§èƒ½æŒ‡æ ‡è¾¾æ ‡ |

### é£é™©æç¤º

1. **WebSocketè¿æ¥ç®¡ç†**ï¼šéœ€è¦ç¡®ä¿ä¸Kçº¿è®¢é˜…å…±äº«è¿æ¥ï¼Œé¿å…å†²çª
2. **æ€§èƒ½è¦æ±‚**ï¼šå•æ¡å¤„ç†è€—æ—¶ < 1msï¼Œéœ€è¦å…³æ³¨æ€§èƒ½ä¼˜åŒ–
3. **å†…å­˜ç®¡ç†**ï¼šä»…å†…å­˜å­˜å‚¨ï¼Œéœ€è¦ç›‘æ§å†…å­˜ä½¿ç”¨
4. **äº‹ä»¶å‘å¸ƒæ€§èƒ½**ï¼šå¼‚æ­¥äº‹ä»¶å‘å¸ƒï¼Œé¿å…é˜»å¡ä»·æ ¼æ›´æ–°æµç¨‹

### éªŒæ”¶æ¸…å•

**åŠŸèƒ½éªŒæ”¶**ï¼š
- [ ] ç³»ç»Ÿå¯ç¨³å®šæ¥æ”¶å®æ—¶ä»·æ ¼
- [ ] æœ€æ–°ä»·æ ¼å¯éšæ—¶æŸ¥è¯¢
- [ ] ç­–ç•¥ä¸é£æ§èƒ½å³æ—¶æ„ŸçŸ¥ä»·æ ¼å˜åŒ–
- [ ] ä¸å½±å“ç°æœ‰Kçº¿ç³»ç»Ÿ
- [ ] æ¨¡å—èŒè´£æ— æ±¡æŸ“

**æ€§èƒ½éªŒæ”¶**ï¼š
- [ ] å•æ¡æ¶ˆæ¯å¤„ç†è€—æ—¶ < 1msï¼ˆP99ï¼‰
- [ ] å†…å­˜å ç”¨ < 5MBï¼ˆ1000ä¸ªäº¤æ˜“å¯¹ï¼‰
- [ ] æŸ¥è¯¢æ¥å£å“åº”æ—¶é—´ < 0.1msï¼ˆP99ï¼‰

**è´¨é‡éªŒæ”¶**ï¼š
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ–‡æ¡£å®Œæ•´

---

**æ–‡æ¡£ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ  
**æœ€åæ›´æ–°**ï¼š2025-01-05  
**åŸºäºæ–‡æ¡£**ï¼š`å®æ—¶ä»·æ ¼è®¢é˜…-è®¾è®¡å¼€å‘è§„èŒƒ.md`