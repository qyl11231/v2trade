# 价格订阅频道参数修正说明

## 问题分析

根据OKX官方文档（https://www.okx.com/docs-v5/zh/#public-data-websocket-instruments-channel），发现了频道参数的问题：

### OKX WebSocket 频道区分

1. **`ticker`（单数）**：
   - 用于现货（SPOT）产品
   - 端点：`/ws/v5/public`
   - 示例：`{"channel":"ticker","instId":"BTC-USDT"}`

2. **`tickers`（复数）**：
   - 用于合约（SWAP/FUTURES）产品
   - 端点：`/ws/v5/business`
   - 示例：`{"channel":"tickers","instId":"BTC-USDT-SWAP"}`

### 代码中的问题

1. ✅ **PriceWebSocketManager.java**：已经正确使用 `"tickers"`（复数）
2. ❌ **ChannelRouter.java**：只检查了 `"ticker"`（单数），没有检查 `"tickers"`（复数）
3. ⚠️ **PriceChannel.java**：注释和代码示例使用的是 `"ticker"`（单数），需要更新

## 修正内容

### 1. ChannelRouter.java

修改 `extractChannelType` 方法，同时支持 `"ticker"` 和 `"tickers"`：

```java
} else if ("ticker".equals(channel) || "tickers".equals(channel)) {
    // ticker: 现货频道（/ws/v5/public端点）
    // tickers: 合约频道（/ws/v5/business端点）
    return MarketChannel.CHANNEL_TYPE_PRICE;
}
```

### 2. PriceChannel.java

- 更新注释，说明两种频道的区别
- 更新代码示例，使用 `"tickers"`（因为当前主要订阅合约）

## 验证

修正后，代码应该能够：
1. ✅ 正确订阅合约的ticker（使用 `"tickers"` 频道）
2. ✅ 正确路由收到的ticker消息（无论单数还是复数）
3. ✅ 正确解析ticker消息的数据

## 注意事项

如果未来需要同时支持现货和合约：
- 现货订阅需要在另一个WebSocket连接上使用 `"ticker"` 频道
- 或者根据 `TradingPair.marketType` 动态选择频道名称













