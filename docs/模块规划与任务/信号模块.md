# 信号模块规划（Signal Module Plan）

> **模块定位（最终定稿）**
> Signal 模块是一个**数据接入与事实记录模块**，用于统一接收外部/内部市场信号，
> 不承担任何交易决策、下单、风控职责。
>
> **系统主链路：**
> Signal → Strategy → TradeIntent → Risk → Trade → Statistics

---

## 一、信号模块在系统中的角色

### 1.1 解决什么问题

* 统一接收 TradingView / 内部计算 / 手工测试信号
* 对信号进行**白名单校验与路由**（通过 signal_config）
* 将信号作为**可审计、可回放、可回测的数据资产**保存

### 1.2 不解决什么问题（硬边界）

* ❌ 不决定是否交易
* ❌ 不决定交易方向
* ❌ 不进入风控
* ❌ 不产生订单

---

## 二、模块组成结构

```
Signal Module
├── signal_config   （信号配置 / 白名单 / 路由）
├── signal          （信号事实表）
├── signal_ingest   （接入层：Webhook / 内部调用）
├── signal_service  （校验 / 落库）
└── signal_query    （供策略 / 回测 / 统计读取）
```

---

## 三、核心数据模型说明

### 3.1 signal_config（信号配置表）

**定位：**

* 商业化系统的信号入口网关
* 决定“哪些信号允许进入系统”

**关键字段语义：**

* user_id：信号归属用户
* api_key_id：信号绑定的交易账户
* signal_name：外部系统传入的信号标识
* symbol：允许交易的标的
* enabled：是否启用

**与其他模块关系：**

* Strategy：读取配置，决定是否消费 signal
* Signal：必须强制关联 signal_config

---

### 3.2 signal（信号事实表）

**定位：**

* 市场/外部事件的“事实记录表”

**字段语义原则：**

* 可以描述现象
* 可以携带提示
* 不能承诺行为

**关键字段说明：**

* user_id / api_key_id：多租户隔离
* signal_direction_hint：方向提示（非交易）
* signal_event_type：事件类型（非交易动作）
* raw_payload：完整原始数据

**与其他模块关系：**

* Strategy：只读消费
* Backtest：历史回放
* Statistics：只读统计

---

## 四、标准业务流程（开发对照用）

### 4.1 TradingView 信号接入流程

```
Webhook
  ↓
根据 signal_config_id 查询 signal_config
  ↓
不通过 → 丢弃 / 记录日志
通过
  ↓
写入 signal 表
```

---

### 4.2 Signal → Strategy 数据交互

```
Strategy 定时/订阅读取 signal
  ↓
结合策略规则进行判断
  ↓
生成 trade_intent 或忽略
```

> Signal 模块不感知策略执行结果

---

## 五、异常与边界处理设计

### 5.1 无配置的信号

* 不入 signal 表
* 记录安全日志

### 5.2 已禁用 signal_config

* 直接拒绝
* 不进入策略

### 5.3 数据完整性原则

* signal 表只允许 INSERT
* 禁止 UPDATE / DELETE（除非运维级）

---

## 六、与其他模块的接口边界（重点）

| 模块         | 交互方式      | 权限 |
| ---------- | --------- | -- |
| Strategy   | 查询 signal | 只读 |
| Risk       | 无直接交互     | -  |
| Trade      | 无         | -  |
| Statistics | 查询 signal | 只读 |
| Backtest   | 复用 signal | 只读 |

---

## 七、信号模块完成后的系统状态

完成 Signal 模块后，系统将具备：

* 多用户信号隔离
* 多账户路由能力
* 外部信号安全接入
* 可回放、可审计的数据基础

这是后续策略、风控、交易模块的**地基**。

---

# 信号模块开发清单（用于排期）

## 一、数据库层（P0）

* [ ] 创建 signal_config 表
* [ ] 创建 signal 表（提示型字段版本）
* [ ] 外键 / 索引校验

---

## 二、接入层（P0）

* [ ] TradingView Webhook Controller
* [ ] Token / 签名校验
* [ ] 请求参数校验

---

## 三、业务服务层（P0）

* [ ] signal_config 查询服务
* [ ] 信号白名单校验
* [ ] signal 入库服务
* [ ] 异常信号拒绝逻辑

---

## 四、查询接口（P1）

* [ ] 按 user_id 查询 signal
* [ ] 按 symbol / 时间查询
* [ ] 策略模块消费接口

---

## 五、日志与监控（P1）

* [ ] 无配置命中日志
* [ ] 禁用配置日志
* [ ] 信号接收成功率统计

---

## 六、测试与验证（P1）

* [ ] TradingView 模拟请求
* [ ] 多用户并发测试
* [ ] signal_config 开关测试

---

## 七、交付标准（Done Definition）

* Signal 不包含交易动作语义
* Strategy 可稳定消费 signal
* signal 数据可回放
* 表结构无需依赖后续模块改动

---

> **当以上清单完成时：**
> Signal 模块即为“可商用、可售卖、可扩展”的长期版本。
