# 信号配置 & 交易对管理模块

（OKX 优先｜可扩展架构）

---

## 一、设计前提与边界确认（已对齐）

### 1️⃣ 已确认原则

* **信号就是信号**，不做交易决策、不校验规则
* **signal_config 只是路由 / 白名单层**
* **交易规则只在交易 / 风控 / 回测阶段使用**
* **优先支持 OKX，其它交易所暂不考虑**
* **不过度拆表，工程可维护性优先**

---

## 二、核心数据模型规划

### 2.1 trading_pair（交易对主表｜平台级）

> 系统内对交易对的统一抽象，**已融合现货 / 合约维度**

**职责**：

* 定义系统支持哪些交易对
* 区分 SPOT / SWAP
* 作为 signal_config / strategy / trade 的统一引用

**关键字段语义**：

* symbol：标准化交易对（BTC-USDT）
* market_type：SPOT / SWAP

---

### 2.2 exchange_market_pair（交易规则表｜OKX 实现）

> **当前阶段只服务 OKX，但结构允许未来扩展**

**职责**：

* 存储 OKX 返回的交易规则
* 提供下单 / 风控 / 回测的唯一参数来源

**重要说明**：

* exchange_code 固定为 OKX
* 不单独维护 exchange 表，降低复杂度

---

### 2.3 signal_config（信号配置表｜路由层）

> **必须同时保留 symbol 与 trading_pair_id**

#### 字段定位说明

* symbol

  * 用途：

    * TradingView webhook 原始匹配
    * 人工可读 / 调试 / 审计
  * 特点：

    * 不做强一致性校验

* trading_pair_id

  * 用途：

    * 系统内部唯一可信交易对引用
    * 后续策略 / 交易全部走该 ID

> **结论**：symbol 是“输入锚点”，trading_pair_id 是“系统真相”

---

## 三、模块间数据流（最终版）

```text
TradingView Signal
        ↓
signal（事实）
        ↓
signal_config（symbol 匹配 + trading_pair_id 路由）
        ↓
strategy（决定是否交易）
        ↓
exchange_market_pair（OKX 规则）
        ↓
risk_control / trade / backtest
```

---

## 四、功能规划（模块视角）

### 4.1 系统管理 → 交易对管理

* 交易对列表（SPOT / SWAP）
* 启用 / 禁用交易对
* 交易规则查看（来自 OKX）
* 手动 / 定时同步 OKX 交易规则

---

### 4.2 系统管理 → 信号配置

* 选择交易对（来源：trading_pair）
* 绑定 signal_name（TradingView）
* 启用 / 禁用配置
* symbol 用于 webhook 匹配

---

## 五、开发任务拆解（可直接排期）

### 🟢 P0（必须完成｜最小闭环）

#### 数据层

* [ ] trading_pair 表建表
* [ ] exchange_market_pair 表建表（OKX）
* [ ] signal_config 增加 trading_pair_id（保留 symbol）

#### 同步能力

* [ ] 对接 OKX instruments 接口
* [ ] 解析 SPOT / SWAP 交易对
* [ ] upsert trading_pair
* [ ] upsert exchange_market_pair

#### 信号配置

* [ ] 信号配置创建（symbol + trading_pair_id）
* [ ] webhook 根据 symbol 命中 signal_config

---

### 🟡 P1（核心可用）

#### 交易校验

* [ ] 下单前读取 exchange_market_pair
* [ ] 精度 / 最小下单量校验
* [ ] 状态校验（TRADING）

#### 风控接入

* [ ] 风控金额计算依赖交易规则
* [ ] 风控命中记录（为后续模块预留）

---

### 🔵 P2（增强 & 可运营）

* [ ] 交易规则变更记录（快照）
* [ ] 交易对规则对比（新旧）
* [ ] 支持 MOCK / 回测规则来源

---

## 六、当前阶段的明确取舍（记录在案）

* 不支持多交易所（仅 OKX）
* 不拆 exchange / market 独立表
* 不在 signal 阶段做任何规则校验

> 以上取舍为 **当前阶段最优解**，不是架构缺陷。

---

## 七、完成标准（Definition of Done）

* signal_config 同时具备 symbol + trading_pair_id
* 所有交易参数校验均来自 exchange_market_pair
* 新增交易对无需改信号 / 策略代码

---

> 本文档作为：
>
> * 开发排期依据
> * 后续模块设计的上游约束
