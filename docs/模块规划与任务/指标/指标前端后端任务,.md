下面我按**“任务项（可直接进 Jira/飞书）+ 验收标准（可测可签字）”**给你一套最小可跑的开发清单。目标是：**指标模块前端能验证闭环**，但**不引入一堆你们后端暂时不支持的新能力**。

> 总原则：**前端只消费“已有落库事实”**（`indicator_definition / indicator_subscription / indicator_value / indicator_calc_log`），不要求你们去做复杂的实时推送、聚合配置表、补算联动等。

---

# 0. 交付范围（冻结为 UI-MVP）

只交付这 5 个页面（跟原型一致）：

1. 仪表盘 Dashboard（看系统在算）
2. 指标定义 Definitions（只读）
3. 指标订阅 Subscriptions（增/查/启停）
4. 指标结果 Values（latest / history）
5. 计算日志 Logs（筛选 + 详情）

**不做**：用户自定义指标定义、WebSocket 推送、聚合配置管理、补算任务、权限复杂化（先假设你们已有登录与 userId 上下文）。

---

# 1. Epic：Indicator UI-MVP（前后端联调）

**验收总目标**：用 UI 在 10 分钟内完成一次闭环验证
“创建订阅 → 等到下一根 bar close → UI 看到 calc_log → UI 看到 indicator_value（latest）”

---

## A. 后端任务（最小新增 / 只读优先）

### A1【P0】补齐/确认只读 API：指标定义列表

* **任务**：`GET /api/indicator/definitions`
* **支持参数**：`keyword, category, engine, enabled, page, size`
* **返回字段（最小）**：

  * `id, userId, indicatorCode, indicatorName, indicatorVersion, category, engine, minRequiredBars, supportedTimeframes, enabled, paramSchema, returnSchema`
* **验收**：

  1. 请求可分页返回，默认按 `updated_at desc`
  2. `paramSchema/returnSchema` 为 JSON 字符串或 JSON 对象（二选一固定）
  3. 前端能展示列表并打开 schema 详情

---

### A2【P0】订阅管理 API（增/查/启停）

* **任务1**：`GET /api/indicator/subscriptions`

  * 参数：`userId, tradingPairId, symbolKeyword, timeframe, indicatorCode, enabled, page, size`
* **任务2**：`POST /api/indicator/subscriptions`

  * Body：`userId, tradingPairId, timeframe, indicatorCode, indicatorVersion, params(JSON), enabled`
* **任务3**：`PATCH /api/indicator/subscriptions/{id}`

  * Body：`enabled`（**只做启停**，不做编辑 params，避免引入 conflict 新复杂度）
* **验收**：

  1. 能创建订阅；命中唯一键冲突时返回明确错误（HTTP 409 + message）
  2. 能启停订阅；停用后 UI 仍可查到该订阅
  3. 订阅创建后，后端不需要做任何“即时计算”，等事件自然触发即可

---

### A3【P0】指标结果查询 API（latest / history）

* **任务1**：`GET /api/indicator/values/latest`

  * 参数：`userId, tradingPairId, timeframe, indicatorCode, indicatorVersion`
  * 行为：返回每个订阅维度的最新一条（或按筛选维度最新）
* **任务2**：`GET /api/indicator/values`

  * 参数：`userId, tradingPairId, timeframe, indicatorCode, indicatorVersion, startTime, endTime, page, size`
* **返回字段（最小）**：

  * `userId, tradingPairId, symbol, marketType, timeframe, barTime, indicatorCode, indicatorVersion, value, extraValues, dataQuality, calcEngine, calcFingerprint, calcCostMs, createdAt`
* **验收**：

  1. latest 接口返回稳定（每个 key 最新一条）
  2. history 可按时间范围查询，按 `bar_time desc`
  3. 前端能从日志跳转到 value（同 key + bar_time）

---

### A4【P0】计算日志查询 API（筛选 + 详情）

* **任务1**：`GET /api/indicator/calc-logs`

  * 参数：`userId, tradingPairId, timeframe, indicatorCode, status, startTime, endTime, page, size`
* **任务2（可选但建议）**：`GET /api/indicator/calc-logs/{id}`
* **返回字段（最小）**：

  * `id, userId, tradingPairId, symbol, timeframe, barTime, indicatorCode, indicatorVersion, calcStatus, calcFingerprint, costMs, errorMsg, createdAt`
* **验收**：

  1. status 支持 `SUCCESS/FAILED/CONFLICT`（你们目前没有 CONFLICT 也没关系，但接口要能传）
  2. errorMsg 超长时仍完整返回（前端抽屉展示）
  3. 前端仪表盘能拉到最近 20 条并下钻

---

### A5【P0】辅助数据 API（下拉）

* **任务**：`GET /api/trading-pairs`（或你们现有接口复用）
* **返回**：`tradingPairId, symbol, marketType, symbolOnExchange`
* **验收**：前端“新建订阅”弹窗能选交易对

---

## B. 前端任务（Thymeleaf / 你们当前栈友好）

### B1【P0】指标模块路由与菜单

* **任务**：新增菜单“指标模块”，含 5 个页面入口
* **验收**：5 页面可切换，统一布局/样式

---

### B2【P0】订阅页（核心）

* **任务**：

  * 订阅列表 + 筛选（user/symbol/tf/enabled）
  * 新建订阅弹窗（交易对、tf、指标、params JSON、启用）
  * 启停按钮（PATCH）
* **验收**：

  1. 能创建订阅并在列表出现
  2. 能启停，状态实时刷新
  3. timeframe 下拉 **不出现 1m**

---

### B3【P0】计算日志页 + 详情抽屉

* **任务**：列表筛选 + 点击行打开抽屉
* **验收**：

  1. 抽屉展示 fingerprint、params（如果后端不返 params，则不展示 params）
  2. 能按 status 快速筛选
  3. 与 values 页可互相跳转（通过筛选条件实现）

---

### B4【P0】指标结果页（latest 默认）

* **任务**：latest toggle + history
* **验收**：

  1. 默认 latest only（可切 history）
  2. 能展示 value/extra_values/data_quality
  3. 点击一条 value 可打开详情抽屉

---

### B5【P1】仪表盘（可放后一点，但建议做）

* **任务**：统计卡片 + 最近 20 条日志 + 自动刷新开关
* **验收**：

  1. 能看到“最近一次 bar_time”相关信息（来自日志或 value）
  2. 自动刷新可开关（默认关）

---

## C. 测试与验收（QA 可照着跑）

### C1【P0】闭环验收用例（必须）

**步骤**：

1. 在订阅页创建：BTC-USDT-SWAP + 1h + RSI(period=14)，enabled=true
2. 等待下一根 1h bar close（或你们用测试环境模拟触发）
3. 在日志页筛选该 symbol+tf，出现一条日志（SUCCESS/FAILED/CONFLICT 任一）
4. 若 SUCCESS：在结果页 latest 能看到 RSI 最新值（bar_time 相同）
   **通过标准**：步骤 1~4 能在 UI 完整完成，且值/日志能互相定位

---

### C2【P1】停用订阅不再产出（建议）

* 停用订阅后，下一次 bar close 不再出现该订阅对应的 calc_log / value（允许已有历史保留）

---

# 2. 任务优先级与“什么时候做”

### 立即做（P0：为了让 UI 能跑通闭环）

A1~A5 + B1~B4 + C1

### 可稍后做（P1：不影响跑通，但影响体验）

B5（Dashboard 自动刷新/统计）、C2（停用验证）、更精细筛选与排序

### 明确不做（本轮不做 / 不在 UI-MVP）

* aggregation_config 表与管理页面
* 校准联动/指标补算
* 用户自定义指标 definition 的 UI
* WebSocket 推送实时更新（先轮询）

---

# 3. Definition of Done（统一完成标准）

一个任务算“Done”，必须满足：

1. 接口有 **Swagger/文档**（最少字段说明 + 示例）
2. 前端页面能 **真实调用接口**（不是 mock）
3. QA 按 C1 用例能跑通并截图留档

---

如果你愿意，我可以把以上任务再进一步变成**“可直接粘贴到 Jira 的格式”**（每个任务包含：描述、接口契约、字段、错误码、验收步骤、测试点）。你回我一句：
**“按 Jira 格式输出”** 我就直接给你排好。
