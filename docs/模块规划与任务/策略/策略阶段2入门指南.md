# ç­–ç•¥é˜¶æ®µ2ï¼ˆDecision Engineï¼‰æ–°æ‰‹å…¥é—¨æŒ‡å—

> **ç›®æ ‡è¯»è€…**ï¼šæ–°æ‰‹ç¨‹åºå‘˜ã€æ–°åŠ å…¥å›¢é˜Ÿçš„å¼€å‘è€…  
> **ç›®æ ‡**ï¼šå¿«é€Ÿç†è§£ç­–ç•¥é˜¶æ®µ2çš„ä¸šåŠ¡é€»è¾‘ã€æ ¸å¿ƒä»£ç å’Œç³»ç»Ÿæ¶æ„  
> **ç‰ˆæœ¬**ï¼šv1.0  
> **æ›´æ–°æ—¶é—´**ï¼š2024

---

## ğŸ“š ç›®å½•

1. [ä¸šåŠ¡èƒŒæ™¯](#ä¸šåŠ¡èƒŒæ™¯)
2. [ç³»ç»Ÿåšä»€ä¹ˆ](#ç³»ç»Ÿåšä»€ä¹ˆ)
3. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
4. [ä»£ç ç»“æ„](#ä»£ç ç»“æ„)
5. [å†³ç­–æµç¨‹](#å†³ç­–æµç¨‹)
6. [å…³é”®ç»„ä»¶è¯¦è§£](#å…³é”®ç»„ä»¶è¯¦è§£)
7. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
8. [å¿«é€Ÿä¸Šæ‰‹](#å¿«é€Ÿä¸Šæ‰‹)

---

## ä¸€ã€ä¸šåŠ¡èƒŒæ™¯

### 1.1 ä»€ä¹ˆæ˜¯ç­–ç•¥å†³ç­–ï¼Ÿ

æƒ³è±¡ä½ æ˜¯ä¸€ä¸ªé‡åŒ–äº¤æ˜“å‘˜ï¼Œä½ æœ‰ä¸€å¥—äº¤æ˜“ç­–ç•¥ï¼š

- **ä¿¡å·é©±åŠ¨ç­–ç•¥**ï¼šçœ‹åˆ°"ä¹°å…¥"ä¿¡å·å°±å¼€ä»“ï¼Œçœ‹åˆ°"å–å‡º"ä¿¡å·å°±å¹³ä»“
- **æŒ‡æ ‡é©±åŠ¨ç­–ç•¥**ï¼šRSIæŒ‡æ ‡ < 30 æ—¶å¼€ä»“ï¼ŒRSIæŒ‡æ ‡ > 70 æ—¶å¹³ä»“
- **æ··åˆç­–ç•¥**ï¼šæ—¢è¦çœ‹ä¿¡å·ï¼Œåˆè¦çœ‹æŒ‡æ ‡ï¼Œéƒ½æ»¡è¶³æ‰äº¤æ˜“

**ç­–ç•¥é˜¶æ®µ2ï¼ˆDecision Engineï¼‰**å°±æ˜¯ç³»ç»Ÿçš„"å¤§è„‘"ï¼Œè´Ÿè´£ï¼š
- æ¥æ”¶å„ç§è§¦å‘äº‹ä»¶ï¼ˆä¿¡å·ã€æŒ‡æ ‡ã€Kçº¿ã€ä»·æ ¼ï¼‰
- æ ¹æ®ç­–ç•¥è§„åˆ™è®¡ç®—"åº”è¯¥åšä»€ä¹ˆ"ï¼ˆå¼€ä»“/å¹³ä»“/åŠ ä»“/å‡ä»“/åæ‰‹/ä¸åŠ¨ä½œï¼‰
- æŠŠå†³ç­–ç»“æœè®°å½•ä¸‹æ¥ï¼Œä¾›åç»­æ‰§è¡Œ

### 1.2 ä¸ºä»€ä¹ˆéœ€è¦é˜¶æ®µ2ï¼Ÿ

**é—®é¢˜**ï¼šç­–ç•¥ä»€ä¹ˆæ—¶å€™åº”è¯¥äº¤æ˜“ï¼Ÿæ€ä¹ˆå†³å®šäº¤æ˜“æ–¹å‘ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼šé˜¶æ®µ2å®ç°äº†**äº‹ä»¶é©±åŠ¨çš„å†³ç­–å¼•æ“**ï¼Œå½“æ»¡è¶³æ¡ä»¶æ—¶è‡ªåŠ¨è§¦å‘å†³ç­–ã€‚

**å…³é”®çº¦æŸ**ï¼š
- âœ… åªåšå†³ç­–ï¼Œä¸æ‰§è¡Œäº¤æ˜“ï¼ˆæ‰§è¡Œæ˜¯é˜¶æ®µ3çš„äº‹ï¼‰
- âœ… åªè®°å½•"åŠ¨ä½œæ„å›¾"ï¼ˆOPEN/CLOSEç­‰ï¼‰ï¼ŒHOLDä¸è®°å½•
- âœ… ä¿è¯å¹‚ç­‰æ€§ï¼ˆåŒä¸€äº‹ä»¶ä¸é‡å¤å†³ç­–ï¼‰
- âœ… ä¿è¯ä¸²è¡Œæ‰§è¡Œï¼ˆåŒä¸€ç­–ç•¥å®ä¾‹ä¸ä¼šå¹¶å‘å†³ç­–ï¼‰

---

## äºŒã€ç³»ç»Ÿåšä»€ä¹ˆ

### 2.1 æ ¸å¿ƒåŠŸèƒ½

é˜¶æ®µ2å®ç°äº†**å®Œæ•´çš„å†³ç­–æµç¨‹**ï¼š

```
è§¦å‘äº‹ä»¶åˆ°è¾¾
  â†“
æ‰¾åˆ°å—å½±å“çš„ç­–ç•¥å®ä¾‹
  â†“
é‡‡é›†å†³ç­–æ‰€éœ€çš„æ‰€æœ‰æ•°æ®ï¼ˆå¿«ç…§ï¼‰
  â†“
é—¨ç¦æ ¡éªŒï¼ˆé˜¶æ®µ/æ—¶æ•ˆ/å»é‡/åˆç†æ€§ï¼‰
  â†“
ç­–ç•¥é€»è¾‘è®¡ç®—ï¼ˆæ ¹æ®ç­–ç•¥ç±»å‹ï¼‰
  â†“
è®°å½•å†³ç­–ç»“æœï¼ˆå¦‚æœæ˜¯åŠ¨ä½œæ„å›¾ï¼‰
```

### 2.2 å››ç§è§¦å‘æº

ç³»ç»Ÿæ”¯æŒå››ç§è§¦å‘æºï¼š

| è§¦å‘æº | è¯´æ˜ | ç¤ºä¾‹ |
|--------|------|------|
| **ä¿¡å·è§¦å‘** | å¤–éƒ¨ä¿¡å·ï¼ˆå¦‚TradingViewï¼‰æ¿€æ´» | æ”¶åˆ°"ä¹°å…¥"ä¿¡å· â†’ è§¦å‘å†³ç­– |
| **æŒ‡æ ‡è§¦å‘** | æŠ€æœ¯æŒ‡æ ‡è®¡ç®—å®Œæˆ | RSIè®¡ç®—å®Œæˆ â†’ è§¦å‘å†³ç­– |
| **Kçº¿è§¦å‘** | ä¸€æ ¹Kçº¿å®Œæˆ | 1å°æ—¶Kçº¿æ”¶ç›˜ â†’ è§¦å‘å†³ç­– |
| **ä»·æ ¼è§¦å‘** | ä»·æ ¼ç©¿è¶Šé˜ˆå€¼ | ä»·æ ¼è·Œç ´æ­¢æŸä»· â†’ è§¦å‘å†³ç­– |

### 2.3 å†³ç­–ç»“æœ

å†³ç­–ç»“æœæœ‰ä¸¤ç§ï¼š

1. **åŠ¨ä½œæ„å›¾**ï¼ˆéœ€è¦è½åº“ï¼‰ï¼š
   - `OPEN`ï¼šå¼€ä»“
   - `CLOSE`ï¼šå¹³ä»“
   - `ADD`ï¼šåŠ ä»“
   - `REDUCE`ï¼šå‡ä»“
   - `REVERSE`ï¼šåæ‰‹

2. **ä¸åŠ¨ä½œ**ï¼ˆä¸è½åº“ï¼‰ï¼š
   - `HOLD`ï¼šä¿æŒå½“å‰çŠ¶æ€

---

## ä¸‰ã€æ ¸å¿ƒæ¦‚å¿µ

### 3.1 StrategyInstanceï¼ˆç­–ç•¥å®ä¾‹ï¼‰

**ä¸€ä¸ªç­–ç•¥ + ä¸€ä¸ªäº¤æ˜“å¯¹ = ä¸€ä¸ªå®ä¾‹**

ä¾‹å¦‚ï¼š
- ç­–ç•¥Aåœ¨BTC-USDTä¸Šè¿è¡Œ â†’ å®ä¾‹1
- ç­–ç•¥Aåœ¨ETH-USDTä¸Šè¿è¡Œ â†’ å®ä¾‹2
- ç­–ç•¥Båœ¨BTC-USDTä¸Šè¿è¡Œ â†’ å®ä¾‹3

æ¯ä¸ªå®ä¾‹æœ‰è‡ªå·±ç‹¬ç«‹çš„ï¼š
- é€»è¾‘çŠ¶æ€ï¼ˆæŒä»“æ–¹å‘ã€æ•°é‡ã€é˜¶æ®µï¼‰
- ä¿¡å·è§†å›¾ï¼ˆè®¢é˜…çš„ä¿¡å·ï¼‰
- å†³ç­–å†å²

### 3.2 DecisionContextï¼ˆå†³ç­–ä¸Šä¸‹æ–‡ï¼‰

**å†³ç­–æ—¶çš„"å¿«ç…§"**ï¼ŒåŒ…å«æ‰€æœ‰å†³ç­–æ‰€éœ€çš„æ•°æ®ï¼š

```java
DecisionContext {
    userId: ç”¨æˆ·ID
    strategyId: ç­–ç•¥ID
    tradingPairId: äº¤æ˜“å¯¹ID
    triggerType: è§¦å‘ç±»å‹ï¼ˆSIGNAL/INDICATOR/BAR/PRICEï¼‰
    
    // æ•°æ®å¿«ç…§ï¼ˆä¸å¯å˜ï¼‰
    logicStateBefore: å†³ç­–å‰çš„é€»è¾‘çŠ¶æ€
    paramSnapshot: ç­–ç•¥å‚æ•°
    signalSnapshot: ä¿¡å·å¿«ç…§ï¼ˆå¦‚æœæœ‰ï¼‰
    indicatorSnapshot: æŒ‡æ ‡å¿«ç…§ï¼ˆå¦‚æœæœ‰ï¼‰
    barSnapshot: Kçº¿å¿«ç…§ï¼ˆå¦‚æœæœ‰ï¼‰
    priceSnapshot: ä»·æ ¼å¿«ç…§ï¼ˆå¦‚æœæœ‰ï¼‰
}
```

**ä¸ºä»€ä¹ˆç”¨å¿«ç…§ï¼Ÿ**
- ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼ˆæ‰€æœ‰æ•°æ®éƒ½æ˜¯åŒä¸€æ—¶é—´ç‚¹çš„ï¼‰
- ä¸å¯å˜ï¼Œé˜²æ­¢è¢«ä¿®æ”¹
- ä¾¿äºå›æ”¾å’Œå®¡è®¡

### 3.3 GuardChainï¼ˆé—¨ç¦é“¾ï¼‰

**å†³ç­–å‰çš„"å®‰å…¨æ£€æŸ¥"**ï¼ŒåŒ…æ‹¬4ä¸ªé—¨ç¦ï¼š

1. **PhaseGateï¼ˆé˜¶æ®µé—¨ç¦ï¼‰**ï¼šæ ¡éªŒç­–ç•¥é˜¶æ®µæ˜¯å¦å…è®¸å†³ç­–
2. **StalenessGateï¼ˆæ—¶æ•ˆé—¨ç¦ï¼‰**ï¼šæ ¡éªŒæ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆå¦‚ä¿¡å·æ˜¯å¦åœ¨30ç§’å†…ï¼‰
3. **DedupGateï¼ˆå»é‡é—¨ç¦ï¼‰**ï¼šé˜²æ­¢åŒä¸€äº‹ä»¶é‡å¤è§¦å‘
4. **SanityGateï¼ˆåˆç†æ€§é—¨ç¦ï¼‰**ï¼šæ ¡éªŒæ•°æ®æ˜¯å¦åˆç†ï¼ˆä»·æ ¼>0ã€å‚æ•°æœ‰æ•ˆç­‰ï¼‰

**ä»»ä¸€é—¨ç¦æ‹’ç»ï¼Œå†³ç­–ç«‹å³åœæ­¢**ã€‚

### 3.4 StrategyLogicï¼ˆç­–ç•¥é€»è¾‘ï¼‰

**ç­–ç•¥çš„"å¤§è„‘"**ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡è®¡ç®—å†³ç­–ç»“æœã€‚

æ”¯æŒä¸‰ç§ç­–ç•¥ç±»å‹ï¼š

1. **SignalDrivenStrategyLogic**ï¼šä¿¡å·é©±åŠ¨
   - ç©ºä»“ + BUYä¿¡å· â†’ OPEN LONG
   - æŒä»“LONG + SELLä¿¡å· â†’ CLOSE

2. **IndicatorDrivenStrategyLogic**ï¼šæŒ‡æ ‡é©±åŠ¨
   - ç©ºä»“ + å…¥åœºæ¡ä»¶æ»¡è¶³ â†’ OPEN
   - æŒä»“ + å‡ºåœºæ¡ä»¶æ»¡è¶³ â†’ CLOSE

3. **HybridStrategyLogic**ï¼šæ··åˆç­–ç•¥
   - ä¿¡å·å’ŒæŒ‡æ ‡éƒ½æ»¡è¶³ï¼ˆALLæ¨¡å¼ï¼‰æˆ–ä»»ä¸€æ»¡è¶³ï¼ˆANYæ¨¡å¼ï¼‰â†’ è§¦å‘

### 3.5 å¹‚ç­‰æ€§ï¼ˆIdempotencyï¼‰

**åŒä¸€äº‹ä»¶é‡å¤è§¦å‘ï¼Œåªäº§ç”Ÿä¸€æ¬¡å†³ç­–**ã€‚

ä¾‹å¦‚ï¼š
- ä¿¡å·äº‹ä»¶é‡å¤å‘å¸ƒ100æ¬¡ â†’ åªå†™1æ¡å†³ç­–è®°å½•
- ä»·æ ¼åœ¨æ­¢æŸä»·é™„è¿‘æŠ–åŠ¨ â†’ åªè§¦å‘1æ¬¡å¹³ä»“

**å®ç°æ–¹å¼**ï¼š
- ä½¿ç”¨Redisç¼“å­˜å»é‡é”®ï¼ˆé™çº§åˆ°å†…å­˜ç¼“å­˜ï¼‰
- å»é‡é”®æ ¼å¼ï¼š`{triggerType}:{strategyId}:{tradingPairId}:{uniqueKey}`

---

## å››ã€ä»£ç ç»“æ„

### 4.1 ç›®å½•ç»“æ„

```
src/main/java/com/qyl/v2trade/business/strategy/decision/
â”œâ”€â”€ event/                          # å†³ç­–äº‹ä»¶å®šä¹‰
â”‚   â”œâ”€â”€ SignalIntentActivatedEvent.java      # ä¿¡å·æ¿€æ´»äº‹ä»¶
â”‚   â”œâ”€â”€ IndicatorComputedEvent.java         # æŒ‡æ ‡è®¡ç®—å®Œæˆäº‹ä»¶
â”‚   â”œâ”€â”€ PriceTriggeredDecisionEvent.java    # ä»·æ ¼é˜ˆå€¼ç©¿è¶Šäº‹ä»¶
â”‚   â””â”€â”€ (BarClosedEventä½¿ç”¨indicatoræ¨¡å—çš„)
â”‚
â”œâ”€â”€ executor/                       # ä¸²è¡Œæ‰§è¡Œå™¨
â”‚   â”œâ”€â”€ StripedExecutor.java        # åˆ†ç‰‡æ‰§è¡Œå™¨ï¼ˆä¿è¯ä¸²è¡Œï¼‰
â”‚   â””â”€â”€ InstanceKey.java            # å®ä¾‹é”®ï¼ˆç”¨äºhashåˆ†ç‰‡ï¼‰
â”‚
â”œâ”€â”€ router/                         # äº‹ä»¶è·¯ç”±
â”‚   â”œâ”€â”€ DecisionEventRouter.java    # äº‹ä»¶è·¯ç”±å™¨ï¼ˆè®¢é˜…äº‹ä»¶å¹¶è·¯ç”±ï¼‰
â”‚   â”œâ”€â”€ StrategyInstanceLocator.java # ç­–ç•¥å®ä¾‹å®šä½å™¨
â”‚   â””â”€â”€ DecisionTaskFactory.java    # å†³ç­–ä»»åŠ¡å·¥å‚
â”‚
â”œâ”€â”€ context/                        # å†³ç­–ä¸Šä¸‹æ–‡
â”‚   â”œâ”€â”€ DecisionContext.java        # å†³ç­–ä¸Šä¸‹æ–‡ï¼ˆä¸å¯å˜ï¼‰
â”‚   â””â”€â”€ snapshot/                   # æ•°æ®å¿«ç…§
â”‚       â”œâ”€â”€ LogicStateSnapshot.java # é€»è¾‘çŠ¶æ€å¿«ç…§
â”‚       â”œâ”€â”€ ParamSnapshot.java      # å‚æ•°å¿«ç…§
â”‚       â”œâ”€â”€ SignalSnapshot.java     # ä¿¡å·å¿«ç…§
â”‚       â”œâ”€â”€ IndicatorSnapshot.java  # æŒ‡æ ‡å¿«ç…§
â”‚       â”œâ”€â”€ BarSnapshot.java        # Kçº¿å¿«ç…§
â”‚       â””â”€â”€ PriceSnapshot.java      # ä»·æ ¼å¿«ç…§
â”‚
â”œâ”€â”€ sampler/                        # åŸå­é‡‡æ ·å™¨
â”‚   â”œâ”€â”€ AtomicSampler.java          # åŸå­é‡‡æ ·å™¨ï¼ˆé‡‡é›†æ‰€æœ‰æ•°æ®ï¼‰
â”‚   â””â”€â”€ PriceSnapshotLoader.java    # ä»·æ ¼å¿«ç…§åŠ è½½å™¨
â”‚
â”œâ”€â”€ guard/                          # é—¨ç¦é“¾
â”‚   â”œâ”€â”€ GuardChain.java             # é—¨ç¦é“¾ï¼ˆæŒ‰é¡ºåºæ‰§è¡Œï¼‰
â”‚   â”œâ”€â”€ Gate.java                   # é—¨ç¦æ¥å£
â”‚   â”œâ”€â”€ PhaseGate.java              # é˜¶æ®µé—¨ç¦
â”‚   â”œâ”€â”€ StalenessGate.java          # æ—¶æ•ˆé—¨ç¦
â”‚   â”œâ”€â”€ DedupGate.java              # å»é‡é—¨ç¦
â”‚   â””â”€â”€ SanityGate.java             # åˆç†æ€§é—¨ç¦
â”‚
â”œâ”€â”€ logic/                          # ç­–ç•¥é€»è¾‘
â”‚   â”œâ”€â”€ StrategyLogic.java          # ç­–ç•¥é€»è¾‘æ¥å£
â”‚   â”œâ”€â”€ StrategyLogicRegistry.java  # ç­–ç•¥é€»è¾‘æ³¨å†Œè¡¨
â”‚   â”œâ”€â”€ DecisionResult.java         # å†³ç­–ç»“æœ
â”‚   â”œâ”€â”€ DecisionReason.java         # å†³ç­–åŸå› 
â”‚   â”œâ”€â”€ condition/                   # æ¡ä»¶è¯„ä¼°å™¨
â”‚   â”‚   â”œâ”€â”€ ConditionEvaluator.java # æ¡ä»¶è¯„ä¼°å™¨
â”‚   â”‚   â”œâ”€â”€ EntryConditionEvaluator.java # å…¥åœºæ¡ä»¶è¯„ä¼°å™¨
â”‚   â”‚   â””â”€â”€ ExitConditionEvaluator.java  # å‡ºåœºæ¡ä»¶è¯„ä¼°å™¨
â”‚   â””â”€â”€ impl/                        # ç­–ç•¥é€»è¾‘å®ç°
â”‚       â”œâ”€â”€ SignalDrivenStrategyLogic.java    # ä¿¡å·é©±åŠ¨ç­–ç•¥
â”‚       â”œâ”€â”€ IndicatorDrivenStrategyLogic.java # æŒ‡æ ‡é©±åŠ¨ç­–ç•¥
â”‚       â””â”€â”€ HybridStrategyLogic.java          # æ··åˆç­–ç•¥
â”‚
â”œâ”€â”€ recorder/                       # è½åº“å™¨
â”‚   â”œâ”€â”€ IntentRecorder.java         # å†³ç­–è®°å½•è½åº“å™¨
â”‚   â””â”€â”€ DecisionReasonBuilder.java  # å†³ç­–åŸå› æ„å»ºå™¨ï¼ˆè½¬JSONï¼‰
â”‚
â””â”€â”€ engine/                         # å†³ç­–å¼•æ“
    â”œâ”€â”€ DecisionEngine.java         # å†³ç­–å¼•æ“æ¥å£
    â””â”€â”€ DecisionEngineImpl.java     # å†³ç­–å¼•æ“å®ç°ï¼ˆæ•´åˆæ‰€æœ‰ç»„ä»¶ï¼‰
```

### 4.2 æ ¸å¿ƒç±»è¯´æ˜

| ç±»å | èŒè´£ | å…³é”®æ–¹æ³• |
|------|------|----------|
| `DecisionEventRouter` | è®¢é˜…äº‹ä»¶ï¼Œè·¯ç”±åˆ°ç­–ç•¥å®ä¾‹ | `handleSignalIntentActivated()` ç­‰ |
| `StripedExecutor` | ä¿è¯åŒä¸€å®ä¾‹ä¸²è¡Œæ‰§è¡Œ | `submit(instanceKey, task)` |
| `AtomicSampler` | é‡‡é›†å†³ç­–ä¸Šä¸‹æ–‡ | `sample(instance, event)` |
| `GuardChain` | æ‰§è¡Œé—¨ç¦æ ¡éªŒ | `check(ctx)` |
| `StrategyLogicRegistry` | æ ¹æ®ç­–ç•¥ç±»å‹è·å–é€»è¾‘å®ç° | `getLogic(strategyType)` |
| `IntentRecorder` | å†™å…¥å†³ç­–è®°å½• | `record(ctx, result)` |
| `DecisionEngineImpl` | åè°ƒæ•´ä¸ªå†³ç­–æµç¨‹ | `executeDecision()` |

---

## äº”ã€å†³ç­–æµç¨‹

### 5.1 å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. äº‹ä»¶è§¦å‘ï¼ˆSignalIntentActivatedEventï¼‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. DecisionEventRouter æ¥æ”¶äº‹ä»¶                             â”‚
â”‚     - æ ¹æ® strategyId + tradingPairId æŸ¥æ‰¾ StrategyInstance â”‚
â”‚     - åˆ›å»ºå†³ç­–ä»»åŠ¡                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. StripedExecutor ä¸²è¡Œæ‰§è¡Œ                                 â”‚
â”‚     - æ ¹æ® instanceKey åšhashåˆ†ç‰‡                           â”‚
â”‚     - åŒä¸€å®ä¾‹çš„ä»»åŠ¡åœ¨åŒä¸€çº¿ç¨‹æ‰§è¡Œ                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. DecisionEngine æ‰§è¡Œå†³ç­–                                  â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚ 4.1 AtomicSampler é‡‡é›†ä¸Šä¸‹æ–‡                      â”‚   â”‚
â”‚     â”‚     - è¯»å– logic_stateï¼ˆå½“å‰çŠ¶æ€ï¼‰                 â”‚   â”‚
â”‚     â”‚     - è¯»å– strategy_paramï¼ˆç­–ç•¥å‚æ•°ï¼‰              â”‚   â”‚
â”‚     â”‚     - è¯»å– signal_intentï¼ˆæœ€æ–°ä¿¡å·ï¼‰               â”‚   â”‚
â”‚     â”‚     - è¯»å– indicator_valueï¼ˆæœ€æ–°æŒ‡æ ‡ï¼‰             â”‚   â”‚
â”‚     â”‚     - è¯»å–ä»·æ ¼å¿«ç…§                                 â”‚   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â†“                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚ 4.2 GuardChain é—¨ç¦æ ¡éªŒ                            â”‚   â”‚
â”‚     â”‚     - PhaseGateï¼šé˜¶æ®µæ ¡éªŒ                           â”‚   â”‚
â”‚     â”‚     - StalenessGateï¼šæ—¶æ•ˆæ ¡éªŒ                       â”‚   â”‚
â”‚     â”‚     - DedupGateï¼šå»é‡æ ¡éªŒ                           â”‚   â”‚
â”‚     â”‚     - SanityGateï¼šåˆç†æ€§æ ¡éªŒ                        â”‚   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â†“                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚ 4.3 StrategyLogic è®¡ç®—å†³ç­–                         â”‚   â”‚
â”‚     â”‚     - æ ¹æ® strategyType è·å–é€»è¾‘å®ç°               â”‚   â”‚
â”‚     â”‚     - æ‰§è¡Œå†³ç­–è®¡ç®—ï¼ˆçº¯å‡½æ•°ï¼‰                        â”‚   â”‚
â”‚     â”‚     - è¿”å› DecisionResult                          â”‚   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                     â†“                                         â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚     â”‚ 4.4 IntentRecorder è½åº“                            â”‚   â”‚
â”‚     â”‚     - åªå†™å…¥åŠ¨ä½œæ„å›¾ï¼ˆOPEN/CLOSEç­‰ï¼‰               â”‚   â”‚
â”‚     â”‚     - HOLDä¸è½åº“                                    â”‚   â”‚
â”‚     â”‚     - decision_reason ä¸ºç»“æ„åŒ–JSON                  â”‚   â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ä»£ç ç¤ºä¾‹

**å®Œæ•´çš„å†³ç­–æµç¨‹ï¼ˆä¼ªä»£ç ï¼‰**ï¼š

```java
// 1. äº‹ä»¶è§¦å‘
SignalIntentActivatedEvent event = new SignalIntentActivatedEvent(...);

// 2. è·¯ç”±åˆ°ç­–ç•¥å®ä¾‹
StrategyInstance instance = instanceLocator.locateByStrategyAndPair(
    event.getStrategyId(), event.getTradingPairId()
);

// 3. æŠ•é€’åˆ°ä¸²è¡Œæ‰§è¡Œå™¨
InstanceKey key = InstanceKey.of(instance.getStrategyId(), instance.getTradingPairId());
stripedExecutor.submit(key, () -> {
    // 4. æ‰§è¡Œå†³ç­–
    decisionEngine.executeDecision(instance, event);
});
```

**DecisionEngine.executeDecision() å†…éƒ¨**ï¼š

```java
// 4.1 é‡‡é›†ä¸Šä¸‹æ–‡
DecisionContext ctx = sampler.sample(instance, event);

// 4.2 é—¨ç¦æ ¡éªŒ
GuardResult guardResult = guardChain.check(ctx);
if (!guardResult.isAllowed()) {
    return;  // è¢«æ‹¦æˆªï¼Œåœæ­¢
}

// 4.3 ç­–ç•¥é€»è¾‘è®¡ç®—
StrategyLogic logic = logicRegistry.getLogic(ctx.getStrategyType());
DecisionResult result = logic.decide(ctx);

// 4.4 è½åº“ï¼ˆä»…åŠ¨ä½œæ„å›¾ï¼‰
if (result.isActionIntent()) {
    recorder.record(ctx, result);
}
```

---

## å…­ã€å…³é”®ç»„ä»¶è¯¦è§£

### 6.1 StripedExecutorï¼ˆä¸²è¡Œæ‰§è¡Œå™¨ï¼‰

**é—®é¢˜**ï¼šä¸ºä»€ä¹ˆéœ€è¦ä¸²è¡Œæ‰§è¡Œï¼Ÿ

**ç­”æ¡ˆ**ï¼šé˜²æ­¢å¹¶å‘å†³ç­–å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€‚

**å®ç°**ï¼š
- ä½¿ç”¨hashåˆ†ç‰‡ï¼Œå°†ä¸åŒçš„å®ä¾‹åˆ†é…åˆ°ä¸åŒçš„çº¿ç¨‹
- åŒä¸€å®ä¾‹çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ä¸²è¡Œæ‰§è¡Œ
- ä¸åŒå®ä¾‹å¯ä»¥å¹¶è¡Œæ‰§è¡Œï¼ˆæé«˜ååé‡ï¼‰

**ä»£ç ç¤ºä¾‹**ï¼š

```java
// æ ¹æ® instanceKey çš„hashå€¼é€‰æ‹©åˆ†ç‰‡
int stripeIndex = Math.abs(instanceKey.hashCode()) % stripeCount;
ExecutorService stripe = stripes[stripeIndex];
stripe.submit(task);  // åœ¨åŒä¸€çº¿ç¨‹ä¸­æ‰§è¡Œ
```

### 6.2 AtomicSamplerï¼ˆåŸå­é‡‡æ ·å™¨ï¼‰

**é—®é¢˜**ï¼šä¸ºä»€ä¹ˆå«"åŸå­"é‡‡æ ·ï¼Ÿ

**ç­”æ¡ˆ**ï¼šåœ¨åŒä¸€æ—¶é—´ç‚¹é‡‡é›†æ‰€æœ‰æ•°æ®ï¼Œä¿è¯æ•°æ®ä¸€è‡´æ€§ã€‚

**é‡‡é›†çš„æ•°æ®**ï¼š
1. `strategy_logic_state`ï¼šå½“å‰é€»è¾‘çŠ¶æ€
2. `strategy_param`ï¼šç­–ç•¥å‚æ•°
3. `signal_intent`ï¼šæœ€æ–°ä¿¡å·ï¼ˆLATEST_ONLYï¼‰
4. `indicator_value`ï¼šæœ€æ–°æŒ‡æ ‡å€¼
5. ä»·æ ¼å¿«ç…§ï¼šæœ€æ–°ä»·æ ¼

**ä»£ç ç¤ºä¾‹**ï¼š

```java
// ä¿¡å·è§¦å‘æ—¶çš„é‡‡æ ·
DecisionContext ctx = sampler.sample(instance, event);
// å†…éƒ¨ä¼šï¼š
// 1. è¯»å– logic_state
// 2. è¯»å– param
// 3. è¯»å– signal_intentï¼ˆLATEST_ONLYï¼‰
// 4. è¯»å– indicator_valueï¼ˆå¦‚æœæœ‰è®¢é˜…ï¼‰
// 5. è¯»å–ä»·æ ¼å¿«ç…§
// æ‰€æœ‰æ•°æ®éƒ½æ˜¯åŒä¸€æ—¶é—´ç‚¹çš„å¿«ç…§
```

### 6.3 GuardChainï¼ˆé—¨ç¦é“¾ï¼‰

**é—®é¢˜**ï¼šé—¨ç¦é“¾çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

**ç­”æ¡ˆ**ï¼šåœ¨å†³ç­–å‰è¿›è¡Œå¤šå±‚å®‰å…¨æ£€æŸ¥ï¼Œé˜²æ­¢é”™è¯¯å†³ç­–ã€‚

**å››ä¸ªé—¨ç¦**ï¼š

1. **PhaseGate**ï¼šæ ¡éªŒç­–ç•¥é˜¶æ®µ
   - ç©ºä»“åªå…è®¸OPEN
   - æŒä»“å…è®¸CLOSE/REDUCE/ADD

2. **StalenessGate**ï¼šæ ¡éªŒæ•°æ®æ—¶æ•ˆ
   - ä¿¡å·å¿…é¡»åœ¨30ç§’å†…ï¼ˆå¯é…ç½®ï¼‰
   - æŒ‡æ ‡é©±åŠ¨ç­–ç•¥å¿…é¡»æœ‰æŒ‡æ ‡å€¼

3. **DedupGate**ï¼šé˜²æ­¢é‡å¤è§¦å‘
   - ä½¿ç”¨Redisç¼“å­˜å»é‡é”®
   - åŒä¸€å»é‡é”®åªè§¦å‘ä¸€æ¬¡

4. **SanityGate**ï¼šæ ¡éªŒæ•°æ®åˆç†æ€§
   - ä»·æ ¼å¿…é¡» > 0
   - å‚æ•°å¿…é¡»æœ‰æ•ˆ

**ä»£ç ç¤ºä¾‹**ï¼š

```java
// æŒ‰é¡ºåºæ‰§è¡Œé—¨ç¦
for (Gate gate : gates) {
    GuardResult result = gate.check(ctx);
    if (!result.isAllowed()) {
        return result;  // ä»»ä¸€é—¨ç¦æ‹’ç»ï¼Œç«‹å³è¿”å›
    }
}
return GuardResult.allowed();  // æ‰€æœ‰é—¨ç¦é€šè¿‡
```

### 6.4 StrategyLogicï¼ˆç­–ç•¥é€»è¾‘ï¼‰

**é—®é¢˜**ï¼šç­–ç•¥é€»è¾‘æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ

**ç­”æ¡ˆ**ï¼šæ ¹æ®å†³ç­–ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨çº¯å‡½æ•°è®¡ç®—å†³ç­–ç»“æœã€‚

**ä¸‰ç§ç­–ç•¥ç±»å‹**ï¼š

1. **SignalDrivenStrategyLogic**ï¼š
   ```java
   // ç©ºä»“ + BUYä¿¡å· â†’ OPEN
   if (isFlat && "BUY".equals(signalDirection)) {
       return DecisionResult.action(OPEN, calculatedQty, reason);
   }
   ```

2. **IndicatorDrivenStrategyLogic**ï¼š
   ```java
   // ç©ºä»“ + å…¥åœºæ¡ä»¶æ»¡è¶³ â†’ OPEN
   if (isFlat && entryConditionMet) {
       return DecisionResult.action(OPEN, calculatedQty, reason);
   }
   ```

3. **HybridStrategyLogic**ï¼š
   ```java
   // ä¿¡å·å’ŒæŒ‡æ ‡éƒ½æ»¡è¶³ï¼ˆALLæ¨¡å¼ï¼‰æˆ–ä»»ä¸€æ»¡è¶³ï¼ˆANYæ¨¡å¼ï¼‰
   if (useAllMode) {
       // ä¸¤ä¸ªéƒ½æ»¡è¶³æ‰è§¦å‘
   } else {
       // ä»»ä¸€æ»¡è¶³å°±è§¦å‘
   }
   ```

### 6.5 IntentRecorderï¼ˆè½åº“å™¨ï¼‰

**é—®é¢˜**ï¼šä»€ä¹ˆæƒ…å†µä¸‹ä¼šè½åº“ï¼Ÿ

**ç­”æ¡ˆ**ï¼šåªæœ‰åŠ¨ä½œæ„å›¾ï¼ˆOPEN/CLOSE/ADD/REDUCE/REVERSEï¼‰æ‰è½åº“ï¼ŒHOLDä¸è½åº“ã€‚

**è½åº“å†…å®¹**ï¼š
- `intent_action`ï¼šå†³ç­–åŠ¨ä½œ
- `calculated_qty`ï¼šè®¡ç®—å‡ºçš„æ•°é‡
- `decision_reason`ï¼šç»“æ„åŒ–JSONï¼ˆåŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡ï¼‰

**decision_reason JSONç»“æ„**ï¼š

```json
{
  "trigger": {
    "type": "SIGNAL",
    "source": "123",
    "timestamp": "2024-01-01T10:00:00"
  },
  "logicStateBefore": {
    "phase": "IDLE",
    "positionSide": "FLAT",
    "positionQty": "0.0"
  },
  "snapshots": {
    "signal": {
      "intentId": 123,
      "direction": "BUY",
      "activatedAt": "2024-01-01T10:00:00"
    }
  },
  "paramsDigest": {
    "initialCapital": "10000.00",
    "baseOrderRatio": "0.1"
  },
  "decisionBasis": {
    "signalDirection": "BUY",
    "currentPosition": "FLAT",
    "action": "OPEN"
  },
  "stateChange": "ä¿¡å·æ–¹å‘=BUY, å½“å‰çŠ¶æ€=FLAT, å†³ç­–åŠ¨ä½œ=OPEN"
}
```

---

## ä¸ƒã€å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆå†³ç­–ä¸ç›´æ¥æ‰§è¡Œäº¤æ˜“ï¼Ÿ

**A**: é˜¶æ®µ2åªåš"å†³ç­–"ï¼Œä¸æ‰§è¡Œäº¤æ˜“ã€‚è¿™æ˜¯ä¸ºäº†ï¼š
- **èŒè´£åˆ†ç¦»**ï¼šå†³ç­–å’Œæ‰§è¡Œåˆ†å¼€ï¼Œä¾¿äºç»´æŠ¤
- **å¯å›æ”¾**ï¼šå†³ç­–è®°å½•å¯ä»¥å›æ”¾ï¼Œä¾¿äºå¤ç›˜
- **å¯å®¡è®¡**ï¼šæ‰€æœ‰å†³ç­–éƒ½æœ‰å®Œæ•´è®°å½•

**æ‰§è¡Œäº¤æ˜“æ˜¯é˜¶æ®µ3çš„äº‹**ã€‚

### Q2: ä¸ºä»€ä¹ˆåŒä¸€å®ä¾‹è¦ä¸²è¡Œæ‰§è¡Œï¼Ÿ

**A**: é˜²æ­¢å¹¶å‘å†³ç­–å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€‚

**ç¤ºä¾‹**ï¼š
- çº¿ç¨‹1è¯»å–çŠ¶æ€ï¼šæŒä»“LONG 0.1 BTC
- çº¿ç¨‹2è¯»å–çŠ¶æ€ï¼šæŒä»“LONG 0.1 BTC
- çº¿ç¨‹1å†³ç­–ï¼šå¹³ä»“ï¼ˆCLOSEï¼‰
- çº¿ç¨‹2å†³ç­–ï¼šåŠ ä»“ï¼ˆADDï¼‰
- ç»“æœï¼šçŠ¶æ€ä¸ä¸€è‡´ï¼

**ä¸²è¡Œæ‰§è¡Œå**ï¼š
- çº¿ç¨‹1å…ˆæ‰§è¡Œï¼šå¹³ä»“ â†’ çŠ¶æ€å˜ä¸ºFLAT
- çº¿ç¨‹2åæ‰§è¡Œï¼šè¯»å–çŠ¶æ€FLAT â†’ åªèƒ½OPENï¼Œä¸èƒ½ADD

### Q3: å»é‡æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

**A**: ä½¿ç”¨Redisç¼“å­˜å»é‡é”®ï¼ˆé™çº§åˆ°å†…å­˜ç¼“å­˜ï¼‰ã€‚

**å»é‡é”®æ ¼å¼**ï¼š
- ä¿¡å·ï¼š`SIGNAL:{strategyId}:{tradingPairId}:{signalIntentId}`
- æŒ‡æ ‡ï¼š`INDICATOR:{strategyId}:{tradingPairId}:{indicatorCode}:{barTime}`
- Kçº¿ï¼š`BAR:{strategyId}:{tradingPairId}:{timeframe}:{barCloseTime}`
- ä»·æ ¼ï¼š`PRICE:{strategyId}:{tradingPairId}:{triggerType}:{cooldownWindow}`

**æµç¨‹**ï¼š
1. æ„å»ºå»é‡é”®
2. æ£€æŸ¥Redisä¸­æ˜¯å¦å­˜åœ¨
3. å¦‚æœå­˜åœ¨ â†’ æ‹’ç»ï¼ˆé‡å¤ï¼‰
4. å¦‚æœä¸å­˜åœ¨ â†’ å†™å…¥Redisï¼ˆTTLæ ¹æ®è§¦å‘ç±»å‹è®¾ç½®ï¼‰

### Q4: HOLDä¸ºä»€ä¹ˆä¸è½åº“ï¼Ÿ

**A**: å› ä¸ºHOLDè¡¨ç¤º"ä¸åŠ¨ä½œ"ï¼Œæ²¡æœ‰å®é™…æ„ä¹‰ã€‚

**å¦‚æœHOLDä¹Ÿè½åº“**ï¼š
- æ•°æ®é‡çˆ†ç‚¸ï¼ˆå¤§éƒ¨åˆ†å†³ç­–éƒ½æ˜¯HOLDï¼‰
- æ²¡æœ‰å®é™…ä»·å€¼ï¼ˆHOLDä¸äº§ç”Ÿäº¤æ˜“ï¼‰

**HOLDåªè®°å½•metrics/log**ï¼Œç”¨äºç»Ÿè®¡å’Œè°ƒè¯•ã€‚

### Q5: decision_reasonä¸ºä»€ä¹ˆæ˜¯JSONï¼Ÿ

**A**: ä¸ºäº†å›æ”¾å’Œå®¡è®¡ã€‚

**ç»“æ„åŒ–JSONçš„å¥½å¤„**ï¼š
- å¯ä»¥è§£æå’ŒæŸ¥è¯¢
- åŒ…å«å®Œæ•´ä¸Šä¸‹æ–‡ï¼ˆä¾¿äºå›æ”¾ï¼‰
- ä¾¿äºå®¡è®¡å’Œè°ƒè¯•

**ç¤ºä¾‹**ï¼šå¯ä»¥é€šè¿‡`decision_reason`å›æ”¾å†³ç­–è¿‡ç¨‹ï¼Œçœ‹çœ‹å½“æ—¶çš„æ•°æ®æ˜¯ä»€ä¹ˆæ ·çš„ã€‚

---

## å…«ã€å¿«é€Ÿä¸Šæ‰‹

### 8.1 å¦‚ä½•æ·»åŠ æ–°çš„ç­–ç•¥ç±»å‹ï¼Ÿ

**æ­¥éª¤**ï¼š

1. å®ç° `StrategyLogic` æ¥å£ï¼š
   ```java
   @Component
   public class MyStrategyLogic implements StrategyLogic {
       @Override
       public String getSupportedStrategyType() {
           return "MY_STRATEGY_TYPE";
       }
       
       @Override
       public DecisionResult decide(DecisionContext ctx) {
           // å®ç°å†³ç­–é€»è¾‘
           return DecisionResult.action(OPEN, qty, reason);
       }
   }
   ```

2. åœ¨ `StrategyLogicRegistry` ä¸­è‡ªåŠ¨æ³¨å†Œï¼ˆSpringä¼šè‡ªåŠ¨æ‰«æï¼‰

3. åœ¨ `strategy_definition` è¡¨ä¸­è®¾ç½® `strategy_type = "MY_STRATEGY_TYPE"`

### 8.2 å¦‚ä½•è°ƒè¯•å†³ç­–æµç¨‹ï¼Ÿ

**æ–¹æ³•1ï¼šæŸ¥çœ‹æ—¥å¿—**

```java
// åœ¨ DecisionEngineImpl ä¸­å·²ç»æœ‰è¯¦ç»†æ—¥å¿—
log.debug("æ‰§è¡Œå†³ç­–ï¼ˆä¿¡å·è§¦å‘ï¼‰: strategyId={}, tradingPairId={}", ...);
log.debug("å†³ç­–è¢«é—¨ç¦æ‹¦æˆª: gate={}, reason={}", ...);
log.info("å†³ç­–è®°å½•å·²è½åº“: action={}, qty={}", ...);
```

**æ–¹æ³•2ï¼šæŸ¥çœ‹æ•°æ®åº“**

```sql
-- æŸ¥çœ‹å†³ç­–è®°å½•
SELECT * FROM strategy_intent_record 
WHERE strategy_id = 1 
ORDER BY created_at DESC 
LIMIT 10;

-- æŸ¥çœ‹å†³ç­–åŸå› ï¼ˆJSONï¼‰
SELECT decision_reason FROM strategy_intent_record 
WHERE id = 123;
```

**æ–¹æ³•3ï¼šæŸ¥çœ‹Rediså»é‡é”®**

```bash
# æŸ¥çœ‹æ‰€æœ‰å»é‡é”®
redis-cli KEYS "strategy:decision:dedup:*"
```

### 8.3 å¦‚ä½•æµ‹è¯•å†³ç­–æµç¨‹ï¼Ÿ

**å•å…ƒæµ‹è¯•ç¤ºä¾‹**ï¼š

```java
@Test
public void testSignalDrivenDecision() {
    // 1. å‡†å¤‡æ•°æ®
    StrategyInstance instance = createTestInstance();
    SignalIntentActivatedEvent event = createTestEvent();
    
    // 2. æ‰§è¡Œå†³ç­–
    DecisionContext ctx = sampler.sample(instance, event);
    GuardResult guardResult = guardChain.check(ctx);
    assertTrue(guardResult.isAllowed());
    
    StrategyLogic logic = logicRegistry.getLogic("SIGNAL_DRIVEN");
    DecisionResult result = logic.decide(ctx);
    
    // 3. éªŒè¯ç»“æœ
    assertEquals(IntentActionEnum.OPEN, result.getAction());
    assertTrue(result.getCalculatedQty().compareTo(BigDecimal.ZERO) > 0);
}
```

**é›†æˆæµ‹è¯•ç¤ºä¾‹**ï¼š

```java
@Test
public void testEndToEndDecision() {
    // 1. å‘å¸ƒä¿¡å·äº‹ä»¶
    SignalIntentActivatedEvent event = new SignalIntentActivatedEvent(
        this, userId, strategyId, tradingPairId,
        signalIntentId, signalId, "BUY", LocalDateTime.now()
    );
    eventPublisher.publishEvent(event);
    
    // 2. ç­‰å¾…å¤„ç†å®Œæˆ
    await().atMost(5, SECONDS).until(() -> {
        return intentRecordMapper.count(...) > 0;
    });
    
    // 3. éªŒè¯å†³ç­–è®°å½•
    StrategyIntentRecord record = intentRecordMapper.selectOne(...);
    assertEquals(IntentActionEnum.OPEN, record.getIntentActionEnum());
    assertNotNull(record.getDecisionReason());
}
```

### 8.4 å¦‚ä½•æŸ¥çœ‹å†³ç­–è®°å½•ï¼Ÿ

**SQLæŸ¥è¯¢**ï¼š

```sql
-- æŸ¥çœ‹æœ€è¿‘çš„å†³ç­–è®°å½•
SELECT 
    id,
    strategy_id,
    trading_pair_id,
    intent_action,
    calculated_qty,
    decision_reason,
    created_at
FROM strategy_intent_record
WHERE strategy_id = 1
ORDER BY created_at DESC
LIMIT 20;

-- æŸ¥çœ‹ç‰¹å®šäº¤æ˜“å¯¹çš„å†³ç­–è®°å½•
SELECT * FROM strategy_intent_record
WHERE strategy_id = 1 AND trading_pair_id = 101
ORDER BY created_at DESC;

-- æŸ¥çœ‹å†³ç­–åŸå› ï¼ˆJSONæ ¼å¼ï¼‰
SELECT 
    id,
    intent_action,
    JSON_EXTRACT(decision_reason, '$.trigger.type') as trigger_type,
    JSON_EXTRACT(decision_reason, '$.trigger.source') as trigger_source,
    JSON_EXTRACT(decision_reason, '$.logicStateBefore.positionSide') as position_before,
    decision_reason
FROM strategy_intent_record
WHERE strategy_id = 1
ORDER BY created_at DESC
LIMIT 10;
```

### 8.5 å¦‚ä½•ç›‘æ§å†³ç­–ç³»ç»Ÿï¼Ÿ

**å…³é”®æŒ‡æ ‡**ï¼š

1. **å†³ç­–æ€»æ•°**ï¼šæŒ‰è§¦å‘æºåˆ†ç±»
2. **å†³ç­–è€—æ—¶**ï¼šP50/P95/P99
3. **é—¨ç¦æ‹¦æˆªæ¬¡æ•°**ï¼šæŒ‰é—¨ç¦ç±»å‹åˆ†ç±»
4. **HOLDæ¬¡æ•°**ï¼šä¸è½åº“çš„å†³ç­–
5. **è½åº“æˆåŠŸ/å¤±è´¥æ¬¡æ•°**

**æŸ¥çœ‹æ–¹å¼**ï¼š

```java
// åœ¨ä»£ç ä¸­æ·»åŠ metrics
metrics.counter("strategy.decision.total", "trigger", "SIGNAL").increment();
metrics.timer("strategy.decision.duration").record(duration);
metrics.counter("strategy.decision.guard.rejected", "gate", "DedupGate").increment();
```

---

## ä¹ã€å®æˆ˜æ¡ˆä¾‹

### 9.1 æ¡ˆä¾‹1ï¼šä¿¡å·é©±åŠ¨ç­–ç•¥å†³ç­–

**åœºæ™¯**ï¼š
- ç­–ç•¥ç±»å‹ï¼šSIGNAL_DRIVEN
- å½“å‰çŠ¶æ€ï¼šç©ºä»“ï¼ˆFLATï¼‰
- è§¦å‘äº‹ä»¶ï¼šæ”¶åˆ°BUYä¿¡å·

**æµç¨‹**ï¼š

1. **äº‹ä»¶è§¦å‘**ï¼š
   ```java
   SignalIntentActivatedEvent event = new SignalIntentActivatedEvent(
       source, userId, strategyId, tradingPairId,
       signalIntentId, signalId, "BUY", LocalDateTime.now()
   );
   ```

2. **è·¯ç”±åˆ°å®ä¾‹**ï¼š
   ```java
   StrategyInstance instance = instanceLocator.locateByStrategyAndPair(
       strategyId, tradingPairId
   );
   ```

3. **é‡‡é›†ä¸Šä¸‹æ–‡**ï¼š
   ```java
   DecisionContext ctx = sampler.sample(instance, event);
   // ctxåŒ…å«ï¼š
   // - logicStateBefore: {phase: "IDLE", positionSide: "FLAT", ...}
   // - signalSnapshot: {intentId: 123, direction: "BUY", ...}
   // - paramSnapshot: {initialCapital: 10000, baseOrderRatio: 0.1, ...}
   ```

4. **é—¨ç¦æ ¡éªŒ**ï¼š
   ```java
   GuardResult result = guardChain.check(ctx);
   // PhaseGate: âœ… é€šè¿‡ï¼ˆç©ºä»“å…è®¸OPENï¼‰
   // StalenessGate: âœ… é€šè¿‡ï¼ˆä¿¡å·åœ¨30ç§’å†…ï¼‰
   // DedupGate: âœ… é€šè¿‡ï¼ˆé¦–æ¬¡è§¦å‘ï¼‰
   // SanityGate: âœ… é€šè¿‡ï¼ˆå‚æ•°æœ‰æ•ˆï¼‰
   ```

5. **ç­–ç•¥é€»è¾‘è®¡ç®—**ï¼š
   ```java
   StrategyLogic logic = logicRegistry.getLogic("SIGNAL_DRIVEN");
   DecisionResult result = logic.decide(ctx);
   // é€»è¾‘ï¼šç©ºä»“ + BUYä¿¡å· â†’ OPEN
   // result: {action: OPEN, calculatedQty: 1000, ...}
   ```

6. **è½åº“**ï¼š
   ```java
   recorder.record(ctx, result);
   // å†™å…¥ strategy_intent_record è¡¨
   // intent_action = "OPEN"
   // calculated_qty = 1000
   // decision_reason = {...å®Œæ•´JSON...}
   ```

### 9.2 æ¡ˆä¾‹2ï¼šæŒ‡æ ‡é©±åŠ¨ç­–ç•¥å†³ç­–

**åœºæ™¯**ï¼š
- ç­–ç•¥ç±»å‹ï¼šINDICATOR_DRIVEN
- å½“å‰çŠ¶æ€ï¼šç©ºä»“ï¼ˆFLATï¼‰
- è§¦å‘äº‹ä»¶ï¼šRSIæŒ‡æ ‡è®¡ç®—å®Œæˆï¼Œå€¼ä¸º25ï¼ˆ< 30ï¼‰
- å…¥åœºæ¡ä»¶ï¼š`{"mode": "ALL", "rules": [{"factor": "RSI_14", "operator": "LT", "value": 30}]}`

**æµç¨‹**ï¼š

1. **äº‹ä»¶è§¦å‘**ï¼š
   ```java
   IndicatorComputedEvent event = new IndicatorComputedEvent(
       source, userId, tradingPairId,
       "RSI_14", "1.0", barTime,
       Map.of("RSI", BigDecimal.valueOf(25.0)),
       LocalDateTime.now()
   );
   ```

2. **é‡‡é›†ä¸Šä¸‹æ–‡**ï¼š
   ```java
   DecisionContext ctx = sampler.sample(instance, event);
   // ctxåŒ…å«ï¼š
   // - indicatorSnapshot: {code: "RSI_14", value: 25.0, ...}
   // - paramSnapshot: {entryCondition: "{...}", ...}
   ```

3. **é—¨ç¦æ ¡éªŒ**ï¼š
   ```java
   GuardResult result = guardChain.check(ctx);
   // StalenessGate: âœ… é€šè¿‡ï¼ˆæŒ‡æ ‡å€¼å­˜åœ¨ï¼‰
   ```

4. **ç­–ç•¥é€»è¾‘è®¡ç®—**ï¼š
   ```java
   IndicatorDrivenStrategyLogic logic = ...;
   DecisionResult result = logic.decide(ctx);
   // 1. è¯„ä¼°å…¥åœºæ¡ä»¶ï¼šRSI_14 < 30 â†’ true
   // 2. ç©ºä»“ + å…¥åœºæ¡ä»¶æ»¡è¶³ â†’ OPEN
   // result: {action: OPEN, calculatedQty: 1000, ...}
   ```

5. **è½åº“**ï¼š
   ```java
   recorder.record(ctx, result);
   // decision_reasonåŒ…å«ï¼š
   // - indicatorCode: "RSI_14"
   // - indicatorValue: 25.0
   // - entryConditionMet: true
   ```

### 9.3 æ¡ˆä¾‹3ï¼šä»·æ ¼è§¦å‘æ­¢æŸ

**åœºæ™¯**ï¼š
- ç­–ç•¥ç±»å‹ï¼šSIGNAL_DRIVEN
- å½“å‰çŠ¶æ€ï¼šæŒä»“LONG 0.1 BTC
- è§¦å‘äº‹ä»¶ï¼šä»·æ ¼è·Œç ´æ­¢æŸä»· 64000 USDT
- æ­¢æŸä»·ï¼š64000 USDTï¼ˆä»ç­–ç•¥å‚æ•°è®¡ç®—ï¼‰

**æµç¨‹**ï¼š

1. **äº‹ä»¶è§¦å‘**ï¼š
   ```java
   PriceTriggeredDecisionEvent event = new PriceTriggeredDecisionEvent(
       source, strategyId, tradingPairId,
       "STOP_LOSS", BigDecimal.valueOf(64000),
       BigDecimal.valueOf(63900), LocalDateTime.now()
   );
   ```

2. **é‡‡é›†ä¸Šä¸‹æ–‡**ï¼š
   ```java
   DecisionContext ctx = sampler.sample(instance, event);
   // ctxåŒ…å«ï¼š
   // - logicStateBefore: {positionSide: "LONG", positionQty: 0.1, ...}
   // - priceSnapshot: {currentPrice: 63900, ...}
   ```

3. **é—¨ç¦æ ¡éªŒ**ï¼š
   ```java
   GuardResult result = guardChain.check(ctx);
   // DedupGate: âœ… é€šè¿‡ï¼ˆcooldownçª—å£å†…åªè§¦å‘ä¸€æ¬¡ï¼‰
   ```

4. **ç­–ç•¥é€»è¾‘è®¡ç®—**ï¼š
   ```java
   // ä»·æ ¼è§¦å‘é€šå¸¸ç”±PriceTriggerServiceå¤„ç†
   // ç›´æ¥è¿”å›CLOSEå†³ç­–
   DecisionResult result = DecisionResult.action(
       CLOSE, currentQty, reason
   );
   ```

5. **è½åº“**ï¼š
   ```java
   recorder.record(ctx, result);
   // decision_reasonåŒ…å«ï¼š
   // - triggerType: "PRICE"
   // - triggerType: "STOP_LOSS"
   // - currentPrice: 63900
   // - triggerPrice: 64000
   ```

---

## åã€ä»£ç é˜…è¯»å»ºè®®

### 10.1 ä»å“ªé‡Œå¼€å§‹ï¼Ÿ

**æ¨èé˜…è¯»é¡ºåº**ï¼š

1. **å…¥å£**ï¼š`DecisionEventRouter` - äº†è§£äº‹ä»¶å¦‚ä½•è·¯ç”±
2. **æ ¸å¿ƒ**ï¼š`DecisionEngineImpl` - äº†è§£å®Œæ•´å†³ç­–æµç¨‹
3. **æ•°æ®**ï¼š`AtomicSampler` - äº†è§£å¦‚ä½•é‡‡é›†æ•°æ®
4. **æ ¡éªŒ**ï¼š`GuardChain` - äº†è§£é—¨ç¦æ ¡éªŒé€»è¾‘
5. **é€»è¾‘**ï¼š`SignalDrivenStrategyLogic` - äº†è§£ç­–ç•¥é€»è¾‘è®¡ç®—
6. **è½åº“**ï¼š`IntentRecorder` - äº†è§£å¦‚ä½•è½åº“

### 10.2 å…³é”®ä»£ç ä½ç½®

| åŠŸèƒ½ | ä»£ç ä½ç½® | å…³é”®æ–¹æ³• |
|------|----------|----------|
| äº‹ä»¶è·¯ç”± | `DecisionEventRouter` | `handleSignalIntentActivated()` |
| ä¸²è¡Œæ‰§è¡Œ | `StripedExecutor` | `submit(instanceKey, task)` |
| æ•°æ®é‡‡é›† | `AtomicSampler` | `sample(instance, event)` |
| é—¨ç¦æ ¡éªŒ | `GuardChain` | `check(ctx)` |
| ç­–ç•¥é€»è¾‘ | `SignalDrivenStrategyLogic` | `decide(ctx)` |
| è½åº“ | `IntentRecorder` | `record(ctx, result)` |

### 10.3 è°ƒè¯•æŠ€å·§

**1. æ·»åŠ æ—¥å¿—**ï¼š

```java
// åœ¨å…³é”®ä½ç½®æ·»åŠ æ—¥å¿—
log.debug("å†³ç­–ä¸Šä¸‹æ–‡: {}", ctx);
log.debug("é—¨ç¦ç»“æœ: {}", guardResult);
log.debug("å†³ç­–ç»“æœ: {}", result);
```

**2. æ–­ç‚¹è°ƒè¯•**ï¼š

- åœ¨ `DecisionEngineImpl.executeDecision()` æ‰“æ–­ç‚¹
- æŸ¥çœ‹ `ctx` çš„å†…å®¹
- æŸ¥çœ‹ `result` çš„å†…å®¹

**3. æŸ¥çœ‹æ•°æ®åº“**ï¼š

```sql
-- æŸ¥çœ‹æœ€è¿‘çš„å†³ç­–è®°å½•
SELECT * FROM strategy_intent_record 
ORDER BY created_at DESC LIMIT 10;

-- æŸ¥çœ‹é€»è¾‘çŠ¶æ€
SELECT * FROM strategy_logic_state 
WHERE strategy_id = 1 AND trading_pair_id = 101;
```

---

## åä¸€ã€å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

### 11.1 å†³ç­–è®°å½•æ²¡æœ‰å†™å…¥

**å¯èƒ½åŸå› **ï¼š
1. å†³ç­–ç»“æœä¸ºHOLDï¼ˆä¸è½åº“ï¼‰
2. é—¨ç¦æ‹¦æˆª
3. æ•°æ®åº“å†™å…¥å¤±è´¥

**æ’æŸ¥æ­¥éª¤**ï¼š

```java
// 1. æ£€æŸ¥å†³ç­–ç»“æœ
if (!result.isActionIntent()) {
    log.debug("å†³ç­–ç»“æœä¸ºHOLDï¼Œä¸è½åº“");
    return;
}

// 2. æ£€æŸ¥é—¨ç¦ç»“æœ
GuardResult guardResult = guardChain.check(ctx);
if (!guardResult.isAllowed()) {
    log.warn("é—¨ç¦æ‹¦æˆª: {}", guardResult.getReason());
    return;
}

// 3. æ£€æŸ¥æ•°æ®åº“è¿æ¥
try {
    intentRecordMapper.insert(record);
} catch (Exception e) {
    log.error("æ•°æ®åº“å†™å…¥å¤±è´¥", e);
}
```

### 11.2 å»é‡å¤±æ•ˆ

**å¯èƒ½åŸå› **ï¼š
1. Redisä¸å¯ç”¨ï¼Œé™çº§åˆ°å†…å­˜ç¼“å­˜
2. å»é‡é”®æ„å»ºé”™è¯¯
3. TTLè®¾ç½®è¿‡çŸ­

**æ’æŸ¥æ­¥éª¤**ï¼š

```java
// 1. æ£€æŸ¥Redisè¿æ¥
try {
    redisTemplate.opsForValue().get(key);
} catch (Exception e) {
    log.warn("Redisä¸å¯ç”¨ï¼Œé™çº§åˆ°å†…å­˜ç¼“å­˜", e);
}

// 2. æ£€æŸ¥å»é‡é”®
String dedupKey = buildDedupKey(ctx);
log.debug("å»é‡é”®: {}", dedupKey);

// 3. æ£€æŸ¥TTL
long ttl = getTtl(triggerType);
log.debug("TTL: {}ç§’", ttl);
```

### 11.3 ç­–ç•¥é€»è¾‘æ‰¾ä¸åˆ°

**å¯èƒ½åŸå› **ï¼š
1. ç­–ç•¥ç±»å‹ä¸åŒ¹é…
2. ç­–ç•¥é€»è¾‘æœªæ³¨å†Œ

**æ’æŸ¥æ­¥éª¤**ï¼š

```java
// 1. æ£€æŸ¥ç­–ç•¥ç±»å‹
String strategyType = ctx.getStrategyType();
log.debug("ç­–ç•¥ç±»å‹: {}", strategyType);

// 2. æ£€æŸ¥æ³¨å†Œè¡¨
StrategyLogic logic = logicRegistry.getLogic(strategyType);
if (logic == null) {
    log.warn("æœªæ‰¾åˆ°ç­–ç•¥é€»è¾‘å®ç°: {}", strategyType);
    // è¿”å›é»˜è®¤å®ç°ï¼ˆHOLDï¼‰
}
```

---

## åäºŒã€æ‰©å±•é˜…è¯»

### 12.1 ç›¸å…³æ–‡æ¡£

- `ç­–ç•¥é˜¶æ®µ2ï¼ˆDecision Engineï¼‰è§„åˆ’ v3.1.md` - ä¸šåŠ¡è§„åˆ’æ–‡æ¡£
- `ç­–ç•¥é˜¶æ®µ2ç ”å‘ä»»åŠ¡åˆ†è§£ä¸éªŒæ”¶.md` - è¯¦ç»†ä»»åŠ¡åˆ†è§£
- `ç­–ç•¥é˜¶æ®µ2å¼€å‘è§„èŒƒä¸ä»»åŠ¡.md` - å¼€å‘è§„èŒƒ

### 12.2 ç›¸å…³ä»£ç 

- **é˜¶æ®µ1**ï¼š`src/main/java/com/qyl/v2trade/business/strategy/bootstrap/` - ç­–ç•¥å¯åŠ¨
- **é˜¶æ®µ3**ï¼šå¾…å®ç° - æ‰§è¡Œå’Œé£æ§
- **ä¿¡å·æ¨¡å—**ï¼š`src/main/java/com/qyl/v2trade/business/signal/` - ä¿¡å·å¤„ç†
- **æŒ‡æ ‡æ¨¡å—**ï¼š`src/main/java/com/qyl/v2trade/indicator/` - æŒ‡æ ‡è®¡ç®—

### 12.3 æ•°æ®åº“è¡¨

- `strategy_definition` - ç­–ç•¥å®šä¹‰
- `strategy_param` - ç­–ç•¥å‚æ•°
- `strategy_logic_state` - é€»è¾‘çŠ¶æ€
- `strategy_intent_record` - å†³ç­–è®°å½•
- `signal_intent` - ä¿¡å·æ„å›¾
- `indicator_value` - æŒ‡æ ‡å€¼

---

## åä¸‰ã€æ€»ç»“

### 13.1 æ ¸å¿ƒè¦ç‚¹

1. **é˜¶æ®µ2åªåšå†³ç­–ï¼Œä¸æ‰§è¡Œäº¤æ˜“**
2. **äº‹ä»¶é©±åŠ¨ï¼Œä¸è½®è¯¢**
3. **ä¸²è¡Œæ‰§è¡Œï¼Œä¿è¯ä¸€è‡´æ€§**
4. **å¹‚ç­‰å»é‡ï¼Œé˜²æ­¢é‡å¤**
5. **ç»“æ„åŒ–JSONï¼Œä¾¿äºå›æ”¾**

### 13.2 å…³é”®çº¦æŸ

- âœ… åªå†™ `strategy_intent_record`ï¼ˆINSERT onlyï¼‰
- âœ… åªè½åº“åŠ¨ä½œæ„å›¾ï¼ˆHOLDä¸è½åº“ï¼‰
- âœ… ä¸ä¿®æ”¹ `strategy_logic_state`
- âœ… äº‹ä»¶é©±åŠ¨ï¼ˆç¦æ­¢å®šæ—¶æ‰«æï¼‰
- âœ… ä»·æ ¼ç¨€ç–åŒ–ï¼ˆcooldownæœºåˆ¶ï¼‰
- âœ… ä¸²è¡Œæ‰§è¡Œï¼ˆStripedExecutorï¼‰
- âœ… å¹‚ç­‰å»é‡ï¼ˆdedupKey + ç¼“å­˜TTLï¼‰

### 13.3 ä¸‹ä¸€æ­¥

å®Œæˆé˜¶æ®µ2åï¼Œç³»ç»Ÿå·²å…·å¤‡ï¼š
- âœ… äº‹ä»¶é©±åŠ¨çš„å†³ç­–è§¦å‘
- âœ… å®Œæ•´çš„å†³ç­–æµç¨‹
- âœ… ç­–ç•¥é€»è¾‘è®¡ç®—
- âœ… å†³ç­–è®°å½•è½åº“

**ä¸‹ä¸€æ­¥**ï¼šé˜¶æ®µ3ï¼ˆæ‰§è¡Œå’Œé£æ§ï¼‰å°†æ¶ˆè´¹ `strategy_intent_record`ï¼Œæ‰§è¡Œå®é™…äº¤æ˜“ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2024  
**ç»´æŠ¤è€…**ï¼šV2-Trade æ¶æ„å›¢é˜Ÿ

---

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·å…ˆæŸ¥çœ‹æ—¥å¿—å’Œæ•°æ®åº“ï¼Œå¤§éƒ¨åˆ†é—®é¢˜éƒ½èƒ½é€šè¿‡æ—¥å¿—å®šä½ã€‚  
> ğŸ’¡ **å»ºè®®**ï¼šæ–°æ‰‹å¯ä»¥å…ˆè¿è¡Œä¸€ä¸ªç®€å•çš„ä¿¡å·é©±åŠ¨ç­–ç•¥ï¼Œè§‚å¯Ÿæ•´ä¸ªå†³ç­–æµç¨‹ã€‚