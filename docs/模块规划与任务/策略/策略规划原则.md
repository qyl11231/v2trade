🧠 策略模块最终规划文档

Strategy Module Final Specification (Frozen)
版本：v1.0 – FINAL
状态：冻结（Frozen Baseline）

0. 设计立场声明（必须先读）

本策略模块是一个纯“策略决策引擎”

❌ 不关心账户是否有钱
❌ 不感知交易所规则
❌ 不直接下单

✅ 只负责：
基于信号与行情，生成“策略意图（Strategy Intent）”

1. 模块定位（系统架构中的角色）
[ 信号源 / 行情 ]
        ↓
    策略模块  ←—— 本文档定义
        ↓
[ Capital Controller ]
        ↓
[ Execution / Exchange ]

策略模块的唯一产出

Strategy Intent（策略决策意图）

2. 核心设计原则（冻结）

策略 ≠ 账户

策略 ≠ 真实仓位

策略拥有独立“逻辑世界”

状态必须可恢复

LATEST_ONLY 信号消费

防御性优先于聪明

3. 策略能力边界（What / What NOT）
✅ 策略模块负责

计算下单数量（基于策略初始资金）

管理逻辑仓位（Logic Position）

判断入场 / 退出 / 加仓 / 减仓 / 反手

维护收益曲线（策略视角）

只消费最新有效信号

❌ 策略模块不负责

校验账户余额

校验最小下单量

处理撮合 / 成交

风控熔断

资金分配

4. 策略运行模型（核心）
4.1 多维度拆分模型
Strategy
 └── Symbol (1..N)
      └── 独立逻辑状态


一个策略可绑定 多个交易品种

每个品种都是一个独立的逻辑执行单元

任一品种异常 不影响其他品种

5. 策略生命周期（状态机）
5.1 策略逻辑状态（Strategy Logic State）
INIT
 ↓
WAIT_ENTRY
 ↓
POSITION_OPEN
 ↓
POSITION_MANAGING
 ↓
EXITING
 ↓
WAIT_ENTRY


📌 状态必须持久化

6. 信号处理模型（冻结）
6.1 信号消费规则

每个信号源 只保留最新一条有效信号

新信号到达 → 覆盖旧信号

策略只读取 LATEST_ONLY

6.2 信号的作用方式

信号 ≠ 必然下单
信号 = 策略判断因子之一

7. 策略参数体系（最终版）
7.1 参数分层设计
策略参数
 ├── 入场条件参数（Entry）
 ├── 仓位 / 下单参数（Position）
 └── 退出条件参数（Exit）

7.2 入场条件参数（Entry Conditions）

支持多条件组合

支持 ALL / ANY 模式

条件类型：

价格

技术指标

信号方向

自定义扩展

📌 无入场条件 ≠ 合法策略

7.3 仓位与下单参数（Position Params）

策略初始资金（虚拟）

单次下单比例 / 固定数量

加仓 / 减仓阶梯规则（可选）

📌 不校验账户，不校验交易所

7.4 退出条件参数（Exit Conditions）

止盈（比例）

止损（比例）

指标反转

信号反转

支持：

多条件

ANY / ALL

8. 策略行为决策模型（复杂性来源）

策略在任意信号 / 行情触发时，可能产生：

开仓

平仓

加仓

减仓

反手开仓

不动作

📌 这是策略模块复杂性的根源，但不削减

9. 状态与流水设计（关键冻结点）
9.1 状态快照表（必须存在）

strategy_logic_state

用途：

O(1) 获取当前逻辑状态

系统重启可恢复

防止扫描流水

9.2 决策流水表（语义修正）

strategy_decision_record

语义：

“策略在某一时刻，基于已知信息，产生了什么意图”

10. 防御编程原则（已内建）
10.1 典型防御点

状态缺失 → 拒绝执行

信号为空 → 不决策

参数非法 → 策略不可启用

状态漂移 → 强制回滚

11. 数据流转总览（最终）
信号 / 行情
   ↓
策略实例（Symbol级）
   ↓
读取 logic_state
   ↓
计算 Entry / Exit / Adjust
   ↓
写 decision_record
   ↓
更新 logic_state
   ↓
输出 Strategy Intent

12. 与 Capital Controller 的契约（边界清晰）

策略模块只输出：

{
  "strategy_id": 1,
  "symbol": "BTC-USDT",
  "intent": "OPEN_LONG",
  "qty": 0.1,
  "reason": "ENTRY_CONDITION_MET"
}


📌 是否执行，由 Capital Controller 裁决

13. 冻结裁决（Final Verdict）
本模块：

✅ 可开发
✅ 可维护
✅ 可扩展
✅ 可回测
✅ 可实盘

且明确：

这是“策略引擎”，不是“交易系统”