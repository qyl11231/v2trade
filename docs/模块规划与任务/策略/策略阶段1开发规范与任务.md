# ç­–ç•¥é˜¶æ®µ1ï¼šå¼€å‘è§„èŒƒä¸ä»»åŠ¡æ¸…å•

> **åŸºäºæ–‡æ¡£**ï¼š
> - `ç­–ç•¥ä»»åŠ¡é¡¹é˜¶æ®µ1.md` - é˜¶æ®µ1ç›®æ ‡ä¸æµç¨‹
> - `ç­–ç•¥é˜¶æ®µ1å‰æ.md` - å¿…è¦æ¡ä»¶
> - `chatgptç­–ç•¥é˜¶æ®µ1è®¡åˆ’.md` - æ¨¡å—æ‹†åˆ†å»ºè®®
>
> **ç‰ˆæœ¬**ï¼šv1.0  
> **åˆ›å»ºæ—¶é—´**ï¼š2024

---

## ğŸ“‹ ç›®å½•

1. [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)
2. [å¼€å‘ä»»åŠ¡æ¸…å•](#å¼€å‘ä»»åŠ¡æ¸…å•)
3. [éªŒæ”¶æ ‡å‡†](#éªŒæ”¶æ ‡å‡†)
4. [é£é™©ä¸æ³¨æ„äº‹é¡¹](#é£é™©ä¸æ³¨æ„äº‹é¡¹)

---

## ä¸€ã€å¼€å‘è§„èŒƒ

### 1.1 æ¶æ„è§„èŒƒ

#### 1.1.1 æ¨¡å—åˆ’åˆ†ï¼ˆå¿…é¡»éµå¾ªï¼‰

é˜¶æ®µ1å¿…é¡»å®ç°ä»¥ä¸‹5ä¸ªæ ¸å¿ƒæ¨¡å—ï¼ŒèŒè´£è¾¹ç•Œæ¸…æ™°ï¼š

| æ¨¡å— | èŒè´£ | ç¦æ­¢è¡Œä¸º |
|------|------|---------|
| **StrategyBootstrapper** | å¯åŠ¨åè°ƒå™¨ï¼Œåè°ƒæ•´ä¸ªå®ä¾‹åŒ–è¿‡ç¨‹ | ä¸ç›´æ¥æ“ä½œæ•°æ®åº“ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘ |
| **StrategyConfigLoader** | é…ç½®åŠ è½½å™¨ï¼Œä»DBè¯»å–é…ç½®è½¬æˆå†…å­˜å¿«ç…§ | ä¸ä¿®æ”¹æ•°æ®ï¼Œä¸åˆ›å»ºå®ä¾‹ï¼Œåªè¯»æ“ä½œ |
| **StrategyRuntimeFactory** | è¿è¡Œä½“å·¥å‚ï¼Œå°†é…ç½®æ‹†æˆå®ä¾‹ | ä¸è®¿é—®æ•°æ®åº“ï¼Œä¸æ¢å¤çŠ¶æ€ï¼Œçº¯å†…å­˜æ“ä½œ |
| **LogicStateRestorer** | çŠ¶æ€æ¢å¤å™¨ï¼Œæ¢å¤æˆ–åˆå§‹åŒ–logic_state | ä¸ä¿®æ”¹é…ç½®ï¼Œä¸ç”Ÿæˆå†³ç­–ï¼Œåªç®¡ç†çŠ¶æ€ |
| **SignalViewBinder** | ä¿¡å·è§‚å¯Ÿç»‘å®šï¼Œå»ºç«‹ä¿¡å·è§‚å¯Ÿå…³ç³» | ä¸æ¶ˆè´¹ä¿¡å·ï¼Œä¸ä¿®æ”¹ä¿¡å·çŠ¶æ€ï¼Œåªå»ºç«‹è§†å›¾ |

#### 1.1.2 æ¨¡å—ä¾èµ–å…³ç³»

```
StrategyBootstrapper
    â†“
StrategyConfigLoader â†’ StrategyRuntimeFactory
    â†“                      â†“
LogicStateRestorer    SignalViewBinder
```

**ä¾èµ–è§„åˆ™**ï¼š
- ä¸Šå±‚æ¨¡å—å¯ä»¥è°ƒç”¨ä¸‹å±‚æ¨¡å—
- åŒå±‚æ¨¡å—ç¦æ­¢ç›¸äº’è°ƒç”¨
- ç¦æ­¢å¾ªç¯ä¾èµ–

#### 1.1.3 åŒ…ç»“æ„è§„èŒƒ

```
com.qyl.v2trade.strategy
â”œâ”€â”€ bootstrap          # å¯åŠ¨åè°ƒå™¨
â”‚   â”œâ”€â”€ StrategyBootstrapper
â”‚   â””â”€â”€ StrategyRuntimeRegistry
â”œâ”€â”€ loader             # é…ç½®åŠ è½½å™¨
â”‚   â”œâ”€â”€ StrategyConfigLoader
â”‚   â””â”€â”€ model
â”‚       â””â”€â”€ StrategyConfigSnapshot
â”œâ”€â”€ factory            # è¿è¡Œä½“å·¥å‚
â”‚   â”œâ”€â”€ StrategyRuntimeFactory
â”‚   â””â”€â”€ model
â”‚       â”œâ”€â”€ StrategyRuntime
â”‚       â””â”€â”€ StrategyInstance
â”œâ”€â”€ restorer           # çŠ¶æ€æ¢å¤å™¨
â”‚   â”œâ”€â”€ LogicStateRestorer
â”‚   â””â”€â”€ model
â”‚       â””â”€â”€ LogicStateSnapshot
â””â”€â”€ binder             # ä¿¡å·è§‚å¯Ÿç»‘å®š
    â”œâ”€â”€ SignalViewBinder
    â””â”€â”€ model
        â””â”€â”€ SignalView
```

---

### 1.2 ç¼–ç è§„èŒƒ

#### 1.2.1 å‘½åè§„èŒƒ

**ç±»å‘½å**ï¼š
- æ¥å£ï¼š`I` å‰ç¼€ï¼ˆå¯é€‰ï¼‰æˆ–ç›´æ¥ä½¿ç”¨æè¿°æ€§åç§°
- å®ç°ç±»ï¼š`Impl` åç¼€
- æ¨¡å‹ç±»ï¼š`Snapshot`ã€`Runtime`ã€`Instance` ç­‰åç¼€æ˜ç¡®è¯­ä¹‰
- æšä¸¾ï¼šä½¿ç”¨ `Enum` åç¼€

**æ–¹æ³•å‘½å**ï¼š
- åŠ è½½æ–¹æ³•ï¼š`load`ã€`loadAll`ã€`loadByStrategyId`
- åˆ›å»ºæ–¹æ³•ï¼š`create`ã€`createInstance`ã€`createSnapshot`
- æ¢å¤æ–¹æ³•ï¼š`restore`ã€`restoreOrInit`
- ç»‘å®šæ–¹æ³•ï¼š`bind`ã€`bindSignalView`
- æ³¨å†Œæ–¹æ³•ï¼š`register`ã€`unregister`

**å˜é‡å‘½å**ï¼š
- ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°ï¼Œé¿å…ç¼©å†™
- é›†åˆç±»å‹ä½¿ç”¨å¤æ•°ï¼š`strategies`ã€`instances`
- å¸ƒå°”å€¼ä½¿ç”¨ `is`ã€`has`ã€`should` å‰ç¼€

#### 1.2.2 æ³¨é‡Šè§„èŒƒ

**ç±»æ³¨é‡Š**ï¼ˆå¿…é¡»ï¼‰ï¼š
```java
/**
 * ç­–ç•¥é…ç½®åŠ è½½å™¨
 * 
 * <p>èŒè´£ï¼š
 * <ul>
 *   <li>ä»æ•°æ®åº“åŠ è½½ç­–ç•¥é…ç½®ï¼ˆdefinitionã€paramã€symbolã€subscriptionï¼‰</li>
 *   <li>è½¬æ¢ä¸ºä¸å¯å˜çš„å†…å­˜å¿«ç…§å¯¹è±¡</li>
 *   <li>ä¸ä¿®æ”¹æ•°æ®ï¼Œä¸åˆ›å»ºå®ä¾‹</li>
 * </ul>
 * 
 * <p>é˜¶æ®µ1çº¦æŸï¼š
 * <ul>
 *   <li>åªè¯»æ“ä½œï¼Œä¸ä¿®æ”¹æ•°æ®åº“</li>
 *   <li>ä¸æ¶ˆè´¹ä¿¡å·ï¼Œä¸ç”Ÿæˆå†³ç­–</li>
 * </ul>
 * 
 * @author å¼€å‘è€…åç§°
 * @since 1.0
 */
public class StrategyConfigLoader {
    // ...
}
```

**æ–¹æ³•æ³¨é‡Š**ï¼ˆå¿…é¡»ï¼‰ï¼š
```java
/**
 * åŠ è½½ç­–ç•¥é…ç½®å¿«ç…§
 * 
 * @param strategyId ç­–ç•¥ID
 * @return ç­–ç•¥é…ç½®å¿«ç…§ï¼Œå¦‚æœç­–ç•¥ä¸å­˜åœ¨æˆ–æœªå¯ç”¨è¿”å›null
 * @throws IllegalArgumentException å¦‚æœstrategyIdä¸ºnullæˆ–<=0
 */
public StrategyConfigSnapshot loadConfig(Long strategyId) {
    // ...
}
```

**å…³é”®é€»è¾‘æ³¨é‡Š**ï¼ˆå¿…é¡»ï¼‰ï¼š
```java
// é˜¶æ®µ1æ ¸å¿ƒçº¦æŸï¼šåªå»ºç«‹è§‚å¯Ÿå…³ç³»ï¼Œä¸æ¶ˆè´¹ä¿¡å·
// ä¸è°ƒç”¨ SignalService.consume() æˆ–ä¿®æ”¹ signal_intent çŠ¶æ€
signalView.setReadOnly(true);
```

#### 1.2.3 å¼‚å¸¸å¤„ç†è§„èŒƒ

**å¼‚å¸¸ç±»å‹é€‰æ‹©**ï¼š
- `IllegalArgumentException`ï¼šå‚æ•°æ ¡éªŒå¤±è´¥
- `IllegalStateException`ï¼šçŠ¶æ€ä¸åˆæ³•ï¼ˆå¦‚é‡å¤åˆå§‹åŒ–ï¼‰
- `BusinessException`ï¼šä¸šåŠ¡é€»è¾‘å¼‚å¸¸ï¼ˆè‡ªå®šä¹‰ï¼‰
- `DataAccessException`ï¼šæ•°æ®åº“è®¿é—®å¼‚å¸¸ï¼ˆSpringæ¡†æ¶ï¼‰

**å¼‚å¸¸å¤„ç†åŸåˆ™**ï¼š
```java
// âœ… æ­£ç¡®ï¼šæ˜ç¡®çš„å¼‚å¸¸ä¿¡æ¯å’Œæ¢å¤å»ºè®®
if (strategyId == null || strategyId <= 0) {
    throw new IllegalArgumentException(
        String.format("ç­–ç•¥IDæ— æ•ˆ: %sï¼Œå¿…é¡»å¤§äº0", strategyId)
    );
}

// âœ… æ­£ç¡®ï¼šéƒ¨åˆ†å¤±è´¥éš”ç¦»ï¼Œè®°å½•æ—¥å¿—ä½†ä¸ä¸­æ–­å…¶ä»–ç­–ç•¥
try {
    bootstrapStrategy(strategyId);
} catch (Exception e) {
    log.error("ç­–ç•¥å¯åŠ¨å¤±è´¥: strategyId={}", strategyId, e);
    // ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œç»§ç»­å¤„ç†å…¶ä»–ç­–ç•¥
}

// âŒ é”™è¯¯ï¼šåæ‰å¼‚å¸¸
try {
    bootstrapStrategy(strategyId);
} catch (Exception e) {
    // ä»€ä¹ˆéƒ½ä¸åš
}
```

#### 1.2.4 æ—¥å¿—è§„èŒƒ

**æ—¥å¿—çº§åˆ«**ï¼š
- `ERROR`ï¼šç³»ç»Ÿé”™è¯¯ï¼Œéœ€è¦ç«‹å³å¤„ç†
- `WARN`ï¼šè­¦å‘Šï¼Œå¯èƒ½çš„é—®é¢˜ä½†ä¸å½±å“åŠŸèƒ½
- `INFO`ï¼šå…³é”®ä¸šåŠ¡æµç¨‹èŠ‚ç‚¹
- `DEBUG`ï¼šè¯¦ç»†è°ƒè¯•ä¿¡æ¯

**æ—¥å¿—æ ¼å¼**ï¼š
```java
// âœ… æ­£ç¡®ï¼šåŒ…å«å…³é”®ä¸Šä¸‹æ–‡ä¿¡æ¯
log.info("ç­–ç•¥å®ä¾‹åŒ–å®Œæˆ: strategyId={}, instanceCount={}, duration={}ms", 
    strategyId, instanceCount, duration);

// âœ… æ­£ç¡®ï¼šå¼‚å¸¸æ—¥å¿—åŒ…å«å®Œæ•´å †æ ˆ
log.error("çŠ¶æ€æ¢å¤å¤±è´¥: strategyId={}, tradingPairId={}", 
    strategyId, tradingPairId, e);

// âŒ é”™è¯¯ï¼šç¼ºå°‘ä¸Šä¸‹æ–‡
log.info("ç­–ç•¥å¯åŠ¨");
```

---

### 1.3 æ•°æ®è®¿é—®è§„èŒƒ

#### 1.3.1 çŠ¶æ€ç®¡ç†é“å¾‹

**é“å¾‹1ï¼šlogic_state æ˜¯å”¯ä¸€äº‹å®æº**

```java
// âœ… æ­£ç¡®ï¼šå†³ç­–å‰åªè¯»logic_state
LogicState state = logicStateRestorer.restore(strategyId, tradingPairId);
if (state.getPhase() == Phase.IDLE) {
    // åŸºäºçŠ¶æ€åšå†³ç­–
}

// âŒ é”™è¯¯ï¼šåœ¨å†…å­˜ä¸­ç»´æŠ¤çŠ¶æ€ï¼Œä¸æŒä¹…åŒ–
private Map<String, LogicState> memoryState; // ç¦æ­¢ï¼

// âœ… æ­£ç¡®ï¼šçŠ¶æ€å˜æ›´ç«‹å³æŒä¹…åŒ–
logicState.setPhase(Phase.WAIT_SIGNAL);
logicStateMapper.updateById(logicState); // å¿…é¡»ç«‹å³å†™å›
```

**é“å¾‹2ï¼šçŠ¶æ€æ¢å¤å¿…é¡»å¹‚ç­‰**

```java
// âœ… æ­£ç¡®ï¼šå¹‚ç­‰æ¢å¤é€»è¾‘
public LogicState restoreOrInit(Long strategyId, Long tradingPairId) {
    LogicState state = logicStateMapper.selectByStrategyAndPair(
        strategyId, tradingPairId
    );
    
    if (state == null) {
        // åˆå§‹åŒ–é»˜è®¤çŠ¶æ€
        state = createDefaultState(strategyId, tradingPairId);
        // ç«‹å³å†™å›æ•°æ®åº“
        logicStateMapper.insert(state);
        log.info("åˆå§‹åŒ–ç­–ç•¥çŠ¶æ€: strategyId={}, tradingPairId={}", 
            strategyId, tradingPairId);
    }
    
    return state;
}
```

**é“å¾‹3ï¼šç¦æ­¢åœ¨é˜¶æ®µ1ä¿®æ”¹ä¿¡å·çŠ¶æ€**

```java
// âŒ é”™è¯¯ï¼šé˜¶æ®µ1ç¦æ­¢æ¶ˆè´¹ä¿¡å·
signalService.consume(signalId); // ç¦æ­¢ï¼
signalIntentService.markAsConsumed(signalId); // ç¦æ­¢ï¼

// âœ… æ­£ç¡®ï¼šåªå»ºç«‹è§‚å¯Ÿå…³ç³»
SignalView view = new SignalView();
view.setSignalConfigId(signalConfigId);
view.setConsumeMode(ConsumeMode.LATEST_ONLY);
view.setReadOnly(true); // æ ‡è®°ä¸ºåªè¯»
```

#### 1.3.2 äº‹åŠ¡ç®¡ç†è§„èŒƒ

**åŸåˆ™**ï¼šé˜¶æ®µ1æ“ä½œåº”è¯¥æ˜¯åªè¯»æˆ–å•è¡¨æ“ä½œï¼Œå°½é‡ä¸ä½¿ç”¨äº‹åŠ¡

```java
// âœ… æ­£ç¡®ï¼šåªè¯»æ“ä½œï¼Œä¸éœ€è¦äº‹åŠ¡
@Transactional(readOnly = true)
public StrategyConfigSnapshot loadConfig(Long strategyId) {
    // åªè¯»æŸ¥è¯¢
}

// âœ… æ­£ç¡®ï¼šå•è¡¨æ’å…¥ï¼Œä½¿ç”¨é»˜è®¤äº‹åŠ¡
public LogicState restoreOrInit(Long strategyId, Long tradingPairId) {
    LogicState state = logicStateMapper.selectByStrategyAndPair(...);
    if (state == null) {
        state = createDefaultState(...);
        logicStateMapper.insert(state); // å•è¡¨æ“ä½œï¼Œä½¿ç”¨é»˜è®¤äº‹åŠ¡å³å¯
    }
    return state;
}

// âŒ é”™è¯¯ï¼šè·¨è¡¨æ“ä½œä½¿ç”¨äº‹åŠ¡ï¼Œä½†é˜¶æ®µ1åº”è¯¥é¿å…
@Transactional
public void bootstrapStrategy(Long strategyId) {
    // å¤šè¡¨æ“ä½œ...
}
```

---

### 1.4 é˜¶æ®µè¾¹ç•Œè§„èŒƒï¼ˆæ ¸å¿ƒçº¦æŸï¼‰

#### 1.4.1 é˜¶æ®µ1å…è®¸çš„æ“ä½œ

| æ“ä½œç±»å‹ | å…è®¸ | è¯´æ˜ |
|---------|------|------|
| è¯»å– strategy_definition | âœ… | åŠ è½½ç­–ç•¥å®šä¹‰ |
| è¯»å– strategy_param | âœ… | åŠ è½½ç­–ç•¥å‚æ•° |
| è¯»å– strategy_symbol | âœ… | åŠ è½½äº¤æ˜“å¯¹ç»‘å®š |
| è¯»å– strategy_signal_subscription | âœ… | åŠ è½½ä¿¡å·è®¢é˜… |
| è¯»å– strategy_logic_state | âœ… | æ¢å¤çŠ¶æ€ |
| å†™å…¥ strategy_logic_state | âœ… | åˆå§‹åŒ–çŠ¶æ€ï¼ˆä»…å½“ä¸å­˜åœ¨æ—¶ï¼‰ |
| åˆ›å»ºå†…å­˜å¯¹è±¡ | âœ… | StrategyRuntimeã€Instanceç­‰ |
| å»ºç«‹ä¿¡å·è§‚å¯Ÿå…³ç³» | âœ… | SignalViewï¼ˆåªè¯»ï¼‰ |

#### 1.4.2 é˜¶æ®µ1ç¦æ­¢çš„æ“ä½œ

| æ“ä½œç±»å‹ | ç¦æ­¢ | åŸå›  |
|---------|------|------|
| è¯»å–/å†™å…¥ decision_record | âŒ | å±äºé˜¶æ®µ2 |
| è¯»å–/ä¿®æ”¹ signal_intent çŠ¶æ€ | âŒ | å±äºé˜¶æ®µ2 |
| æ¶ˆè´¹ä¿¡å· | âŒ | å±äºé˜¶æ®µ2 |
| æ‹‰å–å†å²ä¿¡å· | âŒ | é˜²æ­¢è¡¥ç®—æ±¡æŸ“ |
| ç”Ÿæˆç­–ç•¥æ„å›¾ | âŒ | å±äºé˜¶æ®µ2 |
| åˆ¤æ–­ BUY/SELL | âŒ | å±äºé˜¶æ®µ2 |
| è®¡ç®—èµ„é‡‘ | âŒ | æ›´ä¸‹æ¸¸æ¨¡å— |
| è®¢é˜…è¡Œæƒ… | âŒ | å·²ç”±è¡Œæƒ…ä¸­å¿ƒå®Œæˆ |

#### 1.4.3 ä»£ç æ£€æŸ¥æ¸…å•

åœ¨æäº¤ä»£ç å‰ï¼Œå¿…é¡»æ£€æŸ¥ï¼š

- [ ] æ²¡æœ‰è°ƒç”¨ `SignalService.consume()` æˆ–ç±»ä¼¼æ–¹æ³•
- [ ] æ²¡æœ‰å†™å…¥ `decision_record` è¡¨
- [ ] æ²¡æœ‰ä¿®æ”¹ `signal_intent` çŠ¶æ€
- [ ] æ²¡æœ‰æ‹‰å–å†å²ä¿¡å·æ•°æ®
- [ ] æ²¡æœ‰è®¡ç®—ä¸‹å•æ•°é‡æˆ–èµ„é‡‘
- [ ] æ²¡æœ‰åˆ¤æ–­äº¤æ˜“æ–¹å‘ï¼ˆBUY/SELLï¼‰
- [ ] æ‰€æœ‰çŠ¶æ€å˜æ›´éƒ½ç«‹å³æŒä¹…åŒ–åˆ° `strategy_logic_state`
- [ ] æ‰€æœ‰æ•°æ®åº“æ“ä½œéƒ½æœ‰å¼‚å¸¸å¤„ç†

---

### 1.5 æµ‹è¯•è§„èŒƒ

#### 1.5.1 å•å…ƒæµ‹è¯•è¦æ±‚

**è¦†ç›–ç‡è¦æ±‚**ï¼šæ ¸å¿ƒæ¨¡å—å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

**æµ‹è¯•ç±»å‘½å**ï¼š`{ClassName}Test`

**æµ‹è¯•æ–¹æ³•å‘½å**ï¼š`test{MethodName}_{Scenario}_{ExpectedResult}`

**ç¤ºä¾‹**ï¼š
```java
public class LogicStateRestorerTest {
    
    @Test
    public void testRestoreOrInit_StateExists_ReturnExistingState() {
        // Given: çŠ¶æ€å·²å­˜åœ¨
        Long strategyId = 1L;
        Long tradingPairId = 1L;
        LogicState existingState = createExistingState();
        when(logicStateMapper.selectByStrategyAndPair(...))
            .thenReturn(existingState);
        
        // When: æ¢å¤çŠ¶æ€
        LogicState result = restorer.restoreOrInit(strategyId, tradingPairId);
        
        // Then: è¿”å›å·²å­˜åœ¨çš„çŠ¶æ€
        assertThat(result).isEqualTo(existingState);
        verify(logicStateMapper, never()).insert(any());
    }
    
    @Test
    public void testRestoreOrInit_StateNotExists_CreateAndReturnDefaultState() {
        // Given: çŠ¶æ€ä¸å­˜åœ¨
        when(logicStateMapper.selectByStrategyAndPair(...))
            .thenReturn(null);
        
        // When: æ¢å¤çŠ¶æ€
        LogicState result = restorer.restoreOrInit(strategyId, tradingPairId);
        
        // Then: åˆ›å»ºé»˜è®¤çŠ¶æ€å¹¶å†™å›æ•°æ®åº“
        assertThat(result.getPhase()).isEqualTo(Phase.IDLE);
        assertThat(result.getLogicPositionSide()).isEqualTo(PositionSide.FLAT);
        verify(logicStateMapper).insert(any(LogicState.class));
    }
}
```

#### 1.5.2 é›†æˆæµ‹è¯•è¦æ±‚

**æµ‹è¯•åœºæ™¯**ï¼š
1. ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰å¯ç”¨ç­–ç•¥
2. ç­–ç•¥å¯ç”¨æ—¶åˆ›å»ºå®ä¾‹
3. ç­–ç•¥ç¦ç”¨æ—¶é”€æ¯å®ä¾‹
4. ç³»ç»Ÿé‡å¯åçŠ¶æ€æ¢å¤
5. å¤šäº¤æ˜“å¯¹ç­–ç•¥å®ä¾‹åŒ–

**ç¤ºä¾‹**ï¼š
```java
@SpringBootTest
public class StrategyBootstrapIntegrationTest {
    
    @Test
    public void testBootstrapAll_OnSystemStart_LoadAllEnabledStrategies() {
        // Given: æ•°æ®åº“ä¸­æœ‰2ä¸ªå¯ç”¨çš„ç­–ç•¥
        createEnabledStrategy(1L);
        createEnabledStrategy(2L);
        
        // When: ç³»ç»Ÿå¯åŠ¨
        bootstrapper.bootstrapAll();
        
        // Then: æ³¨å†Œè¡¨ä¸­åº”è¯¥æœ‰2ä¸ªStrategyRuntime
        assertThat(registry.getRuntimeCount()).isEqualTo(2);
    }
    
    @Test
    public void testBootstrapStrategy_WithMultipleSymbols_CreateMultipleInstances() {
        // Given: ç­–ç•¥ç»‘å®š3ä¸ªäº¤æ˜“å¯¹
        Long strategyId = 1L;
        bindSymbols(strategyId, 1L, 2L, 3L);
        
        // When: å¯åŠ¨ç­–ç•¥
        bootstrapper.bootstrapStrategy(strategyId);
        
        // Then: åº”è¯¥åˆ›å»º3ä¸ªå®ä¾‹
        StrategyRuntime runtime = registry.getRuntime(strategyId);
        assertThat(runtime.getInstanceCount()).isEqualTo(3);
    }
}
```

#### 1.5.3 é˜¶æ®µè¾¹ç•Œæµ‹è¯•

**å¿…é¡»æµ‹è¯•**ï¼šé˜¶æ®µ1ä¸ä¼šäº§ç”Ÿå‰¯ä½œç”¨

```java
@Test
public void testBootstrapStrategy_Phase1Boundary_NoDecisionRecordCreated() {
    // Given: ç­–ç•¥é…ç½®å®Œæ•´
    Long strategyId = createCompleteStrategy();
    
    // When: å¯åŠ¨ç­–ç•¥ï¼ˆé˜¶æ®µ1ï¼‰
    bootstrapper.bootstrapStrategy(strategyId);
    
    // Then: ä¸åº”è¯¥æœ‰å†³ç­–è®°å½•
    List<DecisionRecord> records = decisionRecordMapper.selectByStrategyId(strategyId);
    assertThat(records).isEmpty();
    
    // Then: ä¸åº”è¯¥æœ‰ä¿¡å·æ¶ˆè´¹è®°å½•
    verify(signalService, never()).consume(any());
}
```

---

## äºŒã€å¼€å‘ä»»åŠ¡æ¸…å•

### 2.1 ä»»åŠ¡åˆ†ç»„

#### ç»„1ï¼šæ•°æ®å±‚ä¸å®ä½“ç±»ï¼ˆP0 - åŸºç¡€ï¼‰

#### ç»„2ï¼šæ ¸å¿ƒæ¨¡å—å®ç°ï¼ˆP0 - æ ¸å¿ƒï¼‰

#### ç»„3ï¼šå¯åŠ¨ä¸æ³¨å†Œï¼ˆP0 - é›†æˆï¼‰

#### ç»„4ï¼šæµ‹è¯•ä¸æ–‡æ¡£ï¼ˆP1 - è´¨é‡ï¼‰

---

### 2.2 è¯¦ç»†ä»»åŠ¡æ¸…å•

#### ğŸ“¦ ç»„1ï¼šæ•°æ®å±‚ä¸å®ä½“ç±»

##### ä»»åŠ¡1.1ï¼šåˆ›å»º StrategyLogicState å®ä½“ç±»

**ä»»åŠ¡æè¿°**ï¼š
åˆ›å»º `StrategyLogicState` å®ä½“ç±»ï¼Œæ˜ å°„ `strategy_logic_state` è¡¨ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- ä½¿ç”¨ MyBatis-Plus æ³¨è§£
- å­—æ®µæ˜ å°„å®Œæ•´
- æšä¸¾ç±»å‹å®šä¹‰ï¼ˆLogicDirectionã€LogicPhaseï¼‰
- è‡ªåŠ¨å¡«å……å­—æ®µï¼ˆupdated_atï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] å®ä½“ç±»å­—æ®µä¸è¡¨ç»“æ„ä¸€è‡´
- [ ] æšä¸¾ç±»å‹æ­£ç¡®å®šä¹‰
- [ ] è‡ªåŠ¨å¡«å……é…ç½®æ­£ç¡®
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š0.5å¤©

**ä¾èµ–**ï¼šæ— 

---

##### ä»»åŠ¡1.2ï¼šåˆ›å»º StrategyLogicStateMapper

**ä»»åŠ¡æè¿°**ï¼š
åˆ›å»º `StrategyLogicStateMapper`ï¼Œæä¾›çŠ¶æ€æŸ¥è¯¢å’Œæ›´æ–°æ–¹æ³•ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- ç»§æ‰¿ `BaseMapper<StrategyLogicState>`
- å®ç°æŒ‰ç­–ç•¥ID+äº¤æ˜“å¯¹IDæŸ¥è¯¢ï¼ˆæ ¸å¿ƒæŸ¥è¯¢ï¼‰
- å®ç°æ‰¹é‡æŸ¥è¯¢æ–¹æ³•

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] Mapperæ¥å£å®šä¹‰å®Œæ•´
- [ ] æ ¸å¿ƒæŸ¥è¯¢æ–¹æ³•æ­£ç¡®
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š0.5å¤©

**ä¾èµ–**ï¼šä»»åŠ¡1.1

---

##### ä»»åŠ¡1.3ï¼šåˆ›å»ºæšä¸¾ç±»å‹

**ä»»åŠ¡æè¿°**ï¼š
åˆ›å»ºç­–ç•¥ç›¸å…³çš„æšä¸¾ç±»å‹ã€‚

**æšä¸¾åˆ—è¡¨**ï¼š
- `LogicDirection`ï¼šLONG, SHORT, FLAT
- `LogicPhase`ï¼šIDLE, WAIT_SIGNAL, WAIT_CONDITION, POSITION_OPEN, EXIT_PENDING
- `ConsumeMode`ï¼šLATEST_ONLYï¼ˆé¢„ç•™å…¶ä»–æ¨¡å¼ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ‰€æœ‰æšä¸¾ç±»å‹å®šä¹‰å®Œæ•´
- [ ] æšä¸¾å€¼ä¸æ•°æ®åº“ä¸€è‡´
- [ ] æœ‰æ¸…æ™°çš„æ³¨é‡Šè¯´æ˜

**å·¥ä½œé‡**ï¼š0.5å¤©

**ä¾èµ–**ï¼šæ— 

---

#### ğŸ“¦ ç»„2ï¼šæ ¸å¿ƒæ¨¡å—å®ç°

##### ä»»åŠ¡2.1ï¼šå®ç° StrategyConfigSnapshot æ¨¡å‹ç±»

**ä»»åŠ¡æè¿°**ï¼š
åˆ›å»ºä¸å¯å˜çš„é…ç½®å¿«ç…§ç±»ï¼Œç”¨äºåœ¨å†…å­˜ä¸­ä¿å­˜ç­–ç•¥é…ç½®ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- ä½¿ç”¨ä¸å¯å˜å¯¹è±¡ï¼ˆimmutableï¼‰
- åŒ…å«ï¼šStrategyDefinitionã€StrategyParamã€List<StrategySymbol>ã€List<StrategySignalSubscription>
- æä¾›ä¾¿æ·çš„æŸ¥è¯¢æ–¹æ³•

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] ç±»è®¾è®¡ä¸ºä¸å¯å˜
- [ ] å­—æ®µå®Œæ•´
- [ ] æœ‰ä¾¿æ·æŸ¥è¯¢æ–¹æ³•
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š0.5å¤©

**ä¾èµ–**ï¼šä»»åŠ¡1.3

---

##### ä»»åŠ¡2.2ï¼šå®ç° StrategyConfigLoader

**ä»»åŠ¡æè¿°**ï¼š
å®ç°é…ç½®åŠ è½½å™¨ï¼Œä»æ•°æ®åº“åŠ è½½ç­–ç•¥é…ç½®å¹¶è½¬æ¢ä¸ºå¿«ç…§ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- å®ç° `loadConfig(Long strategyId)` æ–¹æ³•
- åªè¯»æ“ä½œï¼Œä¸ä¿®æ”¹æ•°æ®
- å¼‚å¸¸å¤„ç†å®Œå–„
- æ—¥å¿—è®°å½•å®Œæ•´

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```java
public StrategyConfigSnapshot loadConfig(Long strategyId) {
    // 1. åŠ è½½ strategy_definition
    // 2. åŠ è½½ strategy_param
    // 3. åŠ è½½ strategy_symbolï¼ˆåªåŠ è½½enabled=1çš„ï¼‰
    // 4. åŠ è½½ strategy_signal_subscriptionï¼ˆåªåŠ è½½enabled=1çš„ï¼‰
    // 5. ç»„è£…æˆ StrategyConfigSnapshot
    // 6. è¿”å›
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] èƒ½æ­£ç¡®åŠ è½½å®Œæ•´é…ç½®
- [ ] åªåŠ è½½å¯ç”¨çš„symbolå’Œsubscription
- [ ] é…ç½®ä¸å­˜åœ¨æ—¶è¿”å›null
- [ ] å¼‚å¸¸å¤„ç†å®Œå–„
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

**å·¥ä½œé‡**ï¼š1.5å¤©

**ä¾èµ–**ï¼šä»»åŠ¡2.1

---

##### ä»»åŠ¡2.3ï¼šå®ç° StrategyRuntime å’Œ StrategyInstance æ¨¡å‹ç±»

**ä»»åŠ¡æè¿°**ï¼š
åˆ›å»ºç­–ç•¥è¿è¡Œæ—¶å’Œå®ä¾‹æ¨¡å‹ç±»ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- `StrategyRuntime`ï¼šåŒ…å«ç­–ç•¥IDã€å†³ç­–æ¨¡å¼ã€å‚æ•°å¿«ç…§ã€å®ä¾‹åˆ—è¡¨
- `StrategyInstance`ï¼šåŒ…å«ç­–ç•¥IDã€äº¤æ˜“å¯¹IDã€é€»è¾‘çŠ¶æ€å¿«ç…§ã€ä¿¡å·è§†å›¾
- ä½¿ç”¨ä¸å¯å˜å¯¹è±¡è®¾è®¡

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ¨¡å‹ç±»è®¾è®¡åˆç†
- [ ] å­—æ®µå®Œæ•´
- [ ] æœ‰ä¾¿æ·è®¿é—®æ–¹æ³•
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š1å¤©

**ä¾èµ–**ï¼šä»»åŠ¡2.1

---

##### ä»»åŠ¡2.4ï¼šå®ç° StrategyRuntimeFactory

**ä»»åŠ¡æè¿°**ï¼š
å®ç°è¿è¡Œä½“å·¥å‚ï¼Œå°†é…ç½®å¿«ç…§è½¬æ¢ä¸ºç­–ç•¥è¿è¡Œæ—¶ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- å®ç° `createRuntime(StrategyConfigSnapshot)` æ–¹æ³•
- ä¸€ä¸ªç­–ç•¥ â†’ Nä¸ªå®ä¾‹ï¼ˆæŒ‰äº¤æ˜“å¯¹æ‹†åˆ†ï¼‰
- æ³¨å…¥å…±äº«å‚æ•°åˆ°æ¯ä¸ªå®ä¾‹
- ä¸è®¿é—®æ•°æ®åº“ï¼Œçº¯å†…å­˜æ“ä½œ

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```java
public StrategyRuntime createRuntime(StrategyConfigSnapshot config) {
    // 1. åˆ›å»º StrategyRuntime
    // 2. ä¸ºæ¯ä¸ªäº¤æ˜“å¯¹åˆ›å»º StrategyInstance
    // 3. æ³¨å…¥å…±äº«å‚æ•°
    // 4. è¿”å›
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] èƒ½æ­£ç¡®åˆ›å»ºStrategyRuntime
- [ ] äº¤æ˜“å¯¹æ•°é‡ = å®ä¾‹æ•°é‡
- [ ] å…±äº«å‚æ•°æ­£ç¡®æ³¨å…¥
- [ ] ä¸è®¿é—®æ•°æ®åº“
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

**å·¥ä½œé‡**ï¼š1.5å¤©

**ä¾èµ–**ï¼šä»»åŠ¡2.3

---

##### ä»»åŠ¡2.5ï¼šå®ç° LogicStateRestorer

**ä»»åŠ¡æè¿°**ï¼š
å®ç°çŠ¶æ€æ¢å¤å™¨ï¼Œæ¢å¤æˆ–åˆå§‹åŒ–ç­–ç•¥é€»è¾‘çŠ¶æ€ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- å®ç° `restoreOrInit(Long strategyId, Long tradingPairId)` æ–¹æ³•
- å¹‚ç­‰æ€§ï¼šå¤šæ¬¡è°ƒç”¨ç»“æœä¸€è‡´
- çŠ¶æ€ä¸å­˜åœ¨æ—¶åˆ›å»ºé»˜è®¤çŠ¶æ€å¹¶ç«‹å³å†™å›æ•°æ®åº“
- å¼‚å¸¸å¤„ç†å®Œå–„

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```java
public LogicState restoreOrInit(Long strategyId, Long tradingPairId) {
    // 1. æŸ¥è¯¢ strategy_logic_state
    // 2. å¦‚æœå­˜åœ¨ï¼Œç›´æ¥è¿”å›
    // 3. å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºé»˜è®¤çŠ¶æ€
    // 4. ç«‹å³å†™å›æ•°æ®åº“
    // 5. è¿”å›çŠ¶æ€
}
```

**é»˜è®¤çŠ¶æ€**ï¼š
- logic_direction = FLAT
- logic_position_qty = 0
- logic_stage = IDLE
- last_signal_id = null

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] èƒ½æ­£ç¡®æ¢å¤å·²å­˜åœ¨çš„çŠ¶æ€
- [ ] èƒ½æ­£ç¡®åˆå§‹åŒ–æ–°çŠ¶æ€
- [ ] çŠ¶æ€ç«‹å³æŒä¹…åŒ–
- [ ] å¹‚ç­‰æ€§æµ‹è¯•é€šè¿‡
- [ ] å¼‚å¸¸å¤„ç†å®Œå–„
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

**å·¥ä½œé‡**ï¼š2å¤©

**ä¾èµ–**ï¼šä»»åŠ¡1.2, ä»»åŠ¡1.3

---

##### ä»»åŠ¡2.6ï¼šå®ç° SignalView æ¨¡å‹ç±»

**ä»»åŠ¡æè¿°**ï¼š
åˆ›å»ºä¿¡å·è§†å›¾æ¨¡å‹ç±»ï¼Œç”¨äºå»ºç«‹ä¿¡å·è§‚å¯Ÿå…³ç³»ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- åŒ…å«ï¼šsignalConfigIdã€consumeMode
- æ ‡è®°ä¸ºåªè¯»ï¼ˆreadOnly = trueï¼‰
- ä¸åŒ…å«ä¿¡å·æ•°æ®ï¼ŒåªåŒ…å«è§‚å¯Ÿå…³ç³»

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ¨¡å‹ç±»è®¾è®¡åˆç†
- [ ] æ ‡è®°ä¸ºåªè¯»
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š0.5å¤©

**ä¾èµ–**ï¼šä»»åŠ¡1.3

---

##### ä»»åŠ¡2.7ï¼šå®ç° SignalViewBinder

**ä»»åŠ¡æè¿°**ï¼š
å®ç°ä¿¡å·è§‚å¯Ÿç»‘å®šå™¨ï¼Œä¸ºç­–ç•¥å®ä¾‹å»ºç«‹ä¿¡å·è§‚å¯Ÿå…³ç³»ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- å®ç° `bindSignalViews(StrategyInstance, List<SignalSubscription>)` æ–¹æ³•
- åªå»ºç«‹è§‚å¯Ÿå…³ç³»ï¼Œä¸æ¶ˆè´¹ä¿¡å·
- ä¸ä¿®æ”¹ä¿¡å·çŠ¶æ€

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```java
public void bindSignalViews(StrategyInstance instance, 
                            List<StrategySignalSubscription> subscriptions) {
    // 1. ä¸ºæ¯ä¸ªsubscriptionåˆ›å»ºSignalView
    // 2. è®¾ç½®consumeMode
    // 3. æ ‡è®°ä¸ºåªè¯»
    // 4. ç»‘å®šåˆ°instance
    // æ³¨æ„ï¼šä¸è°ƒç”¨SignalServiceï¼Œä¸æ¶ˆè´¹ä¿¡å·
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] èƒ½æ­£ç¡®å»ºç«‹è§‚å¯Ÿå…³ç³»
- [ ] ä¸æ¶ˆè´¹ä¿¡å·
- [ ] ä¸ä¿®æ”¹ä¿¡å·çŠ¶æ€
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] é˜¶æ®µè¾¹ç•Œæµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š1å¤©

**ä¾èµ–**ï¼šä»»åŠ¡2.6

---

#### ğŸ“¦ ç»„3ï¼šå¯åŠ¨ä¸æ³¨å†Œ

##### ä»»åŠ¡3.1ï¼šå®ç° StrategyRuntimeRegistry

**ä»»åŠ¡æè¿°**ï¼š
å®ç°ç­–ç•¥è¿è¡Œæ—¶æ³¨å†Œè¡¨ï¼Œç®¡ç†æ‰€æœ‰ç­–ç•¥è¿è¡Œæ—¶å®ä¾‹ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- çº¿ç¨‹å®‰å…¨çš„Mapå­˜å‚¨
- æä¾›æ³¨å†Œã€æ³¨é”€ã€æŸ¥è¯¢æ–¹æ³•
- æ”¯æŒæŒ‰ç­–ç•¥IDæŸ¥è¯¢
- æ”¯æŒæŸ¥è¯¢æ‰€æœ‰è¿è¡Œæ—¶

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```java
public class StrategyRuntimeRegistry {
    // æ³¨å†Œ
    public void register(StrategyRuntime runtime);
    
    // æ³¨é”€
    public void unregister(Long strategyId);
    
    // æŸ¥è¯¢
    public StrategyRuntime getRuntime(Long strategyId);
    
    // æŸ¥è¯¢æ‰€æœ‰
    public Collection<StrategyRuntime> getAllRuntimes();
    
    // è·å–æ•°é‡
    public int getRuntimeCount();
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] çº¿ç¨‹å®‰å…¨
- [ ] æ³¨å†Œ/æ³¨é”€åŠŸèƒ½æ­£å¸¸
- [ ] æŸ¥è¯¢åŠŸèƒ½æ­£å¸¸
- [ ] å•å…ƒæµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š1å¤©

**ä¾èµ–**ï¼šä»»åŠ¡2.3

---

##### ä»»åŠ¡3.2ï¼šå®ç° StrategyBootstrapper

**ä»»åŠ¡æè¿°**ï¼š
å®ç°å¯åŠ¨åè°ƒå™¨ï¼Œåè°ƒæ•´ä¸ªç­–ç•¥å®ä¾‹åŒ–è¿‡ç¨‹ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- å®ç° `bootstrapAll()` æ–¹æ³•ï¼šå¯åŠ¨æ‰€æœ‰å¯ç”¨ç­–ç•¥
- å®ç° `bootstrapStrategy(Long strategyId)` æ–¹æ³•ï¼šå¯åŠ¨å•ä¸ªç­–ç•¥
- å®ç° `stopStrategy(Long strategyId)` æ–¹æ³•ï¼šåœæ­¢ç­–ç•¥
- å¼‚å¸¸å¤„ç†ï¼šéƒ¨åˆ†å¤±è´¥ä¸å½±å“å…¶ä»–ç­–ç•¥
- æ—¥å¿—è®°å½•å®Œæ•´

**æ ¸å¿ƒæµç¨‹**ï¼š
```java
public void bootstrapStrategy(Long strategyId) {
    try {
        // 1. åŠ è½½é…ç½®
        StrategyConfigSnapshot config = configLoader.loadConfig(strategyId);
        if (config == null) {
            log.warn("ç­–ç•¥é…ç½®ä¸å­˜åœ¨æˆ–æœªå¯ç”¨: strategyId={}", strategyId);
            return;
        }
        
        // 2. åˆ›å»ºè¿è¡Œæ—¶
        StrategyRuntime runtime = runtimeFactory.createRuntime(config);
        
        // 3. ä¸ºæ¯ä¸ªå®ä¾‹æ¢å¤çŠ¶æ€
        for (StrategyInstance instance : runtime.getInstances()) {
            LogicState state = stateRestorer.restoreOrInit(
                strategyId, instance.getTradingPairId()
            );
            instance.setLogicState(state);
            
            // 4. ç»‘å®šä¿¡å·è§†å›¾
            signalViewBinder.bindSignalViews(instance, config.getSubscriptions());
        }
        
        // 5. æ³¨å†Œåˆ°æ³¨å†Œè¡¨
        registry.register(runtime);
        
        log.info("ç­–ç•¥å¯åŠ¨æˆåŠŸ: strategyId={}, instanceCount={}", 
            strategyId, runtime.getInstanceCount());
    } catch (Exception e) {
        log.error("ç­–ç•¥å¯åŠ¨å¤±è´¥: strategyId={}", strategyId, e);
        // ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œç»§ç»­å¤„ç†å…¶ä»–ç­–ç•¥
    }
}
```

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] èƒ½æ­£ç¡®å¯åŠ¨æ‰€æœ‰å¯ç”¨ç­–ç•¥
- [ ] èƒ½æ­£ç¡®å¯åŠ¨å•ä¸ªç­–ç•¥
- [ ] èƒ½æ­£ç¡®åœæ­¢ç­–ç•¥
- [ ] éƒ¨åˆ†å¤±è´¥ä¸å½±å“å…¶ä»–ç­–ç•¥
- [ ] æ—¥å¿—è®°å½•å®Œæ•´
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š2.5å¤©

**ä¾èµ–**ï¼šä»»åŠ¡2.2, ä»»åŠ¡2.4, ä»»åŠ¡2.5, ä»»åŠ¡2.7, ä»»åŠ¡3.1

---

##### ä»»åŠ¡3.3ï¼šå®ç°ç³»ç»Ÿå¯åŠ¨ç›‘å¬å™¨

**ä»»åŠ¡æè¿°**ï¼š
å®ç°Spring Bootå¯åŠ¨ç›‘å¬å™¨ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½æ‰€æœ‰å¯ç”¨ç­–ç•¥ã€‚

**æŠ€æœ¯è¦æ±‚**ï¼š
- å®ç° `ApplicationListener<ContextRefreshedEvent>`
- ç³»ç»Ÿå¯åŠ¨æ—¶è°ƒç”¨ `bootstrapper.bootstrapAll()`
- å¼‚å¸¸å¤„ç†å®Œå–„

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½ç­–ç•¥
- [ ] å¼‚å¸¸ä¸å½±å“ç³»ç»Ÿå¯åŠ¨
- [ ] æ—¥å¿—è®°å½•å®Œæ•´
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š0.5å¤©

**ä¾èµ–**ï¼šä»»åŠ¡3.2

---

#### ğŸ“¦ ç»„4ï¼šæµ‹è¯•ä¸æ–‡æ¡£

##### ä»»åŠ¡4.1ï¼šç¼–å†™å•å…ƒæµ‹è¯•

**ä»»åŠ¡æè¿°**ï¼š
ä¸ºæ ¸å¿ƒæ¨¡å—ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•ã€‚

**æµ‹è¯•è¦†ç›–**ï¼š
- StrategyConfigLoaderï¼šâ‰¥ 80%
- StrategyRuntimeFactoryï¼šâ‰¥ 80%
- LogicStateRestorerï¼šâ‰¥ 80%
- SignalViewBinderï¼šâ‰¥ 80%
- StrategyBootstrapperï¼šâ‰¥ 70%

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ‰€æœ‰æ ¸å¿ƒæ¨¡å—éƒ½æœ‰å•å…ƒæµ‹è¯•
- [ ] è¦†ç›–ç‡è¾¾æ ‡
- [ ] æµ‹è¯•ç”¨ä¾‹è¦†ç›–æ­£å¸¸æµç¨‹å’Œå¼‚å¸¸æµç¨‹
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š3å¤©

**ä¾èµ–**ï¼šç»„2, ç»„3

---

##### ä»»åŠ¡4.2ï¼šç¼–å†™é›†æˆæµ‹è¯•

**ä»»åŠ¡æè¿°**ï¼š
ç¼–å†™é›†æˆæµ‹è¯•ï¼ŒéªŒè¯å®Œæ•´çš„å®ä¾‹åŒ–æµç¨‹ã€‚

**æµ‹è¯•åœºæ™¯**ï¼š
1. ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½æ‰€æœ‰å¯ç”¨ç­–ç•¥
2. ç­–ç•¥å¯ç”¨æ—¶åˆ›å»ºå®ä¾‹
3. ç­–ç•¥ç¦ç”¨æ—¶é”€æ¯å®ä¾‹
4. ç³»ç»Ÿé‡å¯åçŠ¶æ€æ¢å¤
5. å¤šäº¤æ˜“å¯¹ç­–ç•¥å®ä¾‹åŒ–
6. é˜¶æ®µè¾¹ç•Œæµ‹è¯•ï¼ˆä¸äº§ç”Ÿå‰¯ä½œç”¨ï¼‰

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ‰€æœ‰æµ‹è¯•åœºæ™¯éƒ½æœ‰æµ‹è¯•ç”¨ä¾‹
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] é˜¶æ®µè¾¹ç•Œæµ‹è¯•é€šè¿‡

**å·¥ä½œé‡**ï¼š2å¤©

**ä¾èµ–**ï¼šç»„3

---

##### ä»»åŠ¡4.3ï¼šç¼–å†™APIæ–‡æ¡£

**ä»»åŠ¡æè¿°**ï¼š
ä¸ºæ ¸å¿ƒç±»å’Œæ–¹æ³•ç¼–å†™JavaDocæ–‡æ¡£ã€‚

**æ–‡æ¡£è¦æ±‚**ï¼š
- æ‰€æœ‰publicç±»å’Œæ–¹æ³•éƒ½æœ‰æ³¨é‡Š
- æ³¨é‡ŠåŒ…å«èŒè´£è¯´æ˜ã€å‚æ•°è¯´æ˜ã€è¿”å›å€¼è¯´æ˜ã€å¼‚å¸¸è¯´æ˜
- å…³é”®é€»è¾‘æœ‰æ³¨é‡Šè¯´æ˜

**éªŒæ”¶æ ‡å‡†**ï¼š
- [ ] æ‰€æœ‰public APIéƒ½æœ‰æ–‡æ¡£
- [ ] æ–‡æ¡£æ¸…æ™°å®Œæ•´
- [ ] å¯ä»¥é€šè¿‡IDEç”ŸæˆAPIæ–‡æ¡£

**å·¥ä½œé‡**ï¼š1å¤©

**ä¾èµ–**ï¼šç»„2, ç»„3

---

## ä¸‰ã€éªŒæ”¶æ ‡å‡†

### 3.1 åŠŸèƒ½éªŒæ”¶

#### âœ… å•ç­–ç•¥éªŒæ”¶

- [ ] ç­–ç•¥é…ç½®å®Œæ•´æ—¶ï¼Œèƒ½æˆåŠŸåˆ›å»ºStrategyRuntime
- [ ] ç­–ç•¥é…ç½®ä¸å®Œæ•´æ—¶ï¼Œèƒ½æ­£ç¡®å¤„ç†å¼‚å¸¸
- [ ] ç­–ç•¥æœªå¯ç”¨æ—¶ï¼Œä¸ä¼šè¢«åŠ è½½

#### âœ… å¤šäº¤æ˜“å¯¹éªŒæ”¶

- [ ] ä¸€ä¸ªç­–ç•¥ç»‘å®šNä¸ªäº¤æ˜“å¯¹ï¼Œèƒ½åˆ›å»ºNä¸ªç‹¬ç«‹å®ä¾‹
- [ ] æ¯ä¸ªå®ä¾‹éƒ½æœ‰ç‹¬ç«‹çš„logic_state
- [ ] ç¦ç”¨æŸä¸ªäº¤æ˜“å¯¹åï¼Œå®ä¾‹ä¸ä¼šè¢«åˆ›å»º

#### âœ… çŠ¶æ€æ¢å¤éªŒæ”¶

- [ ] ç³»ç»Ÿé‡å¯åï¼Œå·²å­˜åœ¨çš„logic_stateèƒ½æ­£ç¡®æ¢å¤
- [ ] é¦–æ¬¡è¿è¡Œç­–ç•¥æ—¶ï¼Œèƒ½è‡ªåŠ¨åˆ›å»ºé»˜è®¤logic_state
- [ ] çŠ¶æ€æ¢å¤æ˜¯å¹‚ç­‰çš„ï¼ˆå¤šæ¬¡è°ƒç”¨ç»“æœä¸€è‡´ï¼‰

#### âœ… ä¿¡å·è§‚å¯ŸéªŒæ”¶

- [ ] èƒ½æ­£ç¡®å»ºç«‹ä¿¡å·è§‚å¯Ÿå…³ç³»
- [ ] ä¸æ¶ˆè´¹ä¿¡å·ï¼Œä¸ä¿®æ”¹ä¿¡å·çŠ¶æ€
- [ ] ä¿¡å·è§†å›¾æ ‡è®°ä¸ºåªè¯»

### 3.2 é˜¶æ®µè¾¹ç•ŒéªŒæ”¶

#### âœ… å‰¯ä½œç”¨éªŒæ”¶

- [ ] `decision_record` è¡¨æ— æ–°å¢è®°å½•
- [ ] `signal_intent` çŠ¶æ€æ— å˜åŒ–
- [ ] æ²¡æœ‰è°ƒç”¨ä¿¡å·æ¶ˆè´¹æ–¹æ³•
- [ ] æ²¡æœ‰ç”Ÿæˆç­–ç•¥æ„å›¾

#### âœ… æ•°æ®å®Œæ•´æ€§éªŒæ”¶

- [ ] æ¯ä¸ªç­–ç•¥+äº¤æ˜“å¯¹éƒ½æœ‰å¯¹åº”çš„logic_state
- [ ] logic_stateæ•°æ®å®Œæ•´ï¼ˆæ‰€æœ‰å­—æ®µéƒ½æœ‰å€¼ï¼‰
- [ ] çŠ¶æ€å˜æ›´ç«‹å³æŒä¹…åŒ–

### 3.3 æ€§èƒ½éªŒæ”¶

- [ ] å¯åŠ¨100ä¸ªç­–ç•¥ï¼Œè€—æ—¶ < 10ç§’
- [ ] å•ä¸ªç­–ç•¥å®ä¾‹åŒ–è€—æ—¶ < 100ms
- [ ] å†…å­˜å ç”¨åˆç†ï¼ˆæ— å†…å­˜æ³„æ¼ï¼‰

### 3.4 ä»£ç è´¨é‡éªŒæ”¶

- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡
- [ ] æ— ä¸¥é‡ä»£ç å¼‚å‘³
- [ ] ç¬¦åˆç¼–ç è§„èŒƒ

---

## å››ã€é£é™©ä¸æ³¨æ„äº‹é¡¹

### 4.1 æŠ€æœ¯é£é™©

#### é£é™©1ï¼šçŠ¶æ€ä¸ä¸€è‡´

**é£é™©æè¿°**ï¼šç³»ç»Ÿå¼‚å¸¸å¯¼è‡´å†…å­˜çŠ¶æ€ä¸æ•°æ®åº“çŠ¶æ€ä¸ä¸€è‡´ã€‚

**åº”å¯¹æªæ–½**ï¼š
- æ‰€æœ‰çŠ¶æ€å˜æ›´ç«‹å³æŒä¹…åŒ–
- ç³»ç»Ÿå¯åŠ¨æ—¶ä»æ•°æ®åº“æ¢å¤çŠ¶æ€
- å®šæœŸæ ¡éªŒçŠ¶æ€ä¸€è‡´æ€§ï¼ˆå¯é€‰ï¼‰

#### é£é™©2ï¼šå¹¶å‘é—®é¢˜

**é£é™©æè¿°**ï¼šå¤šçº¿ç¨‹åŒæ—¶æ“ä½œæ³¨å†Œè¡¨å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚

**åº”å¯¹æªæ–½**ï¼š
- ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼ˆConcurrentHashMapï¼‰
- å…³é”®æ“ä½œåŠ é”ï¼ˆå¦‚éœ€è¦ï¼‰

#### é£é™©3ï¼šå†…å­˜æ³„æ¼

**é£é™©æè¿°**ï¼šç­–ç•¥åœæ­¢åï¼Œå®ä¾‹æœªä»æ³¨å†Œè¡¨ç§»é™¤å¯¼è‡´å†…å­˜æ³„æ¼ã€‚

**åº”å¯¹æªæ–½**ï¼š
- ç­–ç•¥åœæ­¢æ—¶ä»æ³¨å†Œè¡¨ç§»é™¤
- å®šæœŸæ£€æŸ¥æ³¨å†Œè¡¨ä¸­çš„ç­–ç•¥æ˜¯å¦ä»ç„¶å¯ç”¨
- ä½¿ç”¨å¼±å¼•ç”¨ï¼ˆå¯é€‰ï¼‰

### 4.2 ä¸šåŠ¡é£é™©

#### é£é™©1ï¼šçŠ¶æ€æ¼‚ç§»

**é£é™©æè¿°**ï¼šlogic_stateæ•°æ®å¼‚å¸¸å¯¼è‡´ç­–ç•¥è¡Œä¸ºå¼‚å¸¸ã€‚

**åº”å¯¹æªæ–½**ï¼š
- çŠ¶æ€æ¢å¤æ—¶æ ¡éªŒæ•°æ®åˆæ³•æ€§
- æä¾›çŠ¶æ€é‡ç½®åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

#### é£é™©2ï¼šé…ç½®å˜æ›´

**é£é™©æè¿°**ï¼šç­–ç•¥é…ç½®å˜æ›´åï¼Œå†…å­˜ä¸­çš„å¿«ç…§æœªæ›´æ–°ã€‚

**åº”å¯¹æªæ–½**ï¼š
- é…ç½®å˜æ›´æ—¶é‡æ–°åŠ è½½ç­–ç•¥
- æä¾›æ‰‹åŠ¨åˆ·æ–°åŠŸèƒ½

### 4.3 å¼€å‘æ³¨æ„äº‹é¡¹

1. **ä¸¥æ ¼éµå®ˆé˜¶æ®µè¾¹ç•Œ**ï¼šé˜¶æ®µ1ä¸åšé˜¶æ®µ2çš„äº‹æƒ…
2. **çŠ¶æ€å¿…é¡»æŒä¹…åŒ–**ï¼šæ‰€æœ‰çŠ¶æ€å˜æ›´ç«‹å³å†™å›æ•°æ®åº“
3. **å¼‚å¸¸å¤„ç†å®Œå–„**ï¼šéƒ¨åˆ†å¤±è´¥ä¸å½±å“å…¶ä»–ç­–ç•¥
4. **æ—¥å¿—è®°å½•å®Œæ•´**ï¼šå…³é”®æ“ä½œéƒ½è¦æœ‰æ—¥å¿—
5. **æµ‹è¯•è¦†ç›–å……åˆ†**ï¼šæ ¸å¿ƒé€»è¾‘å¿…é¡»æœ‰æµ‹è¯•

---

## äº”ã€å¼€å‘é¡ºåºå»ºè®®

### æ¨èå¼€å‘é¡ºåº

```
ç¬¬1å‘¨ï¼š
1. ä»»åŠ¡1.1-1.3ï¼ˆæ•°æ®å±‚ä¸æšä¸¾ï¼‰ â†’ 1.5å¤©
2. ä»»åŠ¡2.1-2.3ï¼ˆæ¨¡å‹ç±»ï¼‰ â†’ 2å¤©
3. ä»»åŠ¡2.4ï¼ˆRuntimeFactoryï¼‰ â†’ 1.5å¤©
4. ä»»åŠ¡2.5ï¼ˆStateRestorerï¼‰ â†’ 2å¤©

ç¬¬2å‘¨ï¼š
5. ä»»åŠ¡2.6-2.7ï¼ˆSignalViewï¼‰ â†’ 1.5å¤©
6. ä»»åŠ¡3.1ï¼ˆRegistryï¼‰ â†’ 1å¤©
7. ä»»åŠ¡3.2ï¼ˆBootstrapperï¼‰ â†’ 2.5å¤©
8. ä»»åŠ¡3.3ï¼ˆå¯åŠ¨ç›‘å¬å™¨ï¼‰ â†’ 0.5å¤©
9. ä»»åŠ¡4.1ï¼ˆå•å…ƒæµ‹è¯•ï¼‰ â†’ 3å¤©

ç¬¬3å‘¨ï¼š
10. ä»»åŠ¡4.2ï¼ˆé›†æˆæµ‹è¯•ï¼‰ â†’ 2å¤©
11. ä»»åŠ¡4.3ï¼ˆæ–‡æ¡£ï¼‰ â†’ 1å¤©
12. ä»£ç å®¡æŸ¥ä¸ä¼˜åŒ– â†’ 2å¤©
```

**æ€»å·¥ä½œé‡**ï¼šçº¦15-18å¤©ï¼ˆ3å‘¨ï¼‰

---

## å…­ã€å®Œæˆæ ‡å¿—

é˜¶æ®µ1å®Œæˆçš„æ ‡å¿—ï¼š

1. âœ… æ‰€æœ‰ä»»åŠ¡å®Œæˆ
2. âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
3. âœ… ä»£ç å®¡æŸ¥é€šè¿‡
4. âœ… æ–‡æ¡£å®Œæ•´
5. âœ… ç³»ç»Ÿå¯åŠ¨æ—¶èƒ½è‡ªåŠ¨åŠ è½½æ‰€æœ‰å¯ç”¨ç­–ç•¥
6. âœ… ç³»ç»Ÿé‡å¯åçŠ¶æ€èƒ½æ­£ç¡®æ¢å¤
7. âœ… é˜¶æ®µè¾¹ç•Œæµ‹è¯•é€šè¿‡ï¼ˆæ— å‰¯ä½œç”¨ï¼‰

**é˜¶æ®µ1ç»“æŸçš„å”¯ä¸€æ ‡å¿—**ï¼š

> **ç­–ç•¥å·²"æ´»ç€"ï¼Œä½†è¿˜æ²¡"åŠ¨æ‰‹"**

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2024  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ

