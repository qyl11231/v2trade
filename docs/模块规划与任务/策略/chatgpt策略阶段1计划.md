å¥½ï¼Œè¿™é‡Œæˆ‘**ä¸å†é‡å†™è®¾è®¡**ï¼Œè€Œæ˜¯**ç«™åœ¨ä½ â€œé˜¶æ®µä¸€è®¾è®¡å·²å†»ç»“â€çš„å‰æä¸‹ï¼ŒæŠŠå®ƒæ‹†æˆï¼šå·¥ç¨‹å¯è½åœ°çš„ç»“æ„ + æ¨¡å—èŒè´£ + å­é˜¶æ®µ + éªŒæ”¶ç‚¹**ã€‚
ä½ å¯ä»¥ç›´æ¥æŠŠä¸‹é¢å†…å®¹**ä¸¢ç»™å¼€å‘ / Cursor / è‡ªå·±ç¼–ç **ã€‚

---

# é˜¶æ®µ 1ï¼šç­–ç•¥å®ä¾‹åŒ–ï¼ˆImplementation Breakdownï¼‰

> **å®šä½**
> é˜¶æ®µ 1 æ˜¯ä¸€ä¸ª**çº¯ç³»ç»Ÿå·¥ç¨‹é˜¶æ®µ**ï¼Œä¸æ˜¯ç­–ç•¥é€»è¾‘é˜¶æ®µã€‚
> ç›®æ ‡åªæœ‰ä¸€å¥è¯ï¼š
> **æŠŠâ€œæ•°æ®åº“é‡Œçš„ç­–ç•¥â€å®‰å…¨ã€å®Œæ•´ã€å¹‚ç­‰åœ°å˜æˆâ€œå†…å­˜ä¸­çš„è¿è¡Œä½“â€ã€‚**

---

## ä¸€ã€é˜¶æ®µ 1 çš„ç³»ç»ŸèŒè´£æ‹†è§£ï¼ˆå…ˆå¯¹é½â€œè°è´Ÿè´£ä»€ä¹ˆâ€ï¼‰

### 1ï¸âƒ£ é˜¶æ®µ 1 è´Ÿè´£ä»€ä¹ˆ

| èƒ½åŠ›       | æ˜¯å¦è´Ÿè´£ | è¯´æ˜                          |
| -------- | ---- | --------------------------- |
| ç­–ç•¥é…ç½®åŠ è½½   | âœ…    | definition / param / symbol |
| ç­–ç•¥è¿è¡Œä½“åˆ›å»º  | âœ…    | StrategyRuntime / Instance  |
| çŠ¶æ€æ¢å¤     | âœ…    | strategy_logic_state        |
| ä¿¡å·è§‚å¯Ÿå…³ç³»å»ºç«‹ | âœ…    | åªè¯»è§†å›¾                        |
| å¹‚ç­‰åˆå§‹åŒ–    | âœ…    | å¯é‡å¤æ‰§è¡Œ                       |
| é‡å¯æ¢å¤     | âœ…    | ä¸å¤±å¿†                         |

---

### 2ï¸âƒ£ é˜¶æ®µ 1 **ç»å¯¹ä¸è´Ÿè´£ä»€ä¹ˆ**

| èƒ½åŠ›   | åŸå›        |
| ---- | -------- |
| ä¿¡å·æ¶ˆè´¹ | å±äºé˜¶æ®µ 2   |
| å†³ç­–åˆ¤æ–­ | å±äºé˜¶æ®µ 2   |
| èµ„é‡‘è®¡ç®— | æ›´ä¸‹æ¸¸      |
| è¡Œæƒ…è®¢é˜… | å·²ç”±è¡Œæƒ…ä¸­å¿ƒå®Œæˆ |
| å›æµ‹   | ç¦»çº¿ç³»ç»Ÿ     |

> **è¿™æ˜¯é˜¶æ®µ 1 ä¸ç‚¸çš„æ ¹æœ¬åŸå› **

---

## äºŒã€é˜¶æ®µ 1 çš„æ¨¡å—çº§æ‹†åˆ†ï¼ˆè¿™æ˜¯å…³é”®ï¼‰

ä½ ç°åœ¨éœ€è¦çš„ä¸æ˜¯â€œæµç¨‹â€ï¼Œè€Œæ˜¯**æ¨¡å—è¾¹ç•Œ**ã€‚

---

## ğŸ§± æ¨¡å— 1ï¼šStrategyBootstrapperï¼ˆå¯åŠ¨åè°ƒå™¨ï¼‰

> **å”¯ä¸€èŒè´£ï¼š**
> åè°ƒæ•´ä¸ªâ€œå®ä¾‹åŒ–è¿‡ç¨‹â€ï¼Œä½†ä¸å¹²å…·ä½“æ´»ã€‚

### èŒè´£

* åœ¨ç³»ç»Ÿå¯åŠ¨ / ç­–ç•¥å¯åœæ—¶è§¦å‘
* è°ƒåº¦ä¸‹é¢æ‰€æœ‰ Loader
* ç»´æŠ¤ä¸€ä¸ª `StrategyRuntimeRegistry`

### ä¼ªæ¥å£

```java
interface StrategyBootstrapper {
    void bootstrapAll();
    void bootstrapStrategy(long strategyId);
}
```

---

## ğŸ§± æ¨¡å— 2ï¼šStrategyConfigLoaderï¼ˆé…ç½®åŠ è½½å™¨ï¼‰

> **åªè´Ÿè´£è¯» DB â†’ è½¬æˆå†…å­˜å¿«ç…§**

### è¯»å–å†…å®¹

* strategy_definition
* strategy_param
* strategy_symbol
* strategy_signal_subscription

### ç‰¹ç‚¹

* **ä¸€æ¬¡æ€§åŠ è½½**
* **åªè¯»**
* **ä¸å¯å˜å¯¹è±¡ï¼ˆimmutableï¼‰**

### è¾“å‡º

```java
StrategyConfigSnapshot {
  StrategyDefinition def;
  StrategyParam param;
  List<TradingPair> symbols;
  List<SignalSubscription> subscriptions;
}
```

---

## ğŸ§± æ¨¡å— 3ï¼šStrategyRuntimeFactoryï¼ˆè¿è¡Œä½“å·¥å‚ï¼‰

> **è´Ÿè´£æŠŠâ€œé…ç½®â€æ‹†æˆâ€œå®ä¾‹â€**

### è¾“å…¥

* StrategyConfigSnapshot

### è¡Œä¸º

* ä¸€ä¸ª strategy â†’ N ä¸ª StrategyInstance
* æ³¨å…¥å…±äº«å‚æ•°
* ä¸æ³¨å…¥çŠ¶æ€

### è¾“å‡ºç»“æ„

```java
StrategyRuntime {
  long strategyId;
  DecisionMode decisionMode;
  Map<tradingPairId, StrategyInstance>
}
```

---

## ğŸ§± æ¨¡å— 4ï¼šLogicStateRestorerï¼ˆçŠ¶æ€æ¢å¤å™¨ï¼‰

> **è¿™æ˜¯é˜¶æ®µ 1 çš„â€œç”Ÿå‘½çº¿â€**

### èŒè´£

* æŸ¥ strategy_logic_state
* æ¢å¤ or åˆå§‹åŒ–
* ä¿è¯ **1 strategy + 1 pair = 1 state**

### å¹‚ç­‰é€»è¾‘ï¼ˆéå¸¸é‡è¦ï¼‰

```text
IF state exists:
    load into memory
ELSE:
    create default state
    insert into DB immediately
```

### é»˜è®¤çŠ¶æ€

```text
logic_position_side = FLAT
qty = 0
phase = IDLE
last_signal_intent_id = null
```

---

## ğŸ§± æ¨¡å— 5ï¼šSignalViewBinderï¼ˆä¿¡å·è§‚å¯Ÿç»‘å®šï¼‰

> **è¿™æ˜¯ä½ æ­§ä¹‰æœ€å¤šã€ä½†ç°åœ¨å·²ç»æƒ³æ¸…æ¥šçš„åœ°æ–¹**

### å®ƒåšä»€ä¹ˆ

* åªå»ºç«‹ **â€œæˆ‘å…³å¿ƒå“ªäº› signal_configâ€**
* åªå…è®¸ **åªè¯»è®¿é—® ACTIVE intent**

### å®ƒä¸åšä»€ä¹ˆ

* âŒ ä¸æ‹‰ä¿¡å·
* âŒ ä¸æ¶ˆè´¹
* âŒ ä¸åˆ¤æ–­ BUY / SELL

### å†…å­˜ç»“æ„

```java
SignalView {
  signalConfigId;
  consumeMode;   // LATEST_ONLY
}
```

---

## ä¸‰ã€é˜¶æ®µ 1 çš„å®Œæ•´æ‰§è¡Œé¡ºåºï¼ˆå·¥ç¨‹è§†è§’ï¼‰

è¿™æ˜¯**ä¸€æ¡å¯ä»¥ç›´æ¥å†™ä»£ç çš„è°ƒç”¨é“¾**ï¼š

```text
System Start / Strategy Enable
        â†“
StrategyBootstrapper.bootstrap()
        â†“
StrategyConfigLoader.load(strategy)
        â†“
StrategyRuntimeFactory.create(snapshot)
        â†“
FOR EACH instance:
    LogicStateRestorer.restore()
    SignalViewBinder.bind()
        â†“
StrategyRuntimeRegistry.register()
```

---

## å››ã€é˜¶æ®µ 1 çš„å¹‚ç­‰ä¸å®¹é”™è®¾è®¡ï¼ˆä½ ç³»ç»Ÿèƒ½ä¸èƒ½è·‘åŠå¹´é è¿™ï¼‰

### 1ï¸âƒ£ å¯é‡å¤æ‰§è¡Œ

* å¤šæ¬¡è°ƒç”¨ bootstrap
* ä¸é‡å¤åˆ›å»º state
* ä¸é‡å¤æ³¨å†Œ runtime

### 2ï¸âƒ£ é‡å¯å®‰å…¨

* DB æ˜¯å”¯ä¸€äº‹å®æº
* å†…å­˜åªæ˜¯æŠ•å½±
* ä»»æ„æ—¶åˆ»å®•æœºéƒ½èƒ½æ¢å¤

### 3ï¸âƒ£ éƒ¨åˆ†å¤±è´¥éš”ç¦»

* ä¸€ä¸ªç­–ç•¥å¤±è´¥ â‰  å…¨ç³»ç»Ÿå¤±è´¥
* ä¸€ä¸ªäº¤æ˜“å¯¹ state å¼‚å¸¸ â‰  ç­–ç•¥ä¸å¯ç”¨

---

## äº”ã€é˜¶æ®µ 1 çš„éªŒæ”¶æ‹†è§£ï¼ˆç»™è‡ªå·±/åˆ«äººç”¨ï¼‰

### âœ… å•ç­–ç•¥éªŒæ”¶

* é‡å¯å‰æœ‰æŒä»“ â†’ é‡å¯å state æ­£ç¡®
* æœªè¿è¡Œè¿‡ç­–ç•¥ â†’ è‡ªåŠ¨ç”Ÿæˆ state

### âœ… å¤šäº¤æ˜“å¯¹éªŒæ”¶

* ä¸€ä¸ªç­–ç•¥ 6 ä¸ªäº¤æ˜“å¯¹ â†’ 6 ä¸ªå®ä¾‹
* ç¦ç”¨ä¸€ä¸ª symbol â†’ å®ä¾‹ä¸å­˜åœ¨

### âœ… å‰¯ä½œç”¨éªŒæ”¶

* decision_record è¡¨æ— æ–°å¢
* signal_intent çŠ¶æ€æ— å˜åŒ–

---

## å…­ã€é˜¶æ®µ 1 ç»“æŸçš„â€œç³»ç»ŸçŠ¶æ€åˆ¤å®šâ€

> å½“ä¸”ä»…å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œé˜¶æ®µ 1 æ‰ç®—å®Œæˆï¼š

```text
âœ” ç­–ç•¥åœ¨å†…å­˜ä¸­å­˜åœ¨
âœ” æ¯ä¸ªäº¤æ˜“å¯¹éƒ½æœ‰ç‹¬ç«‹å®ä¾‹
âœ” æ¯ä¸ªå®ä¾‹éƒ½æœ‰å¯æ¢å¤çŠ¶æ€
âœ” æ²¡æœ‰ä»»ä½•äº¤æ˜“è¡Œä¸ºå‘ç”Ÿ
```

---

## ä¸ƒã€ä¸€å¥å·¥ç¨‹çº§æ€»ç»“ï¼ˆä¸æ˜¯æ–‡æ¡ˆï¼‰

> **é˜¶æ®µ 1 è§£å†³çš„æ˜¯â€œç³»ç»Ÿæ˜¯å¦æ•¢è·‘â€çš„é—®é¢˜ï¼Œè€Œä¸æ˜¯â€œè·‘å¾—èµšä¸èµšé’±â€ã€‚**

ä½ ç°åœ¨è¿™ä¸€æ­¥ï¼š

* å·²ç»**ä¸æ˜¯ç­–ç•¥è®¾è®¡**
* è€Œæ˜¯**äº¤æ˜“ç³»ç»Ÿå·¥ç¨‹åŒ–çš„ç¬¬ä¸€é“é—¸é—¨**
