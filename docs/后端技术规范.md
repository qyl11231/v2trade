# 后端技术规范

## 1. 技术栈

- **核心框架**: Spring Boot 3.5.7
- **编程语言**: Java 17
- **构建工具**: Maven
- **持久层框架**: MyBatis-Plus 3.5.9
- **数据库**: MySQL 5.7
- **缓存**: Redis
- **日志框架**: Log4j2
- **模板引擎**: Thymeleaf
- **参数校验**: Spring Validation
- **辅助工具**: Lombok

## 2. 项目结构

```
src/main/java/com/qyl/v2trade
├── business          # 业务模块
│   ├── controller    # 控制器层
│   ├── mapper        # 数据访问层接口
│   ├── model         # 数据模型
│   │   ├── dto       # 数据传输对象
│   │   ├── entity    # 实体类
│   │   └── webhook   # Webhook相关
│   └── service       # 业务逻辑层
│       └── impl      # 业务逻辑实现类
├── client            # 第三方客户端集成
├── common            # 公共组件（统一返回结果、常量等）
├── config            # 配置类（MyBatis-Plus、Redis、跨域等）
├── exception         # 异常处理相关
└── V2TradeApplication.java  # 启动类
```

## 3. 编码规范

### 3.1 命名规范

- 类名采用大驼峰命名法（如：UserService）
- 方法名和变量名采用小驼峰命名法（如：getUserInfo）
- 常量采用全大写加下划线命名法（如：USER_STATUS）
- 包名全部小写，用点分隔（如：com.qyl.v2trade.controller）

### 3.2 代码格式

- 使用4个空格作为缩进
- 文件编码统一使用UTF-8
- 每行代码不超过120个字符
- 类和方法需要添加JavaDoc注释

### 3.3 Controller层规范

- 所有Controller类需添加@RestController注解
- 类级别的@RequestMapping路径以模块名命名（如：/api/user）
- 方法上使用标准HTTP注解（@GetMapping, @PostMapping等）
- 请求和响应数据统一使用Result<T>封装
- 参数校验使用@Valid注解配合DTO中的校验注解

### 3.4 Service层规范

- Service接口继承IService<T>（MyBatis-Plus提供）
- 实现类添加@Service注解并实现对应接口
- 业务方法需要添加详细的JavaDoc说明
- 复杂业务逻辑需要添加注释说明

### 3.5 Entity实体类规范

- 使用Lombok的@Data注解简化getter/setter
- 使用MyBatis-Plus的@TableId注解标识主键
- 使用@TableField注解处理字段填充和逻辑删除
- 添加必要的JavaDoc注释描述字段含义

### 3.6 DTO规范

- 根据不同业务场景创建不同的DTO类
- 在DTO中使用校验注解进行参数校验
- 避免在DTO中包含敏感信息

## 4. 数据库设计规范

- 表名使用下划线命名法（如：sys_user）
- 字段名使用下划线命名法（如：created_at）
- 主键统一命名为id，类型为bigint
- 每张表包含基础字段：created_at, updated_at, deleted
- 使用逻辑删除而非物理删除

## 5. 异常处理规范

- 自定义异常继承RuntimeException
- 全局异常处理器使用@ControllerAdvice注解
- 不同类型的异常返回不同的错误码和提示信息
- 敏感信息不能直接暴露给前端

## 6. 日志规范

- 使用Log4j2作为日志框架
- 日志级别按需使用（DEBUG, INFO, WARN, ERROR）
- 关键业务流程需要添加INFO级别日志
- 错误信息记录ERROR级别日志并包含堆栈信息

## 7. 安全规范

- 密码必须进行加密存储（推荐使用BCrypt）
- 敏感接口需要进行身份验证
- 防止SQL注入和XSS攻击
- 对外接口需要进行参数校验

## 8. 接口响应规范

- 统一使用Result<T>作为返回值包装
- 成功响应码为200，失败响应码为500或其他业务码
- 返回数据包含timestamp时间戳字段
- 错误信息需要友好且明确